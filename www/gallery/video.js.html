<!DOCTYPE html>
      <html>
        <head>
          <title>example/video.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(p,x,l){function g(b,a){if(!x[b]){if(!p[b]){var c="function"==typeof require&&require;if(!a&&c)return c(b,!0);if(y)return y(b,!0);c=Error("Cannot find module '"+b+"'");throw c.code="MODULE_NOT_FOUND",c;}c=x[b]={exports:{}};p[b][0].call(c.exports,function(a){var c=p[b][1][a];return g(c?c:a)},c,c.exports,e$$0,p,x,l)}return x[b].exports}for(var y="function"==typeof require&&require,r=0;r<l.length;r++)g(l[r]);return g})({1:[function(h,p,x){var l=h("../regl")(),g=l({frag:"\n  precision mediump float;\n  uniform sampler2D texture;\n  uniform vec2 screenShape;\n  uniform float time;\n\n  varying vec2 uv;\n\n  vec4 background () {\n    vec2 pos = 0.5 - gl_FragCoord.xy / screenShape;\n    float r = length(pos);\n    float theta = atan(pos.y, pos.x);\n    return vec4(\n      cos(pos.x * time) + sin(pos.y * pos.x * time),\n      cos(100.0 * r * cos(0.3 * time) + theta),\n      sin(time / r + pos.x * cos(10.0 * time + 3.0)),\n      1);\n  }\n\n  void main () {\n    vec4 color = texture2D(texture, uv);\n    float chromakey = step(0.15 + max(color.r, color.b), color.g);\n    gl_FragColor = mix(color, background(), chromakey);\n  }",
vert:"\n  precision mediump float;\n  attribute vec2 position;\n  varying vec2 uv;\n  void main () {\n    uv = position;\n    gl_Position = vec4(1.0 - 2.0 * position, 0, 1);\n  }",attributes:{position:[-2,0,0,-2,2,2]},uniforms:{texture:l.prop("video"),screenShape:function(g){return[g.viewportWidth,g.viewportHeight]},time:l.context("time")},count:3});h("resl")({manifest:{video:{type:"video",src:"assets/doggie-chromakey.ogv",stream:!0}},onDone:function(y){var r=y.video;r.autoplay=!0;r.loop=!0;r.play();
var b=l.texture(r);l.frame(function(){g({video:b.subimage(r)})})}})},{"../regl":35,resl:34}],2:[function(h,p,x){function l(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}p.exports=function(g,y,r,b,a){g=r.maxAttributes;y=Array(g);for(r=0;r<g;++r)y[r]=new l;return{Record:l,scope:{},state:y}}},{}],3:[function(h,p,x){function l(b){return u[Object.prototype.toString.call(b)]|0}function g(b,a){for(var c=0;c<
a.length;++c)b[c]=a[c]}function y(b,c,a,g,l,r,y){for(var k=0,f=0;f<a;++f)for(var D=0;D<g;++D)b[k++]=c[l*f+r*D+y]}var r=h("./util/is-typed-array"),b=h("./util/is-ndarray"),a=h("./util/values"),c=h("./util/pool");x=h("./util/flatten");var D=x.flatten,F=x.shape,u=h("./constants/arraytypes.json"),C=h("./constants/dtypes.json"),m=h("./constants/usage.json"),J=[];J[5120]=1;J[5122]=2;J[5124]=4;J[5121]=1;J[5123]=2;J[5125]=4;J[5126]=4;p.exports=function(t,h,z){function q(b){this.id=k++;this.buffer=t.createBuffer();
this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;z.profile&&(this.stats={size:0})}function E(b,f,c){b.byteLength=f.byteLength;t.bufferData(b.type,f,c)}function u(f,a,k,q,m,h){f.usage=k;if(Array.isArray(a)){if(f.dtype=q||5126,0<a.length)if(Array.isArray(a[0])){m=F(a);for(var A=q=1;A<m.length;++A)q*=m[A];f.dimension=q;a=D(a,m,f.dtype);E(f,a,k);h?f.persistentData=a:c.freeType(a)}else"number"===typeof a[0]?(f.dimension=m,m=c.allocType(f.dtype,a.length),
g(m,a),E(f,m,k),h?f.persistentData=m:c.freeType(m)):r(a[0])&&(f.dimension=a[0].length,f.dtype=q||l(a[0])||5126,a=D(a,[a.length,a[0].length],f.dtype),E(f,a,k),h?f.persistentData=a:c.freeType(a))}else if(r(a))f.dtype=q||l(a),f.dimension=m,E(f,a,k),h&&(f.persistentData=new Uint8Array(new Uint8Array(a.buffer)));else if(b(a)){m=a.shape;var t=a.stride,A=a.offset,z=0,n=0,Y=0,T=0;1===m.length?(z=m[0],n=1,Y=t[0],T=0):2===m.length&&(z=m[0],n=m[1],Y=t[0],T=t[1]);f.dtype=q||l(a.data)||5126;f.dimension=n;m=c.allocType(f.dtype,
z*n);y(m,a.data,z,n,Y,T,A);E(f,m,k);h?f.persistentData=m:c.freeType(m)}}function p(a){h.bufferCount--;t.deleteBuffer(a.buffer);a.buffer=null;delete f[a.id]}var k=0,f={};q.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)};q.prototype.destroy=function(){p(this)};var T=[];z.profile&&(h.getTotalBufferSize=function(){var a=0;Object.keys(f).forEach(function(b){a+=f[b].stats.size});return a});return{create:function(a,k,E,T){function O(a){var f=35044,c=null,n=0,g=0,k=1;Array.isArray(a)||r(a)||
b(a)?c=a:"number"===typeof a?n=a|0:a&&("data"in a&&(c=a.data),"usage"in a&&(f=m[a.usage]),"type"in a&&(g=C[a.type]),"dimension"in a&&(k=a.dimension|0),"length"in a&&(n=a.length|0));G.bind();c?u(G,c,f,g,k,T):(t.bufferData(G.type,n,f),G.dtype=g||5121,G.usage=f,G.dimension=k,G.byteLength=n);z.profile&&(G.stats.size=G.byteLength*J[G.dtype]);return O}h.bufferCount++;var G=new q(k);f[G.id]=G;E||O(a);O._reglType="buffer";O._buffer=G;O.subdata=function(a,f){var k=(f||0)|0,n;G.bind();if(Array.isArray(a)){if(0<
a.length)if("number"===typeof a[0]){var q=c.allocType(G.dtype,a.length);g(q,a);t.bufferSubData(G.type,k,q);c.freeType(q)}else if(Array.isArray(a[0])||r(a[0]))n=F(a),q=D(a,n,G.dtype),t.bufferSubData(G.type,k,q),c.freeType(q)}else if(r(a))t.bufferSubData(G.type,k,a);else if(b(a)){n=a.shape;var m=a.stride,h=q=0,E=0,z=0;1===n.length?(q=n[0],h=1,E=m[0],z=0):2===n.length&&(q=n[0],h=n[1],E=m[0],z=m[1]);n=Array.isArray(a.data)?G.dtype:l(a.data);n=c.allocType(n,q*h);y(n,a.data,q,h,E,z,a.offset);t.bufferSubData(G.type,
k,n);c.freeType(n)}return O};z.profile&&(O.stats=G.stats);O.destroy=function(){p(G)};return O},createStream:function(a,f){var b=T.pop();b||(b=new q(a));b.bind();u(b,f,35040,0,1,!1);return b},destroyStream:function(a){T.push(a)},clear:function(){a(f).forEach(p);T.forEach(p)},getBuffer:function(a){return a&&a._buffer instanceof q?a._buffer:null},restore:function(){a(f).forEach(function(a){a.buffer=t.createBuffer();t.bindBuffer(a.type,a.buffer);t.bufferData(a.type,a.persistentData||a.byteLength,a.usage)})},
_initBuffer:u}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/flatten":24,"./util/is-ndarray":26,"./util/is-typed-array":27,"./util/pool":29,"./util/values":32}],4:[function(h,p,x){p.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},
{}],5:[function(h,p,x){p.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(h,p,x){p.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(h,p,x){p.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(h,p,x){function l(a){return Array.isArray(a)||F(a)||u(a)}function g(a){return a.sort(function(a,b){return"viewport"===a?-1:
"viewport"===b?1:a<b?-1:1})}function y(a,b,c,k){this.thisDep=a;this.contextDep=b;this.propDep=c;this.append=k}function r(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function b(a){return new y(!1,!1,!1,a)}function a(a,b){var c=a.type;return 0===c?(c=a.data.length,new y(!0,1<=c,2<=c,b)):4===c?(c=a.data,new y(c.thisDep,c.contextDep,c.propDep,b)):new y(3===c,2===c,1===c,b)}var c=h("./util/codegen"),D=h("./util/loop"),F=h("./util/is-typed-array"),u=h("./util/is-ndarray"),C=h("./util/is-array-like"),
m=h("./dynamic"),J=h("./constants/primitives.json"),t=h("./constants/dtypes.json"),M=["x","y","z","w"],z="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),q={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,
"one minus constant alpha":32772,"src alpha saturate":776},E={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},X={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},P={cw:2304,ccw:2305},k=new y(!1,!1,!1,function(){});p.exports=function(f,h,u,p,F,N,O,G,A,ka,Da,n,Y,x,ga){function Z(d){return d.replace(".","_")}
function S(d,a,b){var f=Z(d);B.push(d);w[f]=e[f]=!!b;ta[f]=a}function I(d,a,b){var f=Z(d);B.push(d);Array.isArray(b)?(e[f]=b.slice(),w[f]=b.slice()):e[f]=w[f]=b;ua[f]=a}function ca(){var d=c(),a=d.link,b=d.global;d.id=Pa++;d.batchId="0";var f=a(Oa),H=d.shared={props:"a0"};Object.keys(Oa).forEach(function(a){H[a]=b.def(f,".",a)});var L=d.next={},Q=d.current={};Object.keys(ua).forEach(function(a){Array.isArray(e[a])&&(L[a]=b.def(H.next,".",a),Q[a]=b.def(H.current,".",a))});var Qa=d.constants={};Object.keys(Ja).forEach(function(a){Qa[a]=
b.def(JSON.stringify(Ja[a]))});d.invoke=function(e,K){switch(K.type){case 0:var b=["this",H.context,H.props,d.batchId];return e.def(a(K.data),".call(",b.slice(0,Math.max(K.data.length+1,4)),")");case 1:return e.def(H.props,K.data);case 2:return e.def(H.context,K.data);case 3:return e.def("this",K.data);case 4:return K.data.append(d,e),K.data.ref}};d.attribCache={};var K={};d.scopeAttrib=function(d){d=h.id(d);if(d in K)return K[d];var e=ka.scope[d];e||(e=ka.scope[d]=new ya);return K[d]=a(e)};return d}
function na(d){var e=d["static"];d=d.dynamic;var f;if("profile"in e){var c=!!e.profile;f=b(function(a,d){return c});f.enable=c}else if("profile"in d){var H=d.profile;f=a(H,function(a,d){return a.invoke(d,H)})}return f}function va(d,e){var f=d["static"],c=d.dynamic;if("framebuffer"in f){var H=f.framebuffer;return H?(H=G.getFramebuffer(H),b(function(a,d){var e=a.link(H),b=a.shared;d.set(b.framebuffer,".next",e);b=b.context;d.set(b,".framebufferWidth",e+".width");d.set(b,".framebufferHeight",e+".height");
return e})):b(function(a,d){var e=a.shared;d.set(e.framebuffer,".next","null");e=e.context;d.set(e,".framebufferWidth",e+".drawingBufferWidth");d.set(e,".framebufferHeight",e+".drawingBufferHeight");return"null"})}if("framebuffer"in c){var L=c.framebuffer;return a(L,function(a,d){var e=a.invoke(d,L),b=a.shared,v=b.framebuffer,e=d.def(v,".getFramebuffer(",e,")");d.set(v,".next",e);b=b.context;d.set(b,".framebufferWidth",e+"?"+e+".width:"+b+".drawingBufferWidth");d.set(b,".framebufferHeight",e+"?"+
e+".height:"+b+".drawingBufferHeight");return e})}return null}function V(d,e,b){function f(d){if(d in c){var K=c[d];d=!0;var b=K.x|0,xa=K.y|0,Q,Na;"width"in K?Q=K.width|0:d=!1;"height"in K?Na=K.height|0:d=!1;return new y(!d&&e&&e.thisDep,!d&&e&&e.contextDep,!d&&e&&e.propDep,function(d,e){var a=d.shared.context,v=Q;"width"in K||(v=e.def(a,".","framebufferWidth","-",b));var f=Na;"height"in K||(f=e.def(a,".","framebufferHeight","-",xa));return[b,xa,v,f]})}if(d in L){var k=L[d];d=a(k,function(d,e){var a=
d.invoke(e,k),K=d.shared.context,b=e.def(a,".x|0"),v=e.def(a,".y|0"),f=e.def('"width" in ',a,"?",a,".width|0:","(",K,".","framebufferWidth","-",b,")"),a=e.def('"height" in ',a,"?",a,".height|0:","(",K,".","framebufferHeight","-",v,")");return[b,v,f,a]});e&&(d.thisDep=d.thisDep||e.thisDep,d.contextDep=d.contextDep||e.contextDep,d.propDep=d.propDep||e.propDep);return d}return e?new y(e.thisDep,e.contextDep,e.propDep,function(d,e){var a=d.shared.context;return[0,0,e.def(a,".","framebufferWidth"),e.def(a,
".","framebufferHeight")]}):null}var c=d["static"],L=d.dynamic;if(d=f("viewport")){var Q=d;d=new y(d.thisDep,d.contextDep,d.propDep,function(d,e){var a=Q.append(d,e),b=d.shared.context;e.set(b,".viewportWidth",a[2]);e.set(b,".viewportHeight",a[3]);return a})}return{viewport:d,scissor_box:f("scissor.box")}}function ia(d){function e(d){if(d in f){var K=h.id(f[d]);d=b(function(){return K});d.id=K;return d}if(d in c){var v=c[d];return a(v,function(d,e){var a=d.invoke(e,v);return e.def(d.shared.strings,
".id(",a,")")})}return null}var f=d["static"],c=d.dynamic,H=e("frag"),L=e("vert"),Q=null;r(H)&&r(L)?(Q=Da.program(L.id,H.id),d=b(function(d,e){return d.link(Q)})):d=new y(H&&H.thisDep||L&&L.thisDep,H&&H.contextDep||L&&L.contextDep,H&&H.propDep||L&&L.propDep,function(d,e){var a=d.shared.shader,b;b=H?H.append(d,e):e.def(a,".","frag");var v;v=L?L.append(d,e):e.def(a,".","vert");return e.def(a+".program("+v+","+b+")")});return{frag:H,vert:L,progVar:d,program:Q}}function la(d,e){function f(d,e){if(d in
c){var v=c[d]|0;return b(function(d,a){e&&(d.OFFSET=v);return v})}if(d in H){var xa=H[d];return a(xa,function(d,a){var b=d.invoke(a,xa);e&&(d.OFFSET=b);return b})}return e&&L?b(function(d,e){d.OFFSET="0";return 0}):null}var c=d["static"],H=d.dynamic,L=function(){if("elements"in c){var d=c.elements;l(d)?d=N.getElements(N.create(d,!0)):d&&(d=N.getElements(d));var e=b(function(e,a){if(d){var b=e.link(d);return e.ELEMENTS=b}return e.ELEMENTS=null});e.value=d;return e}if("elements"in H){var v=H.elements;
return a(v,function(d,e){var a=d.shared,b=a.isBufferArgs,a=a.elements,K=d.invoke(e,v),f=e.def("null"),b=e.def(b,"(",K,")"),K=d.cond(b).then(f,"=",a,".createStream(",K,");")["else"](f,"=",a,".getElements(",K,");");e.entry(K);e.exit(d.cond(b).then(a,".destroyStream(",f,");"));return d.ELEMENTS=f})}return null}(),Q=f("offset",!0);return{elements:L,primitive:function(){if("primitive"in c){var d=c.primitive;return b(function(e,a){return J[d]})}if("primitive"in H){var e=H.primitive;return a(e,function(d,
a){var b=d.constants.primTypes,v=d.invoke(a,e);return a.def(b,"[",v,"]")})}return L?r(L)?L.value?b(function(d,e){return e.def(d.ELEMENTS,".primType")}):b(function(){return 4}):new y(L.thisDep,L.contextDep,L.propDep,function(d,e){var a=d.ELEMENTS;return e.def(a,"?",a,".primType:",4)}):null}(),count:function(){if("count"in c){var d=c.count|0;return b(function(){return d})}if("count"in H){var e=H.count;return a(e,function(d,a){return d.invoke(a,e)})}return L?r(L)?L?Q?new y(Q.thisDep,Q.contextDep,Q.propDep,
function(d,e){return e.def(d.ELEMENTS,".vertCount-",d.OFFSET)}):b(function(d,e){return e.def(d.ELEMENTS,".vertCount")}):b(function(){return-1}):new y(L.thisDep||Q.thisDep,L.contextDep||Q.contextDep,L.propDep||Q.propDep,function(d,e){var a=d.ELEMENTS;return d.OFFSET?e.def(a,"?",a,".vertCount-",d.OFFSET,":-1"):e.def(a,"?",a,".vertCount:-1")}):null}(),instances:f("instances",!1),offset:Q}}function qa(d,e){var f=d["static"],c=d.dynamic,H={};B.forEach(function(d){function e(K,k){if(d in f){var xa=K(f[d]);
H[v]=b(function(){return xa})}else if(d in c){var Q=c[d];H[v]=a(Q,function(d,e){return k(d,e,d.invoke(e,Q))})}}var v=Z(d);switch(d){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return e(function(d){return d},function(d,e,a){return a});case "depth.func":return e(function(d){return E[d]},function(d,e,a){return e.def(d.constants.compareFuncs,"[",
a,"]")});case "depth.range":return e(function(d){return d},function(d,e,a){d=e.def("+",a,"[0]");e=e.def("+",a,"[1]");return[d,e]});case "blend.func":return e(function(d){return[q["srcRGB"in d?d.srcRGB:d.src],q["dstRGB"in d?d.dstRGB:d.dst],q["srcAlpha"in d?d.srcAlpha:d.src],q["dstAlpha"in d?d.dstAlpha:d.dst]]},function(d,e,a){function b(d,v){return e.def('"',d,v,'" in ',a,"?",a,".",d,v,":",a,".",d)}d=d.constants.blendFuncs;var v=b("src","RGB"),f=b("dst","RGB"),v=e.def(d,"[",v,"]"),c=e.def(d,"[",b("src",
"Alpha"),"]"),f=e.def(d,"[",f,"]");d=e.def(d,"[",b("dst","Alpha"),"]");return[v,f,c,d]});case "blend.equation":return e(function(d){if("string"===typeof d)return[da[d],da[d]];if("object"===typeof d)return[da[d.rgb],da[d.alpha]]},function(d,e,a){var b=d.constants.blendEquations,v=e.def(),f=e.def();d=d.cond("typeof ",a,'==="string"');d.then(v,"=",f,"=",b,"[",a,"];");d["else"](v,"=",b,"[",a,".rgb];",f,"=",b,"[",a,".alpha];");e(d);return[v,f]});case "blend.color":return e(function(d){return D(4,function(e){return+d[e]})},
function(d,e,a){return D(4,function(d){return e.def("+",a,"[",d,"]")})});case "stencil.mask":return e(function(d){return d|0},function(d,e,a){return e.def(a,"|0")});case "stencil.func":return e(function(d){return[E[d.cmp||"keep"],d.ref||0,"mask"in d?d.mask:-1]},function(d,e,a){d=e.def('"cmp" in ',a,"?",d.constants.compareFuncs,"[",a,".cmp]",":",7680);var b=e.def(a,".ref|0");e=e.def('"mask" in ',a,"?",a,".mask|0:-1");return[d,b,e]});case "stencil.opFront":case "stencil.opBack":return e(function(e){return["stencil.opBack"===
d?1029:1028,X[e.fail||"keep"],X[e.zfail||"keep"],X[e.zpass||"keep"]]},function(e,a,b){function v(d){return a.def('"',d,'" in ',b,"?",f,"[",b,".",d,"]:",7680)}var f=e.constants.stencilOps;return["stencil.opBack"===d?1029:1028,v("fail"),v("zfail"),v("zpass")]});case "polygonOffset.offset":return e(function(d){return[d.factor|0,d.units|0]},function(d,e,a){d=e.def(a,".factor|0");e=e.def(a,".units|0");return[d,e]});case "cull.face":return e(function(d){var e=0;"front"===d?e=1028:"back"===d&&(e=1029);return e},
function(d,e,a){return e.def(a,'==="front"?',1028,":",1029)});case "lineWidth":return e(function(d){return d},function(d,e,a){return a});case "frontFace":return e(function(d){return P[d]},function(d,e,a){return e.def(a+'==="cw"?2304:2305')});case "colorMask":return e(function(d){return d.map(function(d){return!!d})},function(d,e,a){return D(4,function(d){return"!!"+a+"["+d+"]"})});case "sample.coverage":return e(function(d){return["value"in d?d.value:1,!!d.invert]},function(d,e,a){d=e.def('"value" in ',
a,"?+",a,".value:1");e=e.def("!!",a,".invert");return[d,e]})}});return H}function ra(d,e){var f=d["static"],c=d.dynamic,k={};Object.keys(f).forEach(function(d){var e=f[d],a;if("number"===typeof e||"boolean"===typeof e)a=b(function(){return e});else if("function"===typeof e){var v=e._reglType;if("texture2d"===v||"textureCube"===v)a=b(function(d){return d.link(e)});else if("framebuffer"===v||"framebufferCube"===v)a=b(function(d){return d.link(e.color[0])})}else C(e)&&(a=b(function(d){return d.global.def("[",
D(e.length,function(d){return e[d]}),"]")}));a.value=e;k[d]=a});Object.keys(c).forEach(function(d){var e=c[d];k[d]=a(e,function(d,a){return d.invoke(a,e)})});return k}function ea(d,e){var f=d["static"],c=d.dynamic,k={};Object.keys(f).forEach(function(d){var e=f[d],a=h.id(d),v=new ya;if(l(e))v.state=1,v.buffer=F.getBuffer(F.create(e,34962,!1,!0)),v.type=0;else{var c=F.getBuffer(e);if(c)v.state=1,v.buffer=c,v.type=0;else if(e.constant){var B=e.constant;v.buffer="null";v.state=2;"number"===typeof B?
v.x=B:M.forEach(function(d,e){e<B.length&&(v[d]=B[e])})}else{var c=l(e.buffer)?F.getBuffer(F.create(e.buffer,34962,!1,!0)):F.getBuffer(e.buffer),g=e.offset|0,w=e.stride|0,q=e.size|0,n=!!e.normalized,m=0;"type"in e&&(m=t[e.type]);e=e.divisor|0;v.buffer=c;v.state=1;v.size=q;v.normalized=n;v.type=m||c.dtype;v.offset=g;v.stride=w;v.divisor=e}}k[d]=b(function(d,e){var b=d.attribCache;if(a in b)return b[a];var f={isStream:!1};Object.keys(v).forEach(function(d){f[d]=v[d]});v.buffer&&(f.buffer=d.link(v.buffer),
f.type=f.type||f.buffer+".dtype");return b[a]=f})});Object.keys(c).forEach(function(d){var e=c[d];k[d]=a(e,function(d,a){function b(d){a(B[d],"=",v,".",d,"|0;")}var v=d.invoke(a,e),f=d.shared,c=f.isBufferArgs,k=f.buffer,B={isStream:a.def(!1)},g=new ya;g.state=1;Object.keys(g).forEach(function(d){B[d]=a.def(""+g[d])});var w=B.buffer,H=B.type;a("if(",c,"(",v,")){",B.isStream,"=true;",w,"=",k,".createStream(",34962,",",v,");",H,"=",w,".dtype;","}else{",w,"=",k,".getBuffer(",v,");","if(",w,"){",H,"=",
w,".dtype;",'}else if("constant" in ',v,"){",B.state,"=",2,";","if(typeof "+v+'.constant === "number"){',B[M[0]],"=",v,".constant;",M.slice(1).map(function(d){return B[d]}).join("="),"=0;","}else{",M.map(function(d,e){return B[d]+"="+v+".constant.length>="+e+"?"+v+".constant["+e+"]:0;"}).join(""),"}}else{","if(",c,"(",v,".buffer)){",w,"=",k,".createStream(",34962,",",v,".buffer);","}else{",w,"=",k,".getBuffer(",v,".buffer);","}",H,'="type" in ',v,"?",f.glTypes,"[",v,".type]:",w,".dtype;",B.normalized,
"=!!",v,".normalized;");b("size");b("offset");b("stride");b("divisor");a("}}");a.exit("if(",B.isStream,"){",k,".destroyStream(",w,");","}");return B})});return k}function ja(d){var e=d["static"],f=d.dynamic,c={};Object.keys(e).forEach(function(d){var a=e[d];c[d]=b(function(d,e){return"number"===typeof a||"boolean"===typeof a?""+a:d.link(a)})});Object.keys(f).forEach(function(d){var e=f[d];c[d]=a(e,function(d,a){return d.invoke(a,e)})});return c}function ma(d,e,a,b,f){var c=va(d,f),k=V(d,c,f),B=la(d,
f),w=qa(d,f),g=ia(d,f),q=k.viewport;q&&(w.viewport=q);q=Z("scissor.box");(k=k[q])&&(w[q]=k);k=0<Object.keys(w).length;c={framebuffer:c,draw:B,shader:g,state:w,dirty:k};c.profile=na(d,f);c.uniforms=ra(a,f);c.attributes=ea(e,f);c.context=ja(b,f);return c}function fa(d,e,a){var b=d.shared.context,f=d.scope();Object.keys(a).forEach(function(c){e.save(b,"."+c);f(b,".",c,"=",a[c].append(d,e),";")});e(f)}function aa(d,e,a,b){var f=d.shared,c=f.gl,k=f.framebuffer,B;oa&&(B=e.def(f.extensions,".webgl_draw_buffers"));
var w=d.constants,f=w.drawBuffer,w=w.backBuffer;d=a?a.append(d,e):e.def(k,".next");b||e("if(",d,"!==",k,".cur){");e("if(",d,"){",c,".bindFramebuffer(",36160,",",d,".framebuffer);");oa&&e(B,".drawBuffersWEBGL(",f,"[",d,".colorAttachments.length]);");e("}else{",c,".bindFramebuffer(",36160,",null);");oa&&e(B,".drawBuffersWEBGL(",w,");");e("}",k,".cur=",d,";");b||e("}")}function ha(d,a,b){var f=d.shared,c=f.gl,k=d.current,w=d.next,g=f.current,q=f.next,n=d.cond(g,".dirty");B.forEach(function(a){a=Z(a);
if(!(a in b.state)){var f,v;if(a in w){f=w[a];v=k[a];var B=D(e[a].length,function(d){return n.def(f,"[",d,"]")});n(d.cond(B.map(function(d,e){return d+"!=="+v+"["+e+"]"}).join("||")).then(c,".",ua[a],"(",B,");",B.map(function(d,e){return v+"["+e+"]="+d}).join(";"),";"))}else f=n.def(q,".",a),B=d.cond(f,"!==",g,".",a),n(B),a in ta?B(d.cond(f).then(c,".enable(",ta[a],");")["else"](c,".disable(",ta[a],");"),g,".",a,"=",f,";"):B(c,".",ua[a],"(",f,");",g,".",a,"=",f,";")}});0===Object.keys(b.state).length&&
n(g,".dirty=false;");a(n)}function R(d,e,a,b){var f=d.shared,c=d.current,k=f.current,B=f.gl;g(Object.keys(a)).forEach(function(f){var w=a[f];if(!b||b(w)){var g=w.append(d,e);if(ta[f]){var q=ta[f];r(w)?g?e(B,".enable(",q,");"):e(B,".disable(",q,");"):e(d.cond(g).then(B,".enable(",q,");")["else"](B,".disable(",q,");"));e(k,".",f,"=",g,";")}else if(C(g)){var n=c[f];e(B,".",ua[f],"(",g,");",g.map(function(d,e){return n+"["+e+"]="+d}).join(";"),";")}else e(B,".",ua[f],"(",g,");",k,".",f,"=",g,";")}})}
function pa(d,e){sa&&(d.instancing=e.def(d.shared.extensions,".angle_instanced_arrays"))}function W(d,e,a,f,b){function c(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function k(d){m=e.def();d(m,"=",c(),";");"string"===typeof b?d(q,".count+=",b,";"):d(q,".count++;");x&&(f?(h=e.def(),d(h,"=",l,".getNumPendingQueries();")):d(l,".beginQuery(",q,");"))}function B(d){d(q,".cpuTime+=",c(),"-",m,";");x&&(f?d(l,".pushScopeStats(",h,",",l,".getNumPendingQueries(),",q,");"):d(l,
".endQuery();"))}function w(d){var a=e.def(n,".profile");e(n,".profile=",d,";");e.exit(n,".profile=",a,";")}var g=d.shared,q=d.stats,n=g.current,l=g.timer;a=a.profile;var m,h;if(a){if(r(a)){a.enable?(k(e),B(e.exit),w("true")):w("false");return}a=a.append(d,e);w(a)}else a=e.def(n,".profile");g=d.block();k(g);e("if(",a,"){",g,"}");d=d.block();B(d);e.exit("if(",a,"){",d,"}")}function ba(d,e,a,f,b){function c(d){switch(d){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;
case 35666:case 35669:case 35673:return 4;default:return 1}}function B(a,b,f){function c(){e("if(!",n,".buffer){",g,".enableVertexAttribArray(",q,");}");var a=f.type,k;k=f.size?e.def(f.size,"||",b):b;e("if(",n,".type!==",a,"||",n,".size!==",k,"||",h.map(function(d){return n+"."+d+"!=="+f[d]}).join("||"),"){",g,".bindBuffer(",34962,",",l,".buffer);",g,".vertexAttribPointer(",[q,k,a,f.normalized,f.stride,f.offset],");",n,".type=",a,";",n,".size=",k,";",h.map(function(d){return n+"."+d+"="+f[d]+";"}).join(""),
"}");sa&&(a=f.divisor,e("if(",n,".divisor!==",a,"){",d.instancing,".vertexAttribDivisorANGLE(",[q,a],");",n,".divisor=",a,";}"))}function k(){e("if(",n,".buffer){",g,".disableVertexAttribArray(",q,");","}if(",M.map(function(d,e){return n+"."+d+"!=="+m[e]}).join("||"),"){",g,".vertexAttrib4f(",q,",",m,");",M.map(function(d,e){return n+"."+d+"="+m[e]+";"}).join(""),"}")}var g=w.gl,q=e.def(a,".location"),n=e.def(w.attributes,"[",q,"]");a=f.state;var l=f.buffer,m=[f.x,f.y,f.z,f.w],h=["buffer","normalized",
"offset","stride"];1===a?c():2===a?k():(e("if(",a,"===",1,"){"),c(),e("}else{"),k(),e("}"))}var w=d.shared;f.forEach(function(f){var w=f.name,g=a.attributes[w],q;if(g){if(!b(g))return;q=g.append(d,e)}else{if(!b(k))return;var n=d.scopeAttrib(w);q={};Object.keys(new ya).forEach(function(d){q[d]=e.def(n,".",d)})}B(d.link(f),c(f.info.type),q)})}function U(d,e,a,f,b){for(var c=d.shared,B=c.gl,g,w=0;w<f.length;++w){var q=f[w],n=q.name,l=q.info.type,m=a.uniforms[n],q=d.link(q)+".location",A;if(m){if(!b(m))continue;
if(r(m)){n=m.value;if(35678===l||35680===l)l=d.link(n._texture||n.color[0]._texture),e(B,".uniform1i(",q,",",l+".bind());"),e.exit(l,".unbind();");else if(35674===l||35675===l||35676===l)n=d.global.def("new Float32Array(["+Array.prototype.slice.call(n)+"])"),m=2,35675===l?m=3:35676===l&&(m=4),e(B,".uniformMatrix",m,"fv(",q,",false,",n,");");else{switch(l){case 5126:g="1f";break;case 35664:g="2f";break;case 35665:g="3f";break;case 35666:g="4f";break;case 35670:g="1i";break;case 5124:g="1i";break;case 35671:g=
"2i";break;case 35667:g="2i";break;case 35672:g="3i";break;case 35668:g="3i";break;case 35673:g="4i";break;case 35669:g="4i"}e(B,".uniform",g,"(",q,",",C(n)?Array.prototype.slice.call(n):n,");")}continue}else A=m.append(d,e)}else{if(!b(k))continue;A=e.def(c.uniforms,"[",h.id(n),"]")}35678===l?e("if(",A,"&&",A,'._reglType==="framebuffer"){',A,"=",A,".color[0];","}"):35680===l&&e("if(",A,"&&",A,'._reglType==="framebufferCube"){',A,"=",A,".color[0];","}");n=1;switch(l){case 35678:case 35680:l=e.def(A,
"._texture");e(B,".uniform1i(",q,",",l,".bind());");e.exit(l,".unbind();");continue;case 5124:case 35670:g="1i";break;case 35667:case 35671:g="2i";n=2;break;case 35668:case 35672:g="3i";n=3;break;case 35669:case 35673:g="4i";n=4;break;case 5126:g="1f";break;case 35664:g="2f";n=2;break;case 35665:g="3f";n=3;break;case 35666:g="4f";n=4;break;case 35674:g="Matrix2fv";break;case 35675:g="Matrix3fv";break;case 35676:g="Matrix4fv"}e(B,".uniform",g,"(",q,",");if("M"===g.charAt(0)){var q=Math.pow(l-35674+
2,2),E=d.global.def("new Float32Array(",q,")");e("false,(Array.isArray(",A,")||",A," instanceof Float32Array)?",A,":(",D(q,function(d){return E+"["+d+"]="+A+"["+d+"]"}),",",E,")")}else 1<n?e(D(n,function(d){return A+"["+d+"]"})):e(A);e(");")}}function Ea(d,e,a,f){function b(c){var g=q[c];return g?g.contextDep&&f.contextDynamic||g.propDep?g.append(d,a):g.append(d,e):e.def(n,".",c)}function c(){function d(){a(E,".drawElementsInstancedANGLE(",[l,A,z,m+"<<(("+z+"-5121)>>1)",h],");")}function e(){a(E,
".drawArraysInstancedANGLE(",[l,m,A,h],");")}w?D?d():(a("if(",w,"){"),d(),a("}else{"),e(),a("}")):e()}function g(){function d(){a(B+".drawElements("+[l,A,z,m+"<<(("+z+"-5121)>>1)"]+");")}function e(){a(B+".drawArrays("+[l,m,A]+");")}w?D?d():(a("if(",w,"){"),d(),a("}else{"),e(),a("}")):e()}var k=d.shared,B=k.gl,n=k.draw,q=f.draw,w=function(){var b=q.elements,c=e;if(b){if(b.contextDep&&f.contextDynamic||b.propDep)c=a;b=b.append(d,c)}else b=c.def(n,".","elements");b&&c("if("+b+")"+B+".bindBuffer(34963,"+
b+".buffer.buffer);");return b}(),l=b("primitive"),m=b("offset"),A=function(){var b=q.count,c=e;if(b){if(b.contextDep&&f.contextDynamic||b.propDep)c=a;b=b.append(d,c)}else b=c.def(n,".","count");return b}();if("number"===typeof A){if(0===A)return}else a("if(",A,"){"),a.exit("}");var h,E;sa&&(h=b("instances"),E=d.instancing);var z=w+".type",D=q.elements&&r(q.elements);sa&&("number"!==typeof h||0<=h)?"string"===typeof h?(a("if(",h,">0){"),c(),a("}else if(",h,"<0){"),g(),a("}")):c():g()}function Ba(d,
e,a,b,f){e=ca();f=e.proc("body",f);sa&&(e.instancing=f.def(e.shared.extensions,".angle_instanced_arrays"));d(e,f,a,b);return e.compile().body}function Ca(d,e,a,f){pa(d,e);ba(d,e,a,f.attributes,function(){return!0});U(d,e,a,f.uniforms,function(){return!0});Ea(d,e,e,a)}function Fa(d,e){var a=d.proc("draw",1);pa(d,a);fa(d,a,e.context);aa(d,a,e.framebuffer);ha(d,a,e);R(d,a,e.state);W(d,a,e,!1,!0);var f=e.shader.progVar.append(d,a);a(d.shared.gl,".useProgram(",f,".program);");if(e.shader.program)Ca(d,
a,e,e.shader.program);else{var b=d.global.def("{}"),c=a.def(f,".id"),g=a.def(b,"[",c,"]");a(d.cond(g).then(g,".call(this,a0);")["else"](g,"=",b,"[",c,"]=",d.link(function(a){return Ba(Ca,d,e,a,1)}),"(",f,");",g,".call(this,a0);"))}0<Object.keys(e.state).length&&a(d.shared.current,".dirty=true;")}function Ga(e,a,f,b){function c(){return!0}e.batchId="a1";pa(e,a);ba(e,a,f,b.attributes,c);U(e,a,f,b.uniforms,c);Ea(e,a,a,f)}function za(e,a,f,b){function c(e){return e.contextDep&&B||e.propDep}function g(e){return!c(e)}
pa(e,a);var B=f.contextDep,k=a.def(),n=a.def();e.shared.props=n;e.batchId=k;var q=e.scope(),w=e.scope();a(q.entry,"for(",k,"=0;",k,"<","a1",";++",k,"){",n,"=","a0","[",k,"];",w,"}",q.exit);f.needsContext&&fa(e,w,f.context);f.needsFramebuffer&&aa(e,w,f.framebuffer);R(e,w,f.state,c);f.profile&&c(f.profile)&&W(e,w,f,!1,!0);b?(ba(e,q,f,b.attributes,g),ba(e,w,f,b.attributes,c),U(e,q,f,b.uniforms,g),U(e,w,f,b.uniforms,c),Ea(e,q,w,f)):(a=e.global.def("{}"),b=f.shader.progVar.append(e,w),n=w.def(b,".id"),
q=w.def(a,"[",n,"]"),w(e.shared.gl,".useProgram(",b,".program);","if(!",q,"){",q,"=",a,"[",n,"]=",e.link(function(a){return Ba(Ga,e,f,a,2)}),"(",b,");}",q,".call(this,a0[",k,"],",k,");"))}function Aa(e,a){function f(e){return e.contextDep&&c||e.propDep}var b=e.proc("batch",2);e.batchId="0";pa(e,b);var c=!1,g=!0;Object.keys(a.context).forEach(function(e){c=c||a.context[e].propDep});c||(fa(e,b,a.context),g=!1);var k=a.framebuffer,w=!1;k?(k.propDep?c=w=!0:k.contextDep&&c&&(w=!0),w||aa(e,b,k)):aa(e,b,
null);a.state.viewport&&a.state.viewport.propDep&&(c=!0);ha(e,b,a);R(e,b,a.state,function(e){return!f(e)});a.profile&&f(a.profile)||W(e,b,a,!1,"a1");a.contextDep=c;a.needsContext=g;a.needsFramebuffer=w;g=a.shader.progVar;if(g.contextDep&&c||g.propDep)za(e,b,a,null);else if(g=g.append(e,b),b(e.shared.gl,".useProgram(",g,".program);"),a.shader.program)za(e,b,a,a.shader.program);else{var k=e.global.def("{}"),w=b.def(g,".id"),q=b.def(k,"[",w,"]");b(e.cond(q).then(q,".call(this,a0,a1);")["else"](q,"=",
k,"[",w,"]=",e.link(function(f){return Ba(za,e,a,f,2)}),"(",g,");",q,".call(this,a0,a1);"))}0<Object.keys(a.state).length&&b(e.shared.current,".dirty=true;")}function Ma(e,a){function f(g){var k=a.shader[g];k&&b.set(c.shader,"."+g,k.append(e,b))}var b=e.proc("scope",3);e.batchId="a2";var c=e.shared,k=c.current;fa(e,b,a.context);a.framebuffer&&a.framebuffer.append(e,b);g(Object.keys(a.state)).forEach(function(f){var g=a.state[f].append(e,b);C(g)?g.forEach(function(a,c){b.set(e.next[f],"["+c+"]",a)}):
b.set(c.next,"."+f,g)});W(e,b,a,!0,!0);["elements","offset","count","instances","primitive"].forEach(function(f){var g=a.draw[f];g&&b.set(c.draw,"."+f,""+g.append(e,b))});Object.keys(a.uniforms).forEach(function(f){b.set(c.uniforms,"["+h.id(f)+"]",a.uniforms[f].append(e,b))});Object.keys(a.attributes).forEach(function(f){var c=a.attributes[f].append(e,b),g=e.scopeAttrib(f);Object.keys(new ya).forEach(function(e){b.set(g,"."+e,c[e])})});f("vert");f("frag");0<Object.keys(a.state).length&&(b(k,".dirty=true;"),
b.exit(k,".dirty=true;"));b("a1(",e.shared.context,",a0,",e.batchId,");")}function Ka(e){if("object"===typeof e&&!C(e)){for(var a=Object.keys(e),f=0;f<a.length;++f)if(m.isDynamic(e[a[f]]))return!0;return!1}}function Ha(e,f,b){function c(e,a){w.forEach(function(d){var f=g[d];m.isDynamic(f)&&(f=e.invoke(a,f),a(l,".",d,"=",f,";"))})}var g=f["static"][b];if(g&&Ka(g)){var k=e.global,w=Object.keys(g),q=!1,n=!1,B=!1,l=e.global.def("{}");w.forEach(function(f){var b=g[f];if(m.isDynamic(b))"function"===typeof b&&
(b=g[f]=m.unbox(b)),f=a(b,null),q=q||f.thisDep,B=B||f.propDep,n=n||f.contextDep;else{k(l,".",f,"=");switch(typeof b){case "number":k(b);break;case "string":k('"',b,'"');break;case "object":Array.isArray(b)&&k("[",b.join(),"]");break;default:k(e.link(b))}k(";")}});f.dynamic[b]=new m.DynamicVariable(4,{thisDep:q,contextDep:n,propDep:B,ref:l,append:c});delete f["static"][b]}}var ya=ka.Record,da={add:32774,subtract:32778,"reverse subtract":32779};u.ext_blend_minmax&&(da.min=32775,da.max=32776);var sa=
u.angle_instanced_arrays,oa=u.webgl_draw_buffers,e={dirty:!0,profile:ga.profile},w={},B=[],ta={},ua={};S("dither",3024);S("blend.enable",3042);I("blend.color","blendColor",[0,0,0,0]);I("blend.equation","blendEquationSeparate",[32774,32774]);I("blend.func","blendFuncSeparate",[1,0,1,0]);S("depth.enable",2929,!0);I("depth.func","depthFunc",513);I("depth.range","depthRange",[0,1]);I("depth.mask","depthMask",!0);I("colorMask","colorMask",[!0,!0,!0,!0]);S("cull.enable",2884);I("cull.face","cullFace",1029);
I("frontFace","frontFace",2305);I("lineWidth","lineWidth",1);S("polygonOffset.enable",32823);I("polygonOffset.offset","polygonOffset",[0,0]);S("sample.alpha",32926);S("sample.enable",32928);I("sample.coverage","sampleCoverage",[1,!1]);S("stencil.enable",2960);I("stencil.mask","stencilMask",-1);I("stencil.func","stencilFunc",[519,0,-1]);I("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);I("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);S("scissor.enable",3089);I("scissor.box",
"scissor",[0,0,f.drawingBufferWidth,f.drawingBufferHeight]);I("viewport","viewport",[0,0,f.drawingBufferWidth,f.drawingBufferHeight]);var Oa={gl:f,context:Y,strings:h,next:w,current:e,draw:n,elements:N,buffer:F,shader:Da,attributes:ka.state,uniforms:A,framebuffer:G,extensions:u,timer:x,isBufferArgs:l},Ja={primTypes:J,compareFuncs:E,blendFuncs:q,blendEquations:da,stencilOps:X,glTypes:t,orientationType:P};oa&&(Ja.backBuffer=[1029],Ja.drawBuffer=D(p.maxDrawbuffers,function(e){return 0===e?[0]:D(e,function(e){return 36064+
e})}));var Pa=0;return{next:w,current:e,procs:function(){var a=ca(),b=a.proc("poll"),c=a.proc("refresh"),g=a.block();b(g);c(g);var k=a.shared,w=k.gl,q=k.next,n=k.current;g(n,".dirty=false;");aa(a,b);aa(a,c,null,!0);var B=f.getExtension("angle_instanced_arrays"),l;B&&(l=a.link(B));for(var m=0;m<p.maxAttributes;++m){var A=c.def(k.attributes,"[",m,"]"),h=a.cond(A,".buffer");h.then(w,".enableVertexAttribArray(",m,");",w,".bindBuffer(",34962,",",A,".buffer.buffer);",w,".vertexAttribPointer(",m,",",A,".size,",
A,".type,",A,".normalized,",A,".stride,",A,".offset);")["else"](w,".disableVertexAttribArray(",m,");",w,".vertexAttrib4f(",m,",",A,".x,",A,".y,",A,".z,",A,".w);",A,".buffer=null;");c(h);B&&c(l,".vertexAttribDivisorANGLE(",m,",",A,".divisor);")}Object.keys(ta).forEach(function(e){var f=ta[e],k=g.def(q,".",e),B=a.block();B("if(",k,"){",w,".enable(",f,")}else{",w,".disable(",f,")}",n,".",e,"=",k,";");c(B);b("if(",k,"!==",n,".",e,"){",B,"}")});Object.keys(ua).forEach(function(f){var k=ua[f],B=e[f],l,
m,A=a.block();A(w,".",k,"(");C(B)?(k=B.length,l=a.global.def(q,".",f),m=a.global.def(n,".",f),A(D(k,function(e){return l+"["+e+"]"}),");",D(k,function(e){return m+"["+e+"]="+l+"["+e+"];"}).join("")),b("if(",D(k,function(e){return l+"["+e+"]!=="+m+"["+e+"]"}).join("||"),"){",A,"}")):(l=g.def(q,".",f),m=g.def(n,".",f),A(l,");",n,".",f,"=",l,";"),b("if(",l,"!==",m,"){",A,"}"));c(A)});return a.compile()}(),compile:function(e,a,f,b,c){var g=ca();g.stats=g.link(c);Object.keys(a["static"]).forEach(function(e){Ha(g,
a,e)});z.forEach(function(a){Ha(g,e,a)});f=ma(e,a,f,b,g);Fa(g,f);Ma(g,f);Aa(g,f);return g.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./dynamic":9,"./util/codegen":22,"./util/is-array-like":25,"./util/is-ndarray":26,"./util/is-typed-array":27,"./util/loop":28}],9:[function(h,p,x){function l(b,a){this.id=r++;this.type=b;this.data=a}function g(b){if(0===b.length)return[];var a=b.charAt(0),c=b.charAt(b.length-1);if(1<b.length&&a===c&&('"'===a||"'"===a))return['"'+b.substr(1,
b.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(a=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(b))return g(b.substr(0,a.index)).concat(g(a[1])).concat(g(b.substr(a.index+a[0].length)));a=b.split(".");if(1===a.length)return['"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];b=[];for(c=0;c<a.length;++c)b=b.concat(g(a[c]));return b}function y(b){return"["+g(b).join("][")+"]"}var r=0;p.exports={DynamicVariable:l,define:function(b,a){return new l(b,y(a+""))},isDynamic:function(b){return"function"===
typeof b&&!b._reglType||b instanceof l},unbox:function(b,a){return"function"===typeof b?new l(0,b):b},accessor:y}},{}],10:[function(h,p,x){var l=h("./util/is-typed-array"),g=h("./util/is-ndarray"),y=h("./util/values"),r=h("./constants/primitives.json"),b=h("./constants/usage.json");p.exports=function(a,c,h,p){function u(a){this.id=t++;J[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function C(b,m,r,z,k,f,y){b.buffer.bind();if(m){var t=y;y||l(m)&&(!g(m)||l(m.data))||(t=c.oes_element_index_uint?
5125:5123);h._initBuffer(b.buffer,m,r,t,3)}else a.bufferData(34963,f,r),b.buffer.dtype=t||5121,b.buffer.usage=r,b.buffer.dimension=3,b.buffer.byteLength=f;t=y;if(!y){switch(b.buffer.dtype){case 5121:case 5120:t=5121;break;case 5123:case 5122:t=5123;break;case 5125:case 5124:t=5125}b.buffer.dtype=t}b.type=t;m=k;0>m&&(m=b.buffer.byteLength,5123===t?m>>=1:5125===t&&(m>>=2));b.vertCount=m;m=z;0>z&&(m=4,z=b.buffer.dimension,1===z&&(m=0),2===z&&(m=1),3===z&&(m=4));b.primType=m}function m(a){p.elementsCount--;
delete J[a.id];a.buffer.destroy();a.buffer=null}var J={},t=0,M={uint8:5121,uint16:5123};c.oes_element_index_uint&&(M.uint32=5125);u.prototype.bind=function(){this.buffer.bind()};var z=[];return{create:function(a,c){function z(a){if(a)if("number"===typeof a)t(a),k.primType=4,k.vertCount=a|0,k.type=5121;else{var c=null,q=35044,m=-1,h=-1,y=0,D=0;if(Array.isArray(a)||l(a)||g(a))c=a;else if("data"in a&&(c=a.data),"usage"in a&&(q=b[a.usage]),"primitive"in a&&(m=r[a.primitive]),"count"in a&&(h=a.count|0),
"type"in a&&(D=M[a.type]),"length"in a)y=a.length|0;else if(y=h,5123===D||5122===D)y*=2;else if(5125===D||5124===D)y*=4;C(k,c,q,m,h,y,D)}else t(),k.primType=4,k.vertCount=0,k.type=5121;return z}var t=h.create(null,34963,!0),k=new u(t._buffer);p.elementsCount++;z(a);z._reglType="elements";z._elements=k;z.subdata=function(a,b){t.subdata(a,b);return z};z.destroy=function(){m(k)};return z},createStream:function(a){var b=z.pop();b||(b=new u(h.create(null,34963,!0,!1)._buffer));C(b,a,35040,-1,-1,0,0);return b},
destroyStream:function(a){z.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof u?a._elements:null},clear:function(){y(J).forEach(m)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":26,"./util/is-typed-array":27,"./util/values":32}],11:[function(h,p,x){p.exports=function(l,g){function h(a){a=a.toLowerCase();var b;try{b=r[a]=l.getExtension(a)}catch(g){}return!!b}for(var r={},b=0;b<g.extensions.length;++b){var a=g.extensions[b];if(!h(a))return g.onDestroy(),
g.onDone('"'+a+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}g.optionalExtensions.forEach(h);return{extensions:r,restore:function(){Object.keys(r).forEach(function(a){if(!h(a))throw Error("(regl): error restoring extension "+a);})}}}},{}],12:[function(h,p,x){var l=h("./util/values"),g=h("./util/extend"),y=[];y[6408]=4;var r=[];r[5121]=1;r[5126]=4;r[36193]=2;p.exports=function(b,a,c,h,p,u){function C(a,b,f){this.target=a;this.texture=
b;this.renderbuffer=f;var c=a=0;b?(a=b.width,c=b.height):f&&(a=f.width,c=f.height);this.width=a;this.height=c}function m(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function J(a,b,f){a&&(a.texture?a.texture._texture.refCount+=1:a.renderbuffer._renderbuffer.refCount+=1)}function t(a,f){f&&(f.texture?b.framebufferTexture2D(36160,a,f.target,f.texture._texture.texture,0):b.framebufferRenderbuffer(36160,a,36161,f.renderbuffer._renderbuffer.renderbuffer))}
function M(a){var b=3553,f=null,c=null,g=a;"object"===typeof a&&(g=a.data,"target"in a&&(b=a.target|0));a=g._reglType;"texture2d"===a?f=g:"textureCube"===a?f=g:"renderbuffer"===a&&(c=g,b=36161);return new C(b,f,c)}function z(a,b,f,c,g){if(f)return a=h.create2D({width:a,height:b,format:c,type:g}),a._texture.refCount=0,new C(3553,a,null);a=p.create({width:a,height:b,format:c});a._renderbuffer.refCount=0;return new C(36161,null,a)}function q(a){return a&&(a.texture||a.renderbuffer)}function E(a,b,f){a&&
(a.texture?a.texture.resize(b,f):a.renderbuffer&&a.renderbuffer.resize(b,f))}function X(){this.id=O++;G[this.id]=this;this.framebuffer=b.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function P(a){a.colorAttachments.forEach(m);m(a.depthAttachment);m(a.stencilAttachment);m(a.depthStencilAttachment)}function k(a){b.deleteFramebuffer(a.framebuffer);a.framebuffer=null;u.framebufferCount--;delete G[a.id]}
function f(a){var f;b.bindFramebuffer(36160,a.framebuffer);var g=a.colorAttachments;for(f=0;f<g.length;++f)t(36064+f,g[f]);for(f=g.length;f<c.maxColorAttachments;++f)b.framebufferTexture2D(36160,36064+f,3553,null,0);b.framebufferTexture2D(36160,33306,3553,null,0);b.framebufferTexture2D(36160,36096,3553,null,0);b.framebufferTexture2D(36160,36128,3553,null,0);t(36096,a.depthAttachment);t(36128,a.stencilAttachment);t(33306,a.depthStencilAttachment);b.checkFramebufferStatus(36160);b.bindFramebuffer(36160,
x.next);x.cur=x.next;b.getError()}function T(a,b){function c(a,b){var g,k=0,m=0,l=!0,h=!0;g=null;var t=!0,D="rgba",A="uint8",u=1,E=null,C=null,p=null,T=!1;if("number"===typeof a)k=a|0,m=b|0||k;else if(a){"shape"in a?(m=a.shape,k=m[0],m=m[1]):("radius"in a&&(k=m=a.radius),"width"in a&&(k=a.width),"height"in a&&(m=a.height));if("color"in a||"colors"in a)g=a.color||a.colors,Array.isArray(g);if(!g){"colorCount"in a&&(u=a.colorCount|0);"colorTexture"in a&&(t=!!a.colorTexture,D="rgba4");if("colorType"in
a&&(A=a.colorType,!t))if("half float"===A||"float16"===A)D="rgba16f";else if("float"===A||"float32"===A)D="rgba32f";"colorFormat"in a&&(D=a.colorFormat,0<=Ia.indexOf(D)?t=!0:0<=wa.indexOf(D)&&(t=!1))}if("depthTexture"in a||"depthStencilTexture"in a)T=!(!a.depthTexture&&!a.depthStencilTexture);"depth"in a&&("boolean"===typeof a.depth?l=a.depth:(E=a.depth,h=!1));"stencil"in a&&("boolean"===typeof a.stencil?h=a.stencil:(C=a.stencil,l=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?l=h=a.depthStencil:
(p=a.depthStencil,h=l=!1))}else k=m=1;var F=null,G=null,x=null,N=null;if(Array.isArray(g))F=g.map(M);else if(g)F=[M(g)];else for(F=Array(u),g=0;g<u;++g)F[g]=z(k,m,t,D,A);k=k||F[0].width;m=m||F[0].height;E?G=M(E):l&&!h&&(G=z(k,m,T,"depth","uint32"));C?x=M(C):h&&!l&&(x=z(k,m,!1,"stencil","uint8"));p?N=M(p):!E&&!C&&h&&l&&(N=z(k,m,T,"depth stencil","depth stencil"));l=null;for(g=0;g<F.length;++g)J(F[g],k,m),F[g]&&F[g].texture&&(h=y[F[g].texture._texture.format]*r[F[g].texture._texture.type],null===l&&
(l=h));J(G,k,m);J(x,k,m);J(N,k,m);P(n);n.width=k;n.height=m;n.colorAttachments=F;n.depthAttachment=G;n.stencilAttachment=x;n.depthStencilAttachment=N;c.color=F.map(q);c.depth=q(G);c.stencil=q(x);c.depthStencil=q(N);c.width=n.width;c.height=n.height;f(n);return c}var n=new X;u.framebufferCount++;c(a,b);return g(c,{resize:function(a,b){var g=a|0,k=b|0||g;if(g===n.width&&k===n.height)return c;for(var m=n.colorAttachments,l=0;l<m.length;++l)E(m[l],g,k);E(n.depthAttachment,g,k);E(n.stencilAttachment,g,
k);E(n.depthStencilAttachment,g,k);n.width=c.width=g;n.height=c.height=k;f(n);return c},_reglType:"framebuffer",_framebuffer:n,destroy:function(){k(n);P(n)}})}var x={cur:null,next:null,dirty:!1},Ia=["rgba"],wa=["rgba4","rgb565","rgb5 a1"];a.ext_srgb&&wa.push("srgba");a.ext_color_buffer_half_float&&wa.push("rgba16f","rgb16f");a.webgl_color_buffer_float&&wa.push("rgba32f");var N=["uint8"];a.oes_texture_half_float&&N.push("half float","float16");a.oes_texture_float&&N.push("float","float32");var O=0,
G={};return g(x,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof X)?a:null},create:T,createCube:function(a){function b(a){var c,k={color:null},m=0,l=null;c="rgba";var q="uint8",z=1;if("number"===typeof a)m=a|0;else if(a){"shape"in a?m=a.shape[0]:("radius"in a&&(m=a.radius|0),"width"in a?m=a.width|0:"height"in a&&(m=a.height|0));if("color"in a||"colors"in a)l=a.color||a.colors,Array.isArray(l);l||("colorCount"in a&&(z=a.colorCount|
0),"colorType"in a&&(q=a.colorType),"colorFormat"in a&&(c=a.colorFormat));"depth"in a&&(k.depth=a.depth);"stencil"in a&&(k.stencil=a.stencil);"depthStencil"in a&&(k.depthStencil=a.depthStencil)}else m=1;if(l)if(Array.isArray(l))for(a=[],c=0;c<l.length;++c)a[c]=l[c];else a=[l];else for(a=Array(z),l={radius:m,format:c,type:q},c=0;c<z;++c)a[c]=h.createCube(l);k.color=Array(a.length);for(c=0;c<a.length;++c)z=a[c],m=m||z.width,k.color[c]={target:34069,data:a[c]};for(c=0;6>c;++c){for(z=0;z<a.length;++z)k.color[z].target=
34069+c;0<c&&(k.depth=f[0].depth,k.stencil=f[0].stencil,k.depthStencil=f[0].depthStencil);if(f[c])f[c](k);else f[c]=T(k)}return g(b,{width:m,height:m,color:a})}var f=Array(6);b(a);return g(b,{faces:f,resize:function(a){var c=a|0;if(c===b.width)return b;var g=b.color;for(a=0;a<g.length;++a)g[a].resize(c);for(a=0;6>a;++a)f[a].resize(c);b.width=b.height=c;return b},_reglType:"framebufferCube",destroy:function(){f.forEach(function(a){a.destroy()})}})},clear:function(){l(G).forEach(k)},restore:function(){l(G).forEach(function(a){a.framebuffer=
b.createFramebuffer();f(a)})}})}},{"./util/extend":23,"./util/values":32}],13:[function(h,p,x){p.exports=function(l,g){var h=1;g.ext_texture_filter_anisotropic&&(h=l.getParameter(34047));var r=1,b=1;g.webgl_draw_buffers&&(r=l.getParameter(34852),b=l.getParameter(36063));return{colorBits:[l.getParameter(3410),l.getParameter(3411),l.getParameter(3412),l.getParameter(3413)],depthBits:l.getParameter(3414),stencilBits:l.getParameter(3415),subpixelBits:l.getParameter(3408),extensions:Object.keys(g).filter(function(a){return!!g[a]}),
maxAnisotropic:h,maxDrawbuffers:r,maxColorAttachments:b,pointSizeDims:l.getParameter(33901),lineWidthDims:l.getParameter(33902),maxViewportDims:l.getParameter(3386),maxCombinedTextureUnits:l.getParameter(35661),maxCubeMapSize:l.getParameter(34076),maxRenderbufferSize:l.getParameter(34024),maxTextureUnits:l.getParameter(34930),maxTextureSize:l.getParameter(3379),maxAttributes:l.getParameter(34921),maxVertexUniforms:l.getParameter(36347),maxVertexTextureUnits:l.getParameter(35660),maxVaryingVectors:l.getParameter(36348),
maxFragmentUniforms:l.getParameter(36349),glsl:l.getParameter(35724),renderer:l.getParameter(7937),vendor:l.getParameter(7936),version:l.getParameter(7938)}}},{}],14:[function(h,p,x){var l=h("./util/is-typed-array");p.exports=function(g,h,r,b,a,c){return function(a){var c;c=null===h.next?5121:h.next.colorAttachments[0].texture._texture.type;var u=0,C=0,m=b.framebufferWidth,p=b.framebufferHeight,t=null;l(a)?t=a:a&&(u=a.x|0,C=a.y|0,m=(a.width||b.framebufferWidth-u)|0,p=(a.height||b.framebufferHeight-
C)|0,t=a.data||null);r();a=m*p*4;t||(5121===c?t=new Uint8Array(a):5126===c&&(t=t||new Float32Array(a)));g.pixelStorei(3333,4);g.readPixels(u,C,m,p,6408,c,t);return t}}},{"./util/is-typed-array":27}],15:[function(h,p,x){var l=h("./util/values"),g=[];g[32854]=2;g[32855]=2;g[36194]=2;g[33189]=2;g[36168]=1;g[34041]=4;g[35907]=4;g[34836]=16;g[34842]=8;g[34843]=6;p.exports=function(h,r,b,a,c){function D(a){this.id=m++;this.refCount=1;this.renderbuffer=a;this.format=32854;this.height=this.width=0;c.profile&&
(this.stats={size:0})}function p(b){var c=b.renderbuffer;h.bindRenderbuffer(36161,null);h.deleteRenderbuffer(c);b.renderbuffer=null;b.refCount=0;delete J[b.id];a.renderbufferCount--}var u={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};r.ext_srgb&&(u.srgba=35907);r.ext_color_buffer_half_float&&(u.rgba16f=34842,u.rgb16f=34843);r.webgl_color_buffer_float&&(u.rgba32f=34836);var C=[];Object.keys(u).forEach(function(a){C[u[a]]=a});var m=0,J={};D.prototype.decRef=
function(){0>=--this.refCount&&p(this)};c.profile&&(a.getTotalRenderbufferSize=function(){var a=0;Object.keys(J).forEach(function(b){a+=J[b].stats.size});return a});return{create:function(b,m){function l(a,b){var m=0,k=0,f=32854;"object"===typeof a&&a?("shape"in a?(k=a.shape,m=k[0]|0,k=k[1]|0):("radius"in a&&(m=k=a.radius|0),"width"in a&&(m=a.width|0),"height"in a&&(k=a.height|0)),"format"in a&&(f=u[a.format])):"number"===typeof a?(m=a|0,k="number"===typeof b?b|0:m):a||(m=k=1);if(m!==q.width||k!==
q.height||f!==q.format)return l.width=q.width=m,l.height=q.height=k,q.format=f,h.bindRenderbuffer(36161,q.renderbuffer),h.renderbufferStorage(36161,f,m,k),c.profile&&(q.stats.size=g[q.format]*q.width*q.height),l.format=C[q.format],l}var q=new D(h.createRenderbuffer());J[q.id]=q;a.renderbufferCount++;l(b,m);l.resize=function(a,b){var m=a|0,k=b|0||m;if(m===q.width&&k===q.height)return l;l.width=q.width=m;l.height=q.height=k;h.bindRenderbuffer(36161,q.renderbuffer);h.renderbufferStorage(36161,q.format,
m,k);c.profile&&(q.stats.size=g[q.format]*q.width*q.height);return l};l._reglType="renderbuffer";l._renderbuffer=q;c.profile&&(l.stats=q.stats);l.destroy=function(){q.decRef()};return l},clear:function(){l(J).forEach(p)},restore:function(){l(J).forEach(function(a){a.renderbuffer=h.createRenderbuffer();h.bindRenderbuffer(36161,a.renderbuffer);h.renderbufferStorage(36161,a.format,a.width,a.height)});h.bindRenderbuffer(36161,null)}}}},{"./util/values":32}],16:[function(h,p,x){var l=h("./util/values");
p.exports=function(g,h,r,b){function a(a,b,c,g){this.name=a;this.id=b;this.location=c;this.info=g}function c(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b.id){a[c].location=b.location;return}a.push(b)}function D(a,b,c){c=35632===a?C:m;var l=c[b];if(!l){var r=h.str(b),l=g.createShader(a);g.shaderSource(l,r);g.compileShader(l);c[b]=l}return l}function p(a,c){this.id=x++;this.fragId=a;this.vertId=c;this.program=null;this.uniforms=[];this.attributes=[];b.profile&&(this.stats={uniformsCount:0,attributesCount:0})}
function u(m,l){var r,t;r=D(35632,m.fragId);t=D(35633,m.vertId);var p=m.program=g.createProgram();g.attachShader(p,r);g.attachShader(p,t);g.linkProgram(p);var k=g.getProgramParameter(p,35718);b.profile&&(m.stats.uniformsCount=k);var f=m.uniforms;for(r=0;r<k;++r)if(t=g.getActiveUniform(p,r))if(1<t.size)for(var u=0;u<t.size;++u){var C=t.name.replace("[0]","["+u+"]");c(f,new a(C,h.id(C),g.getUniformLocation(p,C),t))}else c(f,new a(t.name,h.id(t.name),g.getUniformLocation(p,t.name),t));k=g.getProgramParameter(p,
35721);b.profile&&(m.stats.attributesCount=k);f=m.attributes;for(r=0;r<k;++r)(t=g.getActiveAttrib(p,r))&&c(f,new a(t.name,h.id(t.name),g.getAttribLocation(p,t.name),t))}var C={},m={},J={},t=[],x=0;b.profile&&(r.getMaxUniformsCount=function(){var a=0;t.forEach(function(b){b.stats.uniformsCount>a&&(a=b.stats.uniformsCount)});return a},r.getMaxAttributesCount=function(){var a=0;t.forEach(function(b){b.stats.attributesCount>a&&(a=b.stats.attributesCount)});return a});return{clear:function(){var a=g.deleteShader.bind(g);
l(C).forEach(a);C={};l(m).forEach(a);m={};t.forEach(function(a){g.deleteProgram(a.program)});t.length=0;J={};r.shaderCount=0},program:function(a,b,c){r.shaderCount++;var g=J[b];g||(g=J[b]={});var m=g[a];m||(m=new p(b,a),u(m,c),g[a]=m,t.push(m));return m},restore:function(){C={};m={};for(var a=0;a<t.length;++a)u(t[a])},shader:D,frag:-1,vert:-1}}},{"./util/values":32}],17:[function(h,p,x){p.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,
renderbufferCount:0,maxTextureUnits:0}}},{}],18:[function(h,p,x){p.exports=function(){var l={"":0},g=[""];return{id:function(h){var r=l[h];if(r)return r;r=l[h]=g.length;g.push(h);return r},str:function(l){return g[l]}}}},{}],19:[function(h,p,x){function l(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function g(a){return Array.isArray(a)&&0!==a.length&&J(a[0])?!0:!1}function y(a){return Object.prototype.toString.call(a)}function r(a){if(!a)return!1;var b=y(a);return 0<=X.indexOf(b)?
!0:l(a)||g(a)||u(a)}function b(a,b){36193===a.type?(a.data=m(b),C.freeType(b)):a.data=b}function a(a,b,c,g,m,l){a="undefined"!==typeof k[a]?k[a]:E[a]*P[b];l&&(a*=6);if(m){for(g=0;1<=c;)g+=a*c*c,c/=2;return g}return a*c*g}var c=h("./util/extend"),D=h("./util/values"),F=h("./util/is-typed-array"),u=h("./util/is-ndarray"),C=h("./util/pool"),m=h("./util/to-half-float"),J=h("./util/is-array-like"),t=h("./util/flatten");x=h("./constants/arraytypes.json");var M=h("./constants/arraytypes.json"),z=[9984,9986,
9985,9987],q=[0,6409,6410,6407,6408],E={};E[6409]=E[6406]=E[6402]=1;E[34041]=E[6410]=2;E[6407]=E[35904]=3;E[6408]=E[35906]=4;var X=Object.keys(x).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),P=[];P[5121]=1;P[5126]=4;P[36193]=2;P[5123]=2;P[5125]=4;var k=[];k[32854]=2;k[32855]=2;k[36194]=2;k[34041]=4;k[33776]=.5;k[33777]=.5;k[33778]=1;k[33779]=1;k[35986]=.5;k[35987]=1;k[34798]=1;k[35840]=.5;k[35841]=.25;k[35842]=.5;
k[35843]=.25;k[36196]=.5;p.exports=function(f,k,h,p,x,N,O){function G(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.channels=this.height=this.width=this.colorSpace=0}function A(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=
b.height;a.channels=b.channels}function ka(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(a.flipY=b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in b&&(a.colorSpace=pa[b.colorSpace]);"type"in b&&(a.type=W[b.type]);var f=a.width,c=a.height,g=a.channels,k=!1;"shape"in b?(f=b.shape[0],c=b.shape[1],3===b.shape.length&&(g=b.shape[2],k=!0)):("radius"in b&&(f=c=b.radius),"width"in b&&(f=b.width),"height"in b&&(c=b.height),
"channels"in b&&(g=b.channels,k=!0));a.width=f|0;a.height=c|0;a.channels=g|0;f=!1;"format"in b&&(f=b.format,c=a.internalformat=ba[f],a.format=Ma[c],f in W&&!("type"in b)&&(a.type=W[f]),f in U&&(a.compressed=!0),f=!0);!k&&f?a.channels=E[a.format]:k&&!f&&a.channels!==q[a.format]&&(a.format=a.internalformat=q[a.channels])}}function P(a){f.pixelStorei(37440,a.flipY);f.pixelStorei(37441,a.premultiplyAlpha);f.pixelStorei(37443,a.colorSpace);f.pixelStorei(3317,a.unpackAlignment)}function n(){G.call(this);
this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function Y(a,f){var c=null;r(f)?c=f:f&&(ka(a,f),"x"in f&&(a.xOffset=f.x|0),"y"in f&&(a.yOffset=f.y|0),r(f.data)&&(c=f.data));if(f.copy){var k=x.viewportWidth,h=x.viewportHeight;a.width=a.width||k-a.xOffset;a.height=a.height||h-a.yOffset;a.needsCopy=!0}else if(!c)a.width=a.width||1,a.height=a.height||1,a.channels=a.channels||4;else if(F(c))a.channels=a.channels||4,a.data=c,"type"in f||5121!==a.type||(a.type=
M[Object.prototype.toString.call(c)]|0);else if(l(c)){a.channels=a.channels||4;k=c;h=k.length;switch(a.type){case 5121:case 5123:case 5125:case 5126:h=C.allocType(a.type,h);h.set(k);a.data=h;break;case 36193:a.data=m(k)}a.alignment=1;a.needsFree=!0}else if(u(c)){k=c.data;Array.isArray(k)||5121!==a.type||(a.type=M[Object.prototype.toString.call(k)]|0);var h=c.shape,n=c.stride,p,D,d,v;3===h.length?(d=h[2],v=n[2]):v=d=1;p=h[0];D=h[1];h=n[0];n=n[1];a.alignment=1;a.width=p;a.height=D;a.channels=d;a.format=
a.internalformat=q[d];a.needsFree=!0;p=v;c=c.offset;d=a.width;v=a.height;D=a.channels;for(var A=C.allocType(36193===a.type?5126:a.type,d*v*D),z=0,G=0;G<v;++G)for(var T=0;T<d;++T)for(var E=0;E<D;++E)A[z++]=k[h*T+n*G+p*E+c];b(a,A)}else if("[object HTMLCanvasElement]"===y(c)||"[object CanvasRenderingContext2D]"===y(c))"[object HTMLCanvasElement]"===y(c)?a.element=c:a.element=c.canvas,a.width=a.element.width,a.height=a.element.height,a.channels=4;else if("[object HTMLImageElement]"===y(c))a.element=c,
a.width=c.naturalWidth,a.height=c.naturalHeight,a.channels=4;else if("[object HTMLVideoElement]"===y(c))a.element=c,a.width=c.videoWidth,a.height=c.videoHeight,a.channels=4;else if(g(c)){k=a.width||c[0].length;h=a.height||c.length;n=a.channels;n=J(c[0][0])?n||c[0][0].length:n||1;p=t.shape(c);d=1;for(v=0;v<p.length;++v)d*=p[v];d=C.allocType(36193===a.type?5126:a.type,d);t.flatten(c,p,"",d);b(a,d);a.alignment=1;a.width=k;a.height=h;a.channels=n;a.format=a.internalformat=q[n];a.needsFree=!0}}function X(a,
b,c,g,k){var m=a.element,l=a.data,h=a.internalformat,d=a.format,q=a.type,n=a.width,r=a.height;P(a);m?f.texSubImage2D(b,k,c,g,d,q,m):a.compressed?f.compressedTexSubImage2D(b,k,c,g,h,n,r,l):a.needsCopy?(p(),f.copyTexSubImage2D(b,k,c,g,a.xOffset,a.yOffset,n,r)):f.texSubImage2D(b,k,c,g,n,r,d,q,l)}function ga(){return Ka.pop()||new n}function Z(a){a.needsFree&&C.freeType(a.data);n.call(a);Ka.push(a)}function S(){G.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}
function I(a,b,c){var f=a.images[0]=ga();a.mipmask=1;f.width=a.width=b;f.height=a.height=c;f.channels=a.channels=4}function ca(a,b){var c=null;if(r(b))c=a.images[0]=ga(),A(c,a),Y(c,b),a.mipmask=1;else if(ka(a,b),Array.isArray(b.mipmap))for(var f=b.mipmap,g=0;g<f.length;++g)c=a.images[g]=ga(),A(c,a),c.width>>=g,c.height>>=g,Y(c,f[g]),a.mipmask|=1<<g;else c=a.images[0]=ga(),A(c,a),Y(c,b),a.mipmask=1;A(a,a.images[0])}function na(a,b){for(var c=a.images,g=0;g<c.length&&c[g];++g){var k=c[g],m=b,l=g,h=
k.element,d=k.data,q=k.internalformat,n=k.format,r=k.type,t=k.width,D=k.height;P(k);h?f.texImage2D(m,l,n,n,r,h):k.compressed?f.compressedTexImage2D(m,l,q,t,D,0,d):k.needsCopy?(p(),f.copyTexImage2D(m,l,n,k.xOffset,k.yOffset,t,D,0)):f.texImage2D(m,l,n,t,D,0,n,r,d)}}function va(){var a=Ha.pop()||new S;G.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function V(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&Z(b[c]),b[c]=null;Ha.push(a)}function ia(){this.magFilter=this.minFilter=9728;
this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function la(a,b){"min"in b&&(a.minFilter=R[b.min],0<=z.indexOf(a.minFilter)&&(a.genMipmaps=!0));"mag"in b&&(a.magFilter=ha[b.mag]);var c=a.wrapS,f=a.wrapT;if("wrap"in b){var g=b.wrap;"string"===typeof g?c=f=aa[g]:Array.isArray(g)&&(c=aa[g[0]],f=aa[g[1]])}else"wrapS"in b&&(c=aa[b.wrapS]),"wrapT"in b&&(f=aa[b.wrapT]);a.wrapS=c;a.wrapT=f;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=
fa[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,c=!0}!c||"min"in b||(a.minFilter=9984)}}function qa(a,b){f.texParameteri(b,10241,a.minFilter);f.texParameteri(b,10240,a.magFilter);f.texParameteri(b,10242,a.wrapS);f.texParameteri(b,10243,a.wrapT);k.ext_texture_filter_anisotropic&&f.texParameteri(b,34046,a.anisotropic);a.genMipmaps&&(f.hint(33170,a.mipmapHint),f.generateMipmap(b))}function ra(a){G.call(this);this.mipmask=0;this.internalformat=
6408;this.id=ya++;this.refCount=1;this.target=a;this.texture=f.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new ia;O.profile&&(this.stats={size:0})}function ea(a){f.activeTexture(33984);f.bindTexture(a.target,a.texture)}function ja(){var a=oa[0];a?f.bindTexture(a.target,a.texture):f.bindTexture(3553,null)}function ma(a){var b=a.texture,c=a.unit,g=a.target;0<=c&&(f.activeTexture(33984+c),f.bindTexture(g,null),oa[c]=null);f.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=
0;delete da[a.id];N.textureCount--}var fa={"don't care":4352,"dont care":4352,nice:4354,fast:4353},aa={repeat:10497,clamp:33071,mirror:33648},ha={nearest:9728,linear:9729},R=c({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},ha),pa={none:0,browser:37444},W={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},ba={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},
U={};k.ext_srgb&&(ba.srgb=35904,ba.srgba=35906);k.oes_texture_float&&(W.float32=W["float"]=5126);k.oes_texture_half_float&&(W.float16=W["half float"]=36193);k.webgl_depth_texture&&(c(ba,{depth:6402,"depth stencil":34041}),c(W,{uint16:5123,uint32:5125,"depth stencil":34042}));k.webgl_compressed_texture_s3tc&&c(U,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});k.webgl_compressed_texture_atc&&c(U,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});
k.webgl_compressed_texture_pvrtc&&c(U,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});k.webgl_compressed_texture_etc1&&(U["rgb etc1"]=36196);var Ea=Array.prototype.slice.call(f.getParameter(34467));Object.keys(U).forEach(function(a){var b=U[a];0<=Ea.indexOf(b)&&(ba[a]=b)});var Ba=Object.keys(ba);h.textureFormats=Ba;var Ca=[];Object.keys(ba).forEach(function(a){Ca[ba[a]]=a});var Fa=[];Object.keys(W).forEach(function(a){Fa[W[a]]=a});var Ga=[];
Object.keys(ha).forEach(function(a){Ga[ha[a]]=a});var za=[];Object.keys(R).forEach(function(a){za[R[a]]=a});var Aa=[];Object.keys(aa).forEach(function(a){Aa[aa[a]]=a});var Ma=Ba.reduce(function(a,b){var c=ba[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{}),Ka=[],Ha=[],ya=0,da={},sa=h.maxTextureUnits,oa=Array(sa).map(function(){return null});c(ra.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>
a){for(var b=0;b<sa;++b){var c=oa[b];if(c){if(0<c.bindCount)continue;c.unit=-1}oa[b]=this;a=b;break}O.profile&&N.maxTextureUnits<a+1&&(N.maxTextureUnits=a+1);this.unit=a;f.activeTexture(33984+a);f.bindTexture(this.target,this.texture)}return a},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&ma(this)}});O.profile&&(N.getTotalTextureSize=function(){var a=0;Object.keys(da).forEach(function(b){a+=da[b].stats.size});return a});return{create2D:function(b,c){function g(b,c){var e=
k.texInfo;ia.call(e);var f=va();"number"===typeof b?"number"===typeof c?I(f,b|0,c|0):I(f,b|0,b|0):b?(la(e,b),ca(f,b)):I(f,1,1);e.genMipmaps&&(f.mipmask=(f.width<<1)-1);k.mipmask=f.mipmask;A(k,f);k.internalformat=f.internalformat;g.width=f.width;g.height=f.height;ea(k);na(f,3553);qa(e,3553);ja();V(f);O.profile&&(k.stats.size=a(k.internalformat,k.type,f.width,f.height,e.genMipmaps,!1));g.format=Ca[k.internalformat];g.type=Fa[k.type];g.mag=Ga[e.magFilter];g.min=za[e.minFilter];g.wrapS=Aa[e.wrapS];g.wrapT=
Aa[e.wrapT];return g}var k=new ra(3553);da[k.id]=k;N.textureCount++;g(b,c);g.subimage=function(a,b,c,e){b|=0;c|=0;e|=0;var d=ga();A(d,k);d.width=0;d.height=0;Y(d,a);d.width=d.width||(k.width>>e)-b;d.height=d.height||(k.height>>e)-c;ea(k);X(d,3553,b,c,e);ja();Z(d);return g};g.resize=function(b,c){var e=b|0,m=c|0||e;if(e===k.width&&m===k.height)return g;g.width=k.width=e;g.height=k.height=m;ea(k);for(var d=0;k.mipmask>>d;++d)f.texImage2D(3553,d,k.format,e>>d,m>>d,0,k.format,k.type,null);ja();O.profile&&
(k.stats.size=a(k.internalformat,k.type,e,m,!1,!1));return g};g._reglType="texture2d";g._texture=k;O.profile&&(g.stats=k.stats);g.destroy=function(){k.decRef()};return g},createCube:function(b,c,g,k,m,l){function h(b,c,e,f,g,k){var m,l=n.texInfo;ia.call(l);for(m=0;6>m;++m)d[m]=va();if("number"===typeof b||!b)for(b=b|0||1,m=0;6>m;++m)I(d[m],b,b);else if("object"===typeof b)if(c)ca(d[0],b),ca(d[1],c),ca(d[2],e),ca(d[3],f),ca(d[4],g),ca(d[5],k);else if(la(l,b),ka(n,b),"faces"in b)for(b=b.faces,m=0;6>
m;++m)A(d[m],n),ca(d[m],b[m]);else for(m=0;6>m;++m)ca(d[m],b);A(n,d[0]);n.mipmask=l.genMipmaps?(d[0].width<<1)-1:d[0].mipmask;n.internalformat=d[0].internalformat;h.width=d[0].width;h.height=d[0].height;ea(n);for(m=0;6>m;++m)na(d[m],34069+m);qa(l,34067);ja();O.profile&&(n.stats.size=a(n.internalformat,n.type,h.width,h.height,l.genMipmaps,!0));h.format=Ca[n.internalformat];h.type=Fa[n.type];h.mag=Ga[l.magFilter];h.min=za[l.minFilter];h.wrapS=Aa[l.wrapS];h.wrapT=Aa[l.wrapT];for(m=0;6>m;++m)V(d[m]);
return h}var n=new ra(34067);da[n.id]=n;N.cubeCount++;var d=Array(6);h(b,c,g,k,m,l);h.subimage=function(a,b,d,c,e){d|=0;c|=0;e|=0;var f=ga();A(f,n);f.width=0;f.height=0;Y(f,b);f.width=f.width||(n.width>>e)-d;f.height=f.height||(n.height>>e)-c;ea(n);X(f,34069+a,d,c,e);ja();Z(f);return h};h.resize=function(b){b|=0;if(b!==n.width){h.width=n.width=b;h.height=n.height=b;ea(n);for(var d=0;6>d;++d)for(var c=0;n.mipmask>>c;++c)f.texImage2D(34069+d,c,n.format,b>>c,b>>c,0,n.format,n.type,null);ja();O.profile&&
(n.stats.size=a(n.internalformat,n.type,h.width,h.height,!1,!0));return h}};h._reglType="textureCube";h._texture=n;O.profile&&(h.stats=n.stats);h.destroy=function(){n.decRef()};return h},clear:function(){for(var a=0;a<sa;++a)f.activeTexture(33984+a),f.bindTexture(3553,null),oa[a]=null;D(da).forEach(ma);N.cubeCount=0;N.textureCount=0},getTexture:function(a){return null},restore:function(){D(da).forEach(function(a){a.texture=f.createTexture();f.bindTexture(a.target,a.texture);for(var b=0;32>b;++b)if(0!==
(a.mipmask&1<<b))if(3553===a.target)f.texImage2D(3553,b,a.internalformat,a.width>>b,a.height>>b,0,a.internalformat,a.type,null);else for(var c=0;6>c;++c)f.texImage2D(34069+c,b,a.internalformat,a.width>>b,a.height>>b,0,a.internalformat,a.type,null);qa(a.texInfo,a.target)})}}}},{"./constants/arraytypes.json":4,"./util/extend":23,"./util/flatten":24,"./util/is-array-like":25,"./util/is-ndarray":26,"./util/is-typed-array":27,"./util/pool":29,"./util/to-half-float":31,"./util/values":32}],20:[function(h,
p,x){p.exports=function(l,g){function h(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function r(a,b,c){var g=p.pop()||new h;g.startQueryIndex=a;g.endQueryIndex=b;g.sum=0;g.stats=c;F.push(g)}var b=g.ext_disjoint_timer_query;if(!b)return null;var a=[],c=[],p=[],F=[],u=[],C=[];return{beginQuery:function(g){var l=a.pop()||b.createQueryEXT();b.beginQueryEXT(35007,l);c.push(l);r(c.length-1,c.length,g)},endQuery:function(){b.endQueryEXT(35007)},pushScopeStats:r,update:function(){var g,
l;g=c.length;if(0!==g){C.length=Math.max(C.length,g+1);u.length=Math.max(u.length,g+1);u[0]=0;var h=C[0]=0;for(l=g=0;l<c.length;++l){var r=c[l];b.getQueryObjectEXT(r,34919)?(h+=b.getQueryObjectEXT(r,34918),a.push(r)):c[g++]=r;u[l+1]=h;C[l+1]=g}c.length=g;for(l=g=0;l<F.length;++l){var h=F[l],z=h.startQueryIndex,r=h.endQueryIndex;h.sum+=u[r]-u[z];z=C[z];r=C[r];r===z?(h.stats.gpuTime+=h.sum/1E6,p.push(h)):(h.startQueryIndex=z,h.endQueryIndex=r,F[g++]=h)}F.length=g}},getNumPendingQueries:function(){return c.length},
clear:function(){a.push.apply(a,c);for(var g=0;g<a.length;g++)b.deleteQueryEXT(a[g]);c.length=0;a.length=0},restore:function(){c.length=0;a.length=0}}}},{}],21:[function(h,p,x){p.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(h,p,x){function l(g){return Array.prototype.slice.call(g)}function g(g){return l(g).join("")}var y=h("./extend");p.exports=function(){function h(){var b=[],c=[];return y(function(){b.push.apply(b,
l(arguments))},{def:function(){var g="v"+a++;c.push(g);0<arguments.length&&(b.push(g,"="),b.push.apply(b,l(arguments)),b.push(";"));return g},toString:function(){return g([0<c.length?"var "+c+";":"",g(b)])}})}function b(){function a(g,l){c(g,l,"=",b.def(g,l),";")}var b=h(),c=h(),g=b.toString,p=c.toString;return y(function(){b.apply(b,l(arguments))},{def:b.def,entry:b,exit:c,save:a,set:function(c,g,l){a(c,g);b(c,g,"=",l,";")},toString:function(){return g()+p()}})}var a=0,c=[],p=[],F=h(),u={};return{global:F,
link:function(b){for(var g=0;g<p.length;++g)if(p[g]===b)return c[g];g="g"+a++;c.push(g);p.push(b);return g},block:h,proc:function(a,c){function l(){var a="a"+h.length;h.push(a);return a}var h=[];c=c||0;for(var r=0;r<c;++r)l();var r=b(),p=r.toString;return u[a]=y(r,{arg:l,toString:function(){return g(["function(",h.join(),"){",p(),"}"])}})},scope:b,cond:function(){var a=g(arguments),c=b(),h=b(),r=c.toString,p=h.toString;return y(c,{then:function(){c.apply(c,l(arguments));return this},"else":function(){h.apply(h,
l(arguments));return this},toString:function(){var b=p();b&&(b="else{"+b+"}");return g(["if(",a,"){",r(),"}",b])}})},compile:function(){var a=['"use strict";',F,"return {"];Object.keys(u).forEach(function(b){a.push('"',b,'":',u[b].toString(),",")});a.push("}");var b=g(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,c.concat(b)).apply(null,p)}}}},{"./extend":23}],23:[function(h,p,x){p.exports=function(l,g){for(var h=Object.keys(g),r=0;r<h.length;++r)l[h[r]]=
g[h[r]];return l}},{}],24:[function(h,p,x){function l(g,b,a,c,l,h){for(var p=0;p<b;++p)for(var y=g[p],m=0;m<a;++m)for(var x=y[m],t=0;t<c;++t)l[h++]=x[t]}function g(h,b,a,c,p){for(var y=1,u=a+1;u<b.length;++u)y*=b[u];var C=b[a];if(4===b.length-a){var m=b[a+1],x=b[a+2];b=b[a+3];for(u=0;u<C;++u)l(h[u],m,x,b,c,p),p+=y}else for(u=0;u<C;++u)g(h[u],b,a+1,c,p),p+=y}var y=h("./pool");p.exports={shape:function(g){for(var b=[];g.length;g=g[0])b.push(g.length);return b},flatten:function(h,b,a,c){var p=1;if(b.length)for(var F=
0;F<b.length;++F)p*=b[F];else p=0;a=c||y.allocType(a,p);switch(b.length){case 0:break;case 1:c=b[0];for(b=0;b<c;++b)a[b]=h[b];break;case 2:c=b[0];b=b[1];for(F=p=0;F<c;++F)for(var u=h[F],C=0;C<b;++C)a[p++]=u[C];break;case 3:l(h,b[0],b[1],b[2],a,0);break;default:g(h,b,0,a,0)}return a}}},{"./pool":29}],25:[function(h,p,x){var l=h("./is-typed-array");p.exports=function(g){return Array.isArray(g)||l(g)}},{"./is-typed-array":27}],26:[function(h,p,x){var l=h("./is-typed-array");p.exports=function(g){return!!g&&
"object"===typeof g&&Array.isArray(g.shape)&&Array.isArray(g.stride)&&"number"===typeof g.offset&&g.shape.length===g.stride.length&&(Array.isArray(g.data)||l(g.data))}},{"./is-typed-array":27}],27:[function(h,p,x){var l=h("../constants/arraytypes.json");p.exports=function(g){return Object.prototype.toString.call(g)in l}},{"../constants/arraytypes.json":4}],28:[function(h,p,x){p.exports=function(h,g){for(var p=Array(h),r=0;r<h;++r)p[r]=g(r);return p}},{}],29:[function(h,p,x){function l(b){var a,c;
a=(65535<b)<<4;b>>>=a;c=(255<b)<<3;b>>>=c;a|=c;c=(15<b)<<2;b>>>=c;a|=c;c=(3<b)<<1;return a|c|b>>>c>>1}function g(b){a:{for(var a=16;268435456>=a;a*=16)if(b<=a){b=a;break a}b=0}a=r[l(b)>>2];return 0<a.length?a.pop():new ArrayBuffer(b)}function y(b){r[l(b.byteLength)>>2].push(b)}var r=h("./loop")(8,function(){return[]});p.exports={alloc:g,free:y,allocType:function(b,a){var c=null;switch(b){case 5120:c=new Int8Array(g(a),0,a);break;case 5121:c=new Uint8Array(g(a),0,a);break;case 5122:c=new Int16Array(g(2*
a),0,a);break;case 5123:c=new Uint16Array(g(2*a),0,a);break;case 5124:c=new Int32Array(g(4*a),0,a);break;case 5125:c=new Uint32Array(g(4*a),0,a);break;case 5126:c=new Float32Array(g(4*a),0,a);break;default:return null}return c.length!==a?c.subarray(0,a):c},freeType:function(b){y(b.buffer)}}},{"./loop":28}],30:[function(h,p,x){p.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(h){return requestAnimationFrame(h)},cancel:function(h){return cancelAnimationFrame(h)}}:
{next:function(h){return setTimeout(h,16)},cancel:clearTimeout}},{}],31:[function(h,p,x){var l=h("./pool"),g=new Float32Array(1),y=new Uint32Array(g.buffer);p.exports=function(h){for(var b=l.allocType(5123,h.length),a=0;a<h.length;++a)if(isNaN(h[a]))b[a]=65535;else if(Infinity===h[a])b[a]=31744;else if(-Infinity===h[a])b[a]=64512;else{g[0]=h[a];var c=y[0],p=c>>>31<<15,F=(c<<1>>>24)-127,c=c>>13&1023;b[a]=-24>F?p:-14>F?p+(c+1024>>-14-F):15<F?p+31744:p+(F+15<<10)+c}return b}},{"./pool":29}],32:[function(h,
p,x){p.exports=function(h){return Object.keys(h).map(function(g){return h[g]})}},{}],33:[function(h,p,x){function l(a,c,g){function h(){var c=window.innerWidth,m=window.innerHeight;a!==document.body&&(m=a.getBoundingClientRect(),c=m.right-m.left,m=m.top-m.bottom);l.width=g*c;l.height=g*m;b(l.style,{width:c+"px",height:m+"px"})}var l=document.createElement("canvas");b(l.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(l);a===document.body&&(l.style.position="absolute",b(a.style,{margin:0,
padding:0}));window.addEventListener("resize",h,!1);h();return{canvas:l,onDestroy:function(){window.removeEventListener("resize",h);a.removeChild(l)}}}function g(a,b){function g(h){try{return a.getContext(h,b)}catch(l){return null}}return g("webgl")||g("experimental-webgl")||g("webgl-experimental")}function y(a){return"string"===typeof a?a.split():a}function r(a){return"string"===typeof a?document.querySelector(a):a}var b=h("./util/extend");p.exports=function(a){var b=a||{},h,p,u,C;a={};var m=[],
x=[],t="undefined"===typeof window?1:window.devicePixelRatio,M=!1,z=function(a){},q=function(){};"string"===typeof b?h=document.querySelector(b):"object"===typeof b&&("string"===typeof b.nodeName&&"function"===typeof b.appendChild&&"function"===typeof b.getBoundingClientRect?h=b:"function"===typeof b.drawArrays||"function"===typeof b.drawElements?(C=b,u=C.canvas):("gl"in b?C=b.gl:"canvas"in b?u=r(b.canvas):"container"in b&&(p=r(b.container)),"attributes"in b&&(a=b.attributes),"extensions"in b&&(m=
y(b.extensions)),"optionalExtensions"in b&&(x=y(b.optionalExtensions)),"onDone"in b&&(z=b.onDone),"profile"in b&&(M=!!b.profile),"pixelRatio"in b&&(t=+b.pixelRatio)));h&&("canvas"===h.nodeName.toLowerCase()?u=h:p=h);if(!C){if(!u){h=l(p||document.body,z,t);if(!h)return null;u=h.canvas;q=h.onDestroy}C=g(u,a)}return C?{gl:C,canvas:u,container:p,extensions:m,optionalExtensions:x,pixelRatio:t,profile:M,onDone:z,onDestroy:q}:(q(),z("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),
null)}},{"./util/extend":23}],34:[function(h,p,x){function l(a){throw Error("resl: "+a);}function g(a,b,g){Object.keys(a).forEach(function(a){0>b.indexOf(a)&&l('invalid parameter "'+a+'" in '+g)})}function y(a,b){this.state=0;this.ready=!1;this.progress=0;this.name=a;this.cancel=b}var r=["manifest","onDone","onProgress","onError"],b=["type","src","stream","credentials","parser"],a=["onData","onDone"];p.exports=function(c){function h(a,b){if(a in c){var g=c[a];"function"!==typeof g&&l('invalid callback "'+
a+'"');return g}return null}function p(a){function b(){if(!(2>r.readyState||1===u.state||-1===u.state)){if(200!==r.status)return C('error loading resource "'+a.name+'"');if(2<r.readyState&&0===u.state){var f;f="binary"===a.type?r.response:r.responseText;if(l.data)try{t=l.data(f)}catch(g){return C(g)}else t=f}if(3<r.readyState&&0===u.state){if(l.done)try{t=l.done()}catch(g){return C(g)}u.state=1}q[c]=t;u.progress=.75*u.progress+.25;u.ready=a.stream&&!!t||1===u.state;m()}}var c=a.name,g=a.stream,h=
"binary"===a.type,l=a.parser,r=new XMLHttpRequest,t=null,u=new y(c,function(){1!==u.state&&-1!==u.state&&(r.onreadystatechange=null,r.abort(),u.state=-1)});r.onreadystatechange=g?b:function(){4===r.readyState&&b()};h&&(r.responseType="arraybuffer");a.credentials&&(r.withCredentials=!0);r.open("GET",a.src,!0);r.send();return u}function u(a,b){function c(){if(0===u.state)if(t.data)try{x=t.data(b)}catch(a){return C(a)}else x=b}function g(a){c();q[r]=x;u.progress=a.lengthComputable?Math.max(u.progress,
a.loaded/a.total):.75*u.progress+.25;m(r)}function h(){c();if(0===u.state){if(t.done)try{x=t.done()}catch(a){return C(a)}u.state=1}u.progress=1;u.ready=!0;q[r]=x;p();m("finish "+r)}function l(){C('error loading asset "'+r+'"')}function p(){a.stream&&b.removeEventListener("progress",g);"image"===a.type?b.addEventListener("load",h):b.addEventListener("canplay",h);b.removeEventListener("error",l)}var r=a.name,t=a.parser,u=new y(r,function(){1!==u.state&&-1!==u.state&&(u.state=-1,p(),b.src="")}),x=b;
a.stream&&b.addEventListener("progress",g);if("image"===a.type)b.addEventListener("load",h);else{var z=!1,n=!1;b.addEventListener("loadedmetadata",function(){n=!0;z&&h()});b.addEventListener("canplay",function(){z=!0;n&&h()})}b.addEventListener("error",l);b.crossOrigin=a.credentials?"use-credentials":"anonymous";b.src=a.src;return u}function C(a){-1!==E&&1!==E&&(E=-1,P.forEach(function(a){a.cancel()}),z?"string"===typeof a?z(Error("resl: "+a)):z(a):console.error("resl error:",a))}function m(a){if(-1!==
E&&1!==E){var b=0,c=0;P.forEach(function(a){a.ready&&(c+=1);b+=a.progress});c===P.length?(E=1,t(q)):M&&M(b/P.length,a)}}"object"===typeof c&&c||l("invalid or missing configuration");g(c,r,"config");var x=c.manifest;"object"===typeof x&&x||l("missing manifest");var t=h("onDone");t||l("missing onDone() callback");var M=h("onProgress"),z=h("onError"),q={},E=0,X={text:p,binary:function(a){return p(a)},image:function(a){return u(a,document.createElement("img"))},video:function(a){return u(a,document.createElement("video"))},
audio:function(a){return u(a,document.createElement("audio"))}},P=Object.keys(x).map(function(c){function f(a,b){if(a in h.parser){var c=h.parser[a];"function"!==typeof c&&l("invalid parser callback "+a+' for asset "'+a+'"');return c}return b}var h=x[c];"string"===typeof h?h={src:h}:"object"===typeof h&&h||l('invalid asset definition "'+c+'"');g(h,b,'asset "'+c+'"');var m={};"parser"in h&&("function"===typeof h.parser?m={data:h.parser}:"object"===typeof h.parser&&h.parser?(g(m,a,'parser for asset "'+
c+'"'),"onData"in m||l('missing onData callback for parser in asset "'+c+'"'),m={data:f("onData"),done:f("onDone")}):l('invalid parser for asset "'+c+'"'));return{name:c,type:function(a,b,f){a in h&&(f=h[a]);0>b.indexOf(f)&&l("invalid "+a+' "'+f+'" for asset "'+c+'", possible values: '+b);return f}("type",Object.keys(X),"text"),stream:!!h.stream,credentials:!!h.credentials,src:function(a,b,f){a in h?f=h[a]:b&&l("missing "+a+' for asset "'+c+'"');"string"!==typeof f&&l("invalid "+a+' for asset "'+
c+'", must be a string');return f}("src",!0,""),parser:m}}).map(function(a){return X[a.type](a)});0===P.length&&setTimeout(function(){m("done")},1)}},{}],35:[function(h,p,x){function l(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var g=h("./lib/util/extend"),y=h("./lib/dynamic"),r=h("./lib/util/raf"),b=h("./lib/util/clock"),a=h("./lib/strings"),c=h("./lib/webgl"),D=h("./lib/extension"),F=h("./lib/limits"),u=h("./lib/buffer"),C=h("./lib/elements"),m=h("./lib/texture"),J=h("./lib/renderbuffer"),
t=h("./lib/framebuffer"),M=h("./lib/attribute"),z=h("./lib/shader"),q=h("./lib/read"),E=h("./lib/core"),X=h("./lib/stats"),P=h("./lib/timer");p.exports=function(h){function f(){if(0===R.length)I&&I.update(),U=null;else{U=r.next(f);A();for(var a=R.length-1;0<=a;--a){var b=R[a];b&&b(V,null,0)}n.flush();I&&I.update()}}function p(){!U&&0<R.length&&(U=r.next(f))}function x(){U&&(r.cancel(f),U=null)}function Ia(a){a.preventDefault();x();pa.forEach(function(a){a()})}function wa(a){n.getError();La.restore();
ra.restore();la.restore();ea.restore();ja.restore();ma.restore();I&&I.restore();fa.procs.refresh();p();W.forEach(function(a){a()})}function N(a){function b(a){var c={},f={};Object.keys(a).forEach(function(b){var g=a[b];y.isDynamic(g)?f[b]=y.unbox(g,b):c[b]=g});return{dynamic:f,"static":c}}function c(a){for(;q.length<a;)q.push(null);return q}var f=b(a.context||{}),h=b(a.uniforms||{}),k=b(a.attributes||{}),l=b(function(a){function b(a){if(a in c){var f=c[a];delete c[a];Object.keys(f).forEach(function(b){c[a+
"."+b]=f[b]})}}var c=g({},a);delete c.uniforms;delete c.attributes;delete c.context;"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));a={gpuTime:0,cpuTime:0,count:0};var f=fa.compile(l,k,h,f,a),m=f.draw,n=f.batch,p=f.scope,q=[];return g(function(a,b){var f;if("function"===typeof a)return p.call(this,null,a,0);if("function"===typeof b)if("number"===
typeof a)for(f=0;f<a;++f)p.call(this,null,b,f);else if(Array.isArray(a))for(f=0;f<a.length;++f)p.call(this,a[f],b,f);else return p.call(this,a,b,0);else if("number"===typeof a){if(0<a)return n.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return n.call(this,a,a.length)}else return m.call(this,a)},{stats:a})}function O(a){R.push(a);p();return{cancel:function(){function b(){var a=l(R,b);R[a]=R[R.length-1];--R.length;0>=R.length&&x()}var c=l(R,a);R[c]=b}}}function G(){var a=aa.viewport,
b=aa.scissor_box;a[0]=a[1]=b[0]=b[1]=0;V.viewportWidth=V.framebufferWidth=V.drawingBufferWidth=a[2]=b[2]=n.drawingBufferWidth;V.viewportHeight=V.framebufferHeight=V.drawingBufferHeight=a[3]=b[3]=n.drawingBufferHeight}function A(){V.tick+=1;V.time=Da();G();fa.procs.poll()}function ka(){G();fa.procs.refresh();I&&I.update()}function Da(){return(b()-ca)/1E3}h=c(h);if(!h)return null;var n=h.gl,Y=n.getContextAttributes();n.isContextLost();var La=D(n,h);if(!La)return null;var ga=a(),Z=X(),S=La.extensions,
I=P(n,S),ca=b(),na=n.drawingBufferWidth,va=n.drawingBufferHeight,V={tick:0,time:0,viewportWidth:na,viewportHeight:va,framebufferWidth:na,framebufferHeight:va,drawingBufferWidth:na,drawingBufferHeight:va,pixelRatio:h.pixelRatio},ia=F(n,S),la=u(n,Z,h),qa=C(n,S,la,Z),na=M(n,S,ia,la,ga),ra=z(n,ga,Z,h),ea=m(n,S,ia,function(){fa.procs.poll()},V,Z,h),ja=J(n,S,ia,Z,h),ma=t(n,S,ia,ea,ja,Z),fa=E(n,ga,S,ia,la,qa,ea,ma,{},na,ra,{elements:null,primitive:4,count:-1,offset:0,instances:-1},V,I,h),ga=q(n,ma,fa.procs.poll,
V,Y,S),aa=fa.next,ha=n.canvas,R=[],pa=[],W=[],ba=[h.onDestroy],U=null;ha&&(ha.addEventListener("webglcontextlost",Ia,!1),ha.addEventListener("webglcontextrestored",wa,!1));ka();Y=g(N,{clear:function(a){var b=0;fa.procs.poll();var c=a.color;c&&(n.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(n.clearDepth(+a.depth),b|=256);"stencil"in a&&(n.clearStencil(a.stencil|0),b|=1024);n.clear(b)},prop:y.define.bind(null,1),context:y.define.bind(null,2),"this":y.define.bind(null,3),draw:N({}),
buffer:function(a){return la.create(a,34962,!1,!1)},elements:function(a){return qa.create(a,!1)},texture:ea.create2D,cube:ea.createCube,renderbuffer:ja.create,framebuffer:ma.create,framebufferCube:ma.createCube,attributes:Y,frame:O,on:function(a,b){var c;switch(a){case "frame":return O(b);case "lost":c=pa;break;case "restore":c=W;break;case "destroy":c=ba}c.push(b);return{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:ia,hasExtension:function(a){return 0<=
ia.extensions.indexOf(a.toLowerCase())},read:ga,destroy:function(){R.length=0;x();ha&&(ha.removeEventListener("webglcontextlost",Ia),ha.removeEventListener("webglcontextrestored",wa));ra.clear();ma.clear();ja.clear();ea.clear();qa.clear();la.clear();I&&I.clear();ba.forEach(function(a){a()})},_gl:n,_refresh:ka,poll:function(){A();I&&I.update()},now:Da,stats:Z});h.onDone(null,Y);return Y}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,
"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":30,"./lib/webgl":33}]},{},[1]);

        </script>
        </body>
      </html>