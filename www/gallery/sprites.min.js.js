(function e$$0(p,y,h){function b(c,a){if(!y[c]){if(!p[c]){var e="function"==typeof require&&require;if(!a&&e)return e(c,!0);if(n)return n(c,!0);e=Error("Cannot find module '"+c+"'");throw e.code="MODULE_NOT_FOUND",e;}e=y[c]={exports:{}};p[c][0].call(e.exports,function(a){var e=p[c][1][a];return b(e?e:a)},e,e.exports,e$$0,p,y,h)}return y[c].exports}for(var n="function"==typeof require&&require,m=0;m<h.length;m++)b(h[m]);return b})({1:[function(f,p,y){var h=f("../regl")({extensions:"OES_texture_float"}),
b=f("mouse-change")(),n=Array(2).fill().map(function(){return h.framebuffer({radius:512,colorType:"float",depthStencil:!1})}),m=h({vert:"\n  precision mediump float;\n  attribute vec2 position;\n  void main () {\n    gl_Position = vec4(position, 0, 1);\n  }\n  ",frag:"\n  precision highp float;\n\n  uniform sampler2D state;\n  uniform float shapeX, shapeY, deltaT, gravity;\n\n  void main () {\n    vec2 shape = vec2(shapeX, shapeY);\n    vec4 prevState = texture2D(state,\n      gl_FragCoord.xy / shape);\n\n    vec2 position = prevState.xy;\n    vec2 velocity = prevState.zw;\n\n    position += 0.5 * velocity * deltaT;\n    if (position.x < -1.0 || position.x > 1.0) {\n      velocity.x *= -1.0;\n    }\n    if (position.y < -1.0 || position.y > 1.0) {\n      velocity.y *= -1.0;\n    }\n    position += 0.5 * velocity * deltaT;\n\n    velocity.y = velocity.y + gravity * deltaT;\n\n    gl_FragColor = vec4(position, velocity);\n  }\n  ",
depth:{enable:!1},framebuffer:function(c){return n[(c.tick+1)%2]},uniforms:{state:function(c){return n[c.tick%2]},shapeX:h.context("viewportWidth"),shapeY:h.context("viewportHeight"),deltaT:.1,gravity:-.5},attributes:{position:[0,-4,4,4,-4,4]},primitive:"triangles",elements:null,offset:0,count:3}),c=h({vert:"\n  precision highp float;\n  attribute vec2 sprite;\n  uniform sampler2D state;\n  varying vec2 rg;\n  void main () {\n    vec2 position = texture2D(state, sprite).xy;\n    gl_PointSize = 16.0;\n    rg = sprite;\n    gl_Position = vec4(position, 0, 1);\n  }\n  ",
frag:"\n  precision highp float;\n  varying vec2 rg;\n  void main () {\n    gl_FragColor = vec4(rg, 1.0 - max(rg.x, rg.y), 1);\n  }\n  ",attributes:{sprite:Array(262144).fill().map(function(c,b){return[b%512/512,(b/512|0)/512]}).reverse()},uniforms:{state:function(c){return n[c.tick%2]}},primitive:"points",offset:function(c,b){return 262144-b.count},elements:null,count:h.prop("count")}),a=0,e={data:new Float32Array(256),width:64,height:1},r=document.createElement("div");Object.assign(r.style,{color:"white",
position:"absolute",left:"20px",top:"20px","z-index":20});document.body.appendChild(r);h.frame(function(f){var z=f.tick,q=f.pixelRatio,k=Math.min(Math.max(2*q*b.x/f.drawingBufferWidth-1,-.999),.999);f=-Math.min(Math.max(2*q*b.y/f.drawingBufferHeight-1,-.999),.999);if(b.buttons){for(q=0;64>q;++q)e.data[4*q]=k,e.data[4*q+1]=f,e.data[4*q+2]=.25*(Math.random()-.5),e.data[4*q+3]=Math.random();n[z%2].color[0].subimage(e,a%512,(a/512|0)%512);a+=64;r.innerText=Math.min(a,262144)}m();h.clear({color:[0,0,0,
1],depth:1});c({count:Math.min(a,262144)})})},{"../regl":36,"mouse-change":34}],2:[function(f,p,y){function h(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}p.exports=function(b,n,m,c,a){b=m.maxAttributes;n=Array(b);for(m=0;m<b;++m)n[m]=new h;return{Record:h,scope:{},state:n}}},{}],3:[function(f,p,y){function h(c){return z[Object.prototype.toString.call(c)]|0}function b(c,b){for(var a=0;a<b.length;++a)c[a]=
b[a]}function n(c,b,a,e,h,m,n){for(var r=0,g=0;g<a;++g)for(var f=0;f<e;++f)c[r++]=b[h*g+m*f+n]}var m=f("./util/is-typed-array"),c=f("./util/is-ndarray"),a=f("./util/values"),e=f("./util/pool");y=f("./util/flatten");var r=y.flatten,R=y.shape,z=f("./constants/arraytypes.json"),q=f("./constants/dtypes.json"),k=f("./constants/usage.json"),F=[];F[5120]=1;F[5122]=2;F[5124]=4;F[5121]=1;F[5123]=2;F[5125]=4;F[5126]=4;p.exports=function(f,z,v){function l(c){this.id=J++;this.buffer=f.createBuffer();this.type=
c;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;v.profile&&(this.stats={size:0})}function B(c,b,a){c.byteLength=b.byteLength;f.bufferData(c.type,b,a)}function p(a,g,l,f,k,v){a.usage=l;if(Array.isArray(g)){if(a.dtype=f||5126,0<g.length)if(Array.isArray(g[0])){k=R(g);for(var L=f=1;L<k.length;++L)f*=k[L];a.dimension=f;g=r(g,k,a.dtype);B(a,g,l);v?a.persistentData=g:e.freeType(g)}else"number"===typeof g[0]?(a.dimension=k,k=e.allocType(a.dtype,g.length),b(k,
g),B(a,k,l),v?a.persistentData=k:e.freeType(k)):m(g[0])&&(a.dimension=g[0].length,a.dtype=f||h(g[0])||5126,g=r(g,[g.length,g[0].length],a.dtype),B(a,g,l),v?a.persistentData=g:e.freeType(g))}else if(m(g))a.dtype=f||h(g),a.dimension=k,B(a,g,l),v&&(a.persistentData=new Uint8Array(new Uint8Array(g.buffer)));else if(c(g)){k=g.shape;var G=g.stride,L=g.offset,q=0,u=0,W=0,w=0;1===k.length?(q=k[0],u=1,W=G[0],w=0):2===k.length&&(q=k[0],u=k[1],W=G[0],w=G[1]);a.dtype=f||h(g.data)||5126;a.dimension=u;k=e.allocType(a.dtype,
q*u);n(k,g.data,q,u,W,w,L);B(a,k,l);v?a.persistentData=k:e.freeType(k)}}function G(c){z.bufferCount--;f.deleteBuffer(c.buffer);c.buffer=null;delete g[c.id]}var J=0,g={};l.prototype.bind=function(){f.bindBuffer(this.type,this.buffer)};l.prototype.destroy=function(){G(this)};var N=[];v.profile&&(z.getTotalBufferSize=function(){var c=0;Object.keys(g).forEach(function(a){c+=g[a].stats.size});return c});return{create:function(a,B,J,N){function y(a){var b=35044,g=null,e=0,l=0,h=1;Array.isArray(a)||m(a)||
c(a)?g=a:"number"===typeof a?e=a|0:a&&("data"in a&&(g=a.data),"usage"in a&&(b=k[a.usage]),"type"in a&&(l=q[a.type]),"dimension"in a&&(h=a.dimension|0),"length"in a&&(e=a.length|0));E.bind();g?p(E,g,b,l,h,N):(f.bufferData(E.type,e,b),E.dtype=l||5121,E.usage=b,E.dimension=h,E.byteLength=e);v.profile&&(E.stats.size=E.byteLength*F[E.dtype]);return y}z.bufferCount++;var E=new l(B);g[E.id]=E;J||y(a);y._reglType="buffer";y._buffer=E;y.subdata=function(a,g){var l=(g||0)|0,u;E.bind();if(Array.isArray(a)){if(0<
a.length)if("number"===typeof a[0]){var k=e.allocType(E.dtype,a.length);b(k,a);f.bufferSubData(E.type,l,k);e.freeType(k)}else if(Array.isArray(a[0])||m(a[0]))u=R(a),k=r(a,u,E.dtype),f.bufferSubData(E.type,l,k),e.freeType(k)}else if(m(a))f.bufferSubData(E.type,l,a);else if(c(a)){u=a.shape;var v=a.stride,B=k=0,q=0,G=0;1===u.length?(k=u[0],B=1,q=v[0],G=0):2===u.length&&(k=u[0],B=u[1],q=v[0],G=v[1]);u=Array.isArray(a.data)?E.dtype:h(a.data);u=e.allocType(u,k*B);n(u,a.data,k,B,q,G,a.offset);f.bufferSubData(E.type,
l,u);e.freeType(u)}return y};v.profile&&(y.stats=E.stats);y.destroy=function(){G(E)};return y},createStream:function(a,c){var b=N.pop();b||(b=new l(a));b.bind();p(b,c,35040,0,1,!1);return b},destroyStream:function(a){N.push(a)},clear:function(){a(g).forEach(G);N.forEach(G)},getBuffer:function(a){return a&&a._buffer instanceof l?a._buffer:null},restore:function(){a(g).forEach(function(a){a.buffer=f.createBuffer();f.bindBuffer(a.type,a.buffer);f.bufferData(a.type,a.persistentData||a.byteLength,a.usage)})},
_initBuffer:p}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/flatten":24,"./util/is-ndarray":26,"./util/is-typed-array":27,"./util/pool":29,"./util/values":32}],4:[function(f,p,y){p.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},
{}],5:[function(f,p,y){p.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(f,p,y){p.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(f,p,y){p.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(f,p,y){function h(a){return Array.isArray(a)||R(a)||z(a)}function b(a){return a.sort(function(a,c){return"viewport"===a?-1:
"viewport"===c?1:a<c?-1:1})}function n(a,c,b,e){this.thisDep=a;this.contextDep=c;this.propDep=b;this.append=e}function m(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function c(a){return new n(!1,!1,!1,a)}function a(a,c){var b=a.type;return 0===b?(b=a.data.length,new n(!0,1<=b,2<=b,c)):4===b?(b=a.data,new n(b.thisDep,b.contextDep,b.propDep,c)):new n(3===b,2===b,1===b,c)}var e=f("./util/codegen"),r=f("./util/loop"),R=f("./util/is-typed-array"),z=f("./util/is-ndarray"),q=f("./util/is-array-like"),
k=f("./dynamic"),F=f("./constants/primitives.json"),w=f("./constants/dtypes.json"),K=["x","y","z","w"],v="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),l={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,
"one minus constant alpha":32772,"src alpha saturate":776},B={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},M={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},G={cw:2304,ccw:2305},J=new n(!1,!1,!1,function(){});p.exports=function(g,f,z,p,R,y,Ea,E,L,ia,sa,u,W,la,ea){function X(t){return t.replace(".","_")}
function S(t,a,c){var b=X(t);x.push(t);A[b]=d[b]=!!c;ta[b]=a}function I(t,a,b){var c=X(t);x.push(t);Array.isArray(b)?(d[c]=b.slice(),A[c]=b.slice()):d[c]=A[c]=b;ua[c]=a}function Z(){var a=e(),b=a.link,c=a.global;a.id=Pa++;a.batchId="0";var g=b(Oa),aa=a.shared={props:"a0"};Object.keys(Oa).forEach(function(a){aa[a]=c.def(g,".",a)});var H=a.next={},P=a.current={};Object.keys(ua).forEach(function(a){Array.isArray(d[a])&&(H[a]=c.def(aa.next,".",a),P[a]=c.def(aa.current,".",a))});var Qa=a.constants={};
Object.keys(La).forEach(function(a){Qa[a]=c.def(JSON.stringify(La[a]))});a.invoke=function(d,C){switch(C.type){case 0:var c=["this",aa.context,aa.props,a.batchId];return d.def(b(C.data),".call(",c.slice(0,Math.max(C.data.length+1,4)),")");case 1:return d.def(aa.props,C.data);case 2:return d.def(aa.context,C.data);case 3:return d.def("this",C.data);case 4:return C.data.append(a,d),C.data.ref}};a.attribCache={};var C={};a.scopeAttrib=function(a){a=f.id(a);if(a in C)return C[a];var d=ia.scope[a];d||
(d=ia.scope[a]=new xa);return C[a]=b(d)};return a}function ma(d){var b=d["static"];d=d.dynamic;var g;if("profile"in b){var e=!!b.profile;g=c(function(a,d){return e});g.enable=e}else if("profile"in d){var aa=d.profile;g=a(aa,function(a,d){return a.invoke(d,aa)})}return g}function va(d,b){var g=d["static"],e=d.dynamic;if("framebuffer"in g){var aa=g.framebuffer;return aa?(aa=E.getFramebuffer(aa),c(function(a,d){var C=a.link(aa),t=a.shared;d.set(t.framebuffer,".next",C);t=t.context;d.set(t,".framebufferWidth",
C+".width");d.set(t,".framebufferHeight",C+".height");return C})):c(function(a,d){var C=a.shared;d.set(C.framebuffer,".next","null");C=C.context;d.set(C,".framebufferWidth",C+".drawingBufferWidth");d.set(C,".framebufferHeight",C+".drawingBufferHeight");return"null"})}if("framebuffer"in e){var H=e.framebuffer;return a(H,function(a,d){var C=a.invoke(d,H),t=a.shared,b=t.framebuffer,C=d.def(b,".getFramebuffer(",C,")");d.set(b,".next",C);t=t.context;d.set(t,".framebufferWidth",C+"?"+C+".width:"+t+".drawingBufferWidth");
d.set(t,".framebufferHeight",C+"?"+C+".height:"+t+".drawingBufferHeight");return C})}return null}function U(d,b,c){function g(d){if(d in e){var C=e[d];d=!0;var t=C.x|0,c=C.y|0,P,Aa;"width"in C?P=C.width|0:d=!1;"height"in C?Aa=C.height|0:d=!1;return new n(!d&&b&&b.thisDep,!d&&b&&b.contextDep,!d&&b&&b.propDep,function(d,a){var b=d.shared.context,D=P;"width"in C||(D=a.def(b,".","framebufferWidth","-",t));var g=Aa;"height"in C||(g=a.def(b,".","framebufferHeight","-",c));return[t,c,D,g]})}if(d in H){var l=
H[d];d=a(l,function(d,a){var C=d.invoke(a,l),t=d.shared.context,b=a.def(C,".x|0"),c=a.def(C,".y|0"),D=a.def('"width" in ',C,"?",C,".width|0:","(",t,".","framebufferWidth","-",b,")"),C=a.def('"height" in ',C,"?",C,".height|0:","(",t,".","framebufferHeight","-",c,")");return[b,c,D,C]});b&&(d.thisDep=d.thisDep||b.thisDep,d.contextDep=d.contextDep||b.contextDep,d.propDep=d.propDep||b.propDep);return d}return b?new n(b.thisDep,b.contextDep,b.propDep,function(a,d){var C=a.shared.context;return[0,0,d.def(C,
".","framebufferWidth"),d.def(C,".","framebufferHeight")]}):null}var e=d["static"],H=d.dynamic;if(d=g("viewport")){var P=d;d=new n(d.thisDep,d.contextDep,d.propDep,function(a,d){var t=P.append(a,d),b=a.shared.context;d.set(b,".viewportWidth",t[2]);d.set(b,".viewportHeight",t[3]);return t})}return{viewport:d,scissor_box:g("scissor.box")}}function ga(d){function b(d){if(d in g){var C=f.id(g[d]);d=c(function(){return C});d.id=C;return d}if(d in e){var t=e[d];return a(t,function(d,a){var C=d.invoke(a,
t);return a.def(d.shared.strings,".id(",C,")")})}return null}var g=d["static"],e=d.dynamic,l=b("frag"),H=b("vert"),P=null;m(l)&&m(H)?(P=sa.program(H.id,l.id),d=c(function(d,a){return d.link(P)})):d=new n(l&&l.thisDep||H&&H.thisDep,l&&l.contextDep||H&&H.contextDep,l&&l.propDep||H&&H.propDep,function(d,a){var t=d.shared.shader,b;b=l?l.append(d,a):a.def(t,".","frag");var c;c=H?H.append(d,a):a.def(t,".","vert");return a.def(t+".program("+c+","+b+")")});return{frag:l,vert:H,progVar:d,program:P}}function ja(d,
b){function g(d,t){if(d in e){var b=e[d]|0;return c(function(d,a){t&&(d.OFFSET=b);return b})}if(d in l){var D=l[d];return a(D,function(d,a){var b=d.invoke(a,D);t&&(d.OFFSET=b);return b})}return t&&H?c(function(d,a){d.OFFSET="0";return 0}):null}var e=d["static"],l=d.dynamic,H=function(){if("elements"in e){var d=e.elements;h(d)?d=y.getElements(y.create(d,!0)):d&&(d=y.getElements(d));var b=c(function(a,b){if(d){var t=a.link(d);return a.ELEMENTS=t}return a.ELEMENTS=null});b.value=d;return b}if("elements"in
l){var t=l.elements;return a(t,function(d,a){var b=d.shared,C=b.isBufferArgs,b=b.elements,c=d.invoke(a,t),D=a.def("null"),C=a.def(C,"(",c,")"),c=d.cond(C).then(D,"=",b,".createStream(",c,");")["else"](D,"=",b,".getElements(",c,");");a.entry(c);a.exit(d.cond(C).then(b,".destroyStream(",D,");"));return d.ELEMENTS=D})}return null}(),P=g("offset",!0);return{elements:H,primitive:function(){if("primitive"in e){var d=e.primitive;return c(function(a,b){return F[d]})}if("primitive"in l){var b=l.primitive;
return a(b,function(d,a){var t=d.constants.primTypes,c=d.invoke(a,b);return a.def(t,"[",c,"]")})}return H?m(H)?H.value?c(function(d,a){return a.def(d.ELEMENTS,".primType")}):c(function(){return 4}):new n(H.thisDep,H.contextDep,H.propDep,function(d,a){var b=d.ELEMENTS;return a.def(b,"?",b,".primType:",4)}):null}(),count:function(){if("count"in e){var d=e.count|0;return c(function(){return d})}if("count"in l){var b=l.count;return a(b,function(d,a){return d.invoke(a,b)})}return H?m(H)?H?P?new n(P.thisDep,
P.contextDep,P.propDep,function(d,a){return a.def(d.ELEMENTS,".vertCount-",d.OFFSET)}):c(function(d,a){return a.def(d.ELEMENTS,".vertCount")}):c(function(){return-1}):new n(H.thisDep||P.thisDep,H.contextDep||P.contextDep,H.propDep||P.propDep,function(d,a){var b=d.ELEMENTS;return d.OFFSET?a.def(b,"?",b,".vertCount-",d.OFFSET,":-1"):a.def(b,"?",b,".vertCount:-1")}):null}(),instances:g("instances",!1),offset:P}}function pa(d,b){var g=d["static"],e=d.dynamic,A={};x.forEach(function(d){function b(C,D){if(d in
g){var l=C(g[d]);A[t]=c(function(){return l})}else if(d in e){var P=e[d];A[t]=a(P,function(d,a){return D(d,a,d.invoke(a,P))})}}var t=X(d);switch(d){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return b(function(d){return d},function(d,a,b){return b});case "depth.func":return b(function(d){return B[d]},function(d,a,b){return a.def(d.constants.compareFuncs,
"[",b,"]")});case "depth.range":return b(function(d){return d},function(d,a,b){d=a.def("+",b,"[0]");a=a.def("+",b,"[1]");return[d,a]});case "blend.func":return b(function(d){return[l["srcRGB"in d?d.srcRGB:d.src],l["dstRGB"in d?d.dstRGB:d.dst],l["srcAlpha"in d?d.srcAlpha:d.src],l["dstAlpha"in d?d.dstAlpha:d.dst]]},function(d,a,b){function t(d,c){return a.def('"',d,c,'" in ',b,"?",b,".",d,c,":",b,".",d)}d=d.constants.blendFuncs;var c=t("src","RGB"),D=t("dst","RGB"),c=a.def(d,"[",c,"]"),g=a.def(d,"[",
t("src","Alpha"),"]"),D=a.def(d,"[",D,"]");d=a.def(d,"[",t("dst","Alpha"),"]");return[c,D,g,d]});case "blend.equation":return b(function(d){if("string"===typeof d)return[ba[d],ba[d]];if("object"===typeof d)return[ba[d.rgb],ba[d.alpha]]},function(d,a,b){var t=d.constants.blendEquations,c=a.def(),D=a.def();d=d.cond("typeof ",b,'==="string"');d.then(c,"=",D,"=",t,"[",b,"];");d["else"](c,"=",t,"[",b,".rgb];",D,"=",t,"[",b,".alpha];");a(d);return[c,D]});case "blend.color":return b(function(d){return r(4,
function(a){return+d[a]})},function(d,a,b){return r(4,function(d){return a.def("+",b,"[",d,"]")})});case "stencil.mask":return b(function(d){return d|0},function(d,a,b){return a.def(b,"|0")});case "stencil.func":return b(function(d){return[B[d.cmp||"keep"],d.ref||0,"mask"in d?d.mask:-1]},function(d,a,b){d=a.def('"cmp" in ',b,"?",d.constants.compareFuncs,"[",b,".cmp]",":",7680);var t=a.def(b,".ref|0");a=a.def('"mask" in ',b,"?",b,".mask|0:-1");return[d,t,a]});case "stencil.opFront":case "stencil.opBack":return b(function(a){return["stencil.opBack"===
d?1029:1028,M[a.fail||"keep"],M[a.zfail||"keep"],M[a.zpass||"keep"]]},function(a,b,t){function c(d){return b.def('"',d,'" in ',t,"?",D,"[",t,".",d,"]:",7680)}var D=a.constants.stencilOps;return["stencil.opBack"===d?1029:1028,c("fail"),c("zfail"),c("zpass")]});case "polygonOffset.offset":return b(function(d){return[d.factor|0,d.units|0]},function(d,a,b){d=a.def(b,".factor|0");a=a.def(b,".units|0");return[d,a]});case "cull.face":return b(function(d){var a=0;"front"===d?a=1028:"back"===d&&(a=1029);return a},
function(d,a,b){return a.def(b,'==="front"?',1028,":",1029)});case "lineWidth":return b(function(d){return d},function(d,a,b){return b});case "frontFace":return b(function(d){return G[d]},function(d,a,b){return a.def(b+'==="cw"?2304:2305')});case "colorMask":return b(function(d){return d.map(function(d){return!!d})},function(d,a,b){return r(4,function(d){return"!!"+b+"["+d+"]"})});case "sample.coverage":return b(function(d){return["value"in d?d.value:1,!!d.invert]},function(d,a,b){d=a.def('"value" in ',
b,"?+",b,".value:1");a=a.def("!!",b,".invert");return[d,a]})}});return A}function qa(d,b){var g=d["static"],e=d.dynamic,l={};Object.keys(g).forEach(function(d){var a=g[d],b;if("number"===typeof a||"boolean"===typeof a)b=c(function(){return a});else if("function"===typeof a){var t=a._reglType;if("texture2d"===t||"textureCube"===t)b=c(function(d){return d.link(a)});else if("framebuffer"===t||"framebufferCube"===t)b=c(function(d){return d.link(a.color[0])})}else q(a)&&(b=c(function(d){return d.global.def("[",
r(a.length,function(d){return a[d]}),"]")}));b.value=a;l[d]=b});Object.keys(e).forEach(function(d){var b=e[d];l[d]=a(b,function(d,a){return d.invoke(a,b)})});return l}function ca(d,b){var g=d["static"],e=d.dynamic,l={};Object.keys(g).forEach(function(d){var a=g[d],b=f.id(d),t=new xa;if(h(a))t.state=1,t.buffer=R.getBuffer(R.create(a,34962,!1,!0)),t.type=0;else{var D=R.getBuffer(a);if(D)t.state=1,t.buffer=D,t.type=0;else if(a.constant){var e=a.constant;t.buffer="null";t.state=2;"number"===typeof e?
t.x=e:K.forEach(function(d,a){a<e.length&&(t[d]=e[a])})}else{var D=h(a.buffer)?R.getBuffer(R.create(a.buffer,34962,!1,!0)):R.getBuffer(a.buffer),A=a.offset|0,x=a.stride|0,k=a.size|0,u=!!a.normalized,m=0;"type"in a&&(m=w[a.type]);a=a.divisor|0;t.buffer=D;t.state=1;t.size=k;t.normalized=u;t.type=m||D.dtype;t.offset=A;t.stride=x;t.divisor=a}}l[d]=c(function(d,a){var c=d.attribCache;if(b in c)return c[b];var D={isStream:!1};Object.keys(t).forEach(function(d){D[d]=t[d]});t.buffer&&(D.buffer=d.link(t.buffer),
D.type=D.type||D.buffer+".dtype");return c[b]=D})});Object.keys(e).forEach(function(d){var b=e[d];l[d]=a(b,function(d,a){function t(d){a(l[d],"=",c,".",d,"|0;")}var c=d.invoke(a,b),D=d.shared,e=D.isBufferArgs,g=D.buffer,l={isStream:a.def(!1)},A=new xa;A.state=1;Object.keys(A).forEach(function(d){l[d]=a.def(""+A[d])});var x=l.buffer,Aa=l.type;a("if(",e,"(",c,")){",l.isStream,"=true;",x,"=",g,".createStream(",34962,",",c,");",Aa,"=",x,".dtype;","}else{",x,"=",g,".getBuffer(",c,");","if(",x,"){",Aa,
"=",x,".dtype;",'}else if("constant" in ',c,"){",l.state,"=",2,";","if(typeof "+c+'.constant === "number"){',l[K[0]],"=",c,".constant;",K.slice(1).map(function(d){return l[d]}).join("="),"=0;","}else{",K.map(function(d,a){return l[d]+"="+c+".constant.length>="+a+"?"+c+".constant["+a+"]:0;"}).join(""),"}}else{","if(",e,"(",c,".buffer)){",x,"=",g,".createStream(",34962,",",c,".buffer);","}else{",x,"=",g,".getBuffer(",c,".buffer);","}",Aa,'="type" in ',c,"?",D.glTypes,"[",c,".type]:",x,".dtype;",l.normalized,
"=!!",c,".normalized;");t("size");t("offset");t("stride");t("divisor");a("}}");a.exit("if(",l.isStream,"){",g,".destroyStream(",x,");","}");return l})});return l}function ha(d){var b=d["static"],g=d.dynamic,e={};Object.keys(b).forEach(function(d){var a=b[d];e[d]=c(function(d,b){return"number"===typeof a||"boolean"===typeof a?""+a:d.link(a)})});Object.keys(g).forEach(function(d){var b=g[d];e[d]=a(b,function(d,a){return d.invoke(a,b)})});return e}function ka(d,a,b,c,e){var g=va(d,e),l=U(d,g,e),x=ja(d,
e),A=pa(d,e),k=ga(d,e),f=l.viewport;f&&(A.viewport=f);f=X("scissor.box");(l=l[f])&&(A[f]=l);l=0<Object.keys(A).length;g={framebuffer:g,draw:x,shader:k,state:A,dirty:l};g.profile=ma(d,e);g.uniforms=qa(b,e);g.attributes=ca(a,e);g.context=ha(c,e);return g}function da(d,a,b){var c=d.shared.context,e=d.scope();Object.keys(b).forEach(function(g){a.save(c,"."+g);e(c,".",g,"=",b[g].append(d,a),";")});a(e)}function O(d,a,b,c){var e=d.shared,g=e.gl,l=e.framebuffer,x;na&&(x=a.def(e.extensions,".webgl_draw_buffers"));
var A=d.constants,e=A.drawBuffer,A=A.backBuffer;d=b?b.append(d,a):a.def(l,".next");c||a("if(",d,"!==",l,".cur){");a("if(",d,"){",g,".bindFramebuffer(",36160,",",d,".framebuffer);");na&&a(x,".drawBuffersWEBGL(",e,"[",d,".colorAttachments.length]);");a("}else{",g,".bindFramebuffer(",36160,",null);");na&&a(x,".drawBuffersWEBGL(",A,");");a("}",l,".cur=",d,";");c||a("}")}function fa(a,b,c){var e=a.shared,g=e.gl,l=a.current,A=a.next,f=e.current,k=e.next,h=a.cond(f,".dirty");x.forEach(function(b){b=X(b);
if(!(b in c.state)){var e,D;if(b in A){e=A[b];D=l[b];var x=r(d[b].length,function(d){return h.def(e,"[",d,"]")});h(a.cond(x.map(function(d,a){return d+"!=="+D+"["+a+"]"}).join("||")).then(g,".",ua[b],"(",x,");",x.map(function(d,a){return D+"["+a+"]="+d}).join(";"),";"))}else e=h.def(k,".",b),x=a.cond(e,"!==",f,".",b),h(x),b in ta?x(a.cond(e).then(g,".enable(",ta[b],");")["else"](g,".disable(",ta[b],");"),f,".",b,"=",e,";"):x(g,".",ua[b],"(",e,");",f,".",b,"=",e,";")}});0===Object.keys(c.state).length&&
h(f,".dirty=false;");b(h)}function Q(d,a,c,e){var g=d.shared,l=d.current,x=g.current,A=g.gl;b(Object.keys(c)).forEach(function(b){var g=c[b];if(!e||e(g)){var f=g.append(d,a);if(ta[b]){var h=ta[b];m(g)?f?a(A,".enable(",h,");"):a(A,".disable(",h,");"):a(d.cond(f).then(A,".enable(",h,");")["else"](A,".disable(",h,");"));a(x,".",b,"=",f,";")}else if(q(f)){var k=l[b];a(A,".",ua[b],"(",f,");",f.map(function(d,a){return k+"["+a+"]="+d}).join(";"),";")}else a(A,".",ua[b],"(",f,");",x,".",b,"=",f,";")}})}
function oa(d,a){ra&&(d.instancing=a.def(d.shared.extensions,".angle_instanced_arrays"))}function V(d,a,b,c,e){function g(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function l(d){n=a.def();d(n,"=",g(),";");"string"===typeof e?d(h,".count+=",e,";"):d(h,".count++;");la&&(c?(r=a.def(),d(r,"=",u,".getNumPendingQueries();")):d(u,".beginQuery(",h,");"))}function x(d){d(h,".cpuTime+=",g(),"-",n,";");la&&(c?d(u,".pushScopeStats(",r,",",u,".getNumPendingQueries(),",h,");"):d(u,
".endQuery();"))}function A(d){var b=a.def(k,".profile");a(k,".profile=",d,";");a.exit(k,".profile=",b,";")}var f=d.shared,h=d.stats,k=f.current,u=f.timer;b=b.profile;var n,r;if(b){if(m(b)){b.enable?(l(a),x(a.exit),A("true")):A("false");return}b=b.append(d,a);A(b)}else b=a.def(k,".profile");f=d.block();l(f);a("if(",b,"){",f,"}");d=d.block();x(d);a.exit("if(",b,"){",d,"}")}function Y(d,a,b,c,e){function g(d){switch(d){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;
case 35666:case 35669:case 35673:return 4;default:return 1}}function l(b,c,e){function g(){a("if(!",k,".buffer){",f,".enableVertexAttribArray(",h,");}");var b=e.type,l;l=e.size?a.def(e.size,"||",c):c;a("if(",k,".type!==",b,"||",k,".size!==",l,"||",m.map(function(d){return k+"."+d+"!=="+e[d]}).join("||"),"){",f,".bindBuffer(",34962,",",u,".buffer);",f,".vertexAttribPointer(",[h,l,b,e.normalized,e.stride,e.offset],");",k,".type=",b,";",k,".size=",l,";",m.map(function(d){return k+"."+d+"="+e[d]+";"}).join(""),
"}");ra&&(b=e.divisor,a("if(",k,".divisor!==",b,"){",d.instancing,".vertexAttribDivisorANGLE(",[h,b],");",k,".divisor=",b,";}"))}function x(){a("if(",k,".buffer){",f,".disableVertexAttribArray(",h,");","}if(",K.map(function(d,a){return k+"."+d+"!=="+n[a]}).join("||"),"){",f,".vertexAttrib4f(",h,",",n,");",K.map(function(d,a){return k+"."+d+"="+n[a]+";"}).join(""),"}")}var f=A.gl,h=a.def(b,".location"),k=a.def(A.attributes,"[",h,"]");b=e.state;var u=e.buffer,n=[e.x,e.y,e.z,e.w],m=["buffer","normalized",
"offset","stride"];1===b?g():2===b?x():(a("if(",b,"===",1,"){"),g(),a("}else{"),x(),a("}"))}var A=d.shared;c.forEach(function(c){var A=c.name,x=b.attributes[A],f;if(x){if(!e(x))return;f=x.append(d,a)}else{if(!e(J))return;var k=d.scopeAttrib(A);f={};Object.keys(new xa).forEach(function(d){f[d]=a.def(k,".",d)})}l(d.link(c),g(c.info.type),f)})}function T(d,a,b,c,e){for(var g=d.shared,l=g.gl,x,A=0;A<c.length;++A){var k=c[A],h=k.name,u=k.info.type,n=b.uniforms[h],k=d.link(k)+".location",v;if(n){if(!e(n))continue;
if(m(n)){h=n.value;if(35678===u||35680===u)u=d.link(h._texture||h.color[0]._texture),a(l,".uniform1i(",k,",",u+".bind());"),a.exit(u,".unbind();");else if(35674===u||35675===u||35676===u)h=d.global.def("new Float32Array(["+Array.prototype.slice.call(h)+"])"),n=2,35675===u?n=3:35676===u&&(n=4),a(l,".uniformMatrix",n,"fv(",k,",false,",h,");");else{switch(u){case 5126:x="1f";break;case 35664:x="2f";break;case 35665:x="3f";break;case 35666:x="4f";break;case 35670:x="1i";break;case 5124:x="1i";break;case 35671:x=
"2i";break;case 35667:x="2i";break;case 35672:x="3i";break;case 35668:x="3i";break;case 35673:x="4i";break;case 35669:x="4i"}a(l,".uniform",x,"(",k,",",q(h)?Array.prototype.slice.call(h):h,");")}continue}else v=n.append(d,a)}else{if(!e(J))continue;v=a.def(g.uniforms,"[",f.id(h),"]")}35678===u?a("if(",v,"&&",v,'._reglType==="framebuffer"){',v,"=",v,".color[0];","}"):35680===u&&a("if(",v,"&&",v,'._reglType==="framebufferCube"){',v,"=",v,".color[0];","}");h=1;switch(u){case 35678:case 35680:u=a.def(v,
"._texture");a(l,".uniform1i(",k,",",u,".bind());");a.exit(u,".unbind();");continue;case 5124:case 35670:x="1i";break;case 35667:case 35671:x="2i";h=2;break;case 35668:case 35672:x="3i";h=3;break;case 35669:case 35673:x="4i";h=4;break;case 5126:x="1f";break;case 35664:x="2f";h=2;break;case 35665:x="3f";h=3;break;case 35666:x="4f";h=4;break;case 35674:x="Matrix2fv";break;case 35675:x="Matrix3fv";break;case 35676:x="Matrix4fv"}a(l,".uniform",x,"(",k,",");if("M"===x.charAt(0)){var k=Math.pow(u-35674+
2,2),B=d.global.def("new Float32Array(",k,")");a("false,(Array.isArray(",v,")||",v," instanceof Float32Array)?",v,":(",r(k,function(d){return B+"["+d+"]="+v+"["+d+"]"}),",",B,")")}else 1<h?a(r(h,function(d){return v+"["+d+"]"})):a(v);a(");")}}function Fa(d,a,b,c){function e(g){var l=k[g];return l?l.contextDep&&c.contextDynamic||l.propDep?l.append(d,b):l.append(d,a):a.def(h,".",g)}function g(){function d(){b(B,".drawElementsInstancedANGLE(",[u,v,q,n+"<<(("+q+"-5121)>>1)",r],");")}function a(){b(B,
".drawArraysInstancedANGLE(",[u,n,v,r],");")}f?G?d():(b("if(",f,"){"),d(),b("}else{"),a(),b("}")):a()}function l(){function d(){b(A+".drawElements("+[u,v,q,n+"<<(("+q+"-5121)>>1)"]+");")}function a(){b(A+".drawArrays("+[u,n,v]+");")}f?G?d():(b("if(",f,"){"),d(),b("}else{"),a(),b("}")):a()}var x=d.shared,A=x.gl,h=x.draw,k=c.draw,f=function(){var e=k.elements,g=a;if(e){if(e.contextDep&&c.contextDynamic||e.propDep)g=b;e=e.append(d,g)}else e=g.def(h,".","elements");e&&g("if("+e+")"+A+".bindBuffer(34963,"+
e+".buffer.buffer);");return e}(),u=e("primitive"),n=e("offset"),v=function(){var e=k.count,g=a;if(e){if(e.contextDep&&c.contextDynamic||e.propDep)g=b;e=e.append(d,g)}else e=g.def(h,".","count");return e}();if("number"===typeof v){if(0===v)return}else b("if(",v,"){"),b.exit("}");var r,B;ra&&(r=e("instances"),B=d.instancing);var q=f+".type",G=k.elements&&m(k.elements);ra&&("number"!==typeof r||0<=r)?"string"===typeof r?(b("if(",r,">0){"),g(),b("}else if(",r,"<0){"),l(),b("}")):g():l()}function Ba(d,
a,b,c,e){a=Z();e=a.proc("body",e);ra&&(a.instancing=e.def(a.shared.extensions,".angle_instanced_arrays"));d(a,e,b,c);return a.compile().body}function Ca(d,a,b,c){oa(d,a);Y(d,a,b,c.attributes,function(){return!0});T(d,a,b,c.uniforms,function(){return!0});Fa(d,a,a,b)}function Ga(d,a){var b=d.proc("draw",1);oa(d,b);da(d,b,a.context);O(d,b,a.framebuffer);fa(d,b,a);Q(d,b,a.state);V(d,b,a,!1,!0);var c=a.shader.progVar.append(d,b);b(d.shared.gl,".useProgram(",c,".program);");if(a.shader.program)Ca(d,b,a,
a.shader.program);else{var e=d.global.def("{}"),g=b.def(c,".id"),l=b.def(e,"[",g,"]");b(d.cond(l).then(l,".call(this,a0);")["else"](l,"=",e,"[",g,"]=",d.link(function(b){return Ba(Ca,d,a,b,1)}),"(",c,");",l,".call(this,a0);"))}0<Object.keys(a.state).length&&b(d.shared.current,".dirty=true;")}function Ha(d,a,b,c){function e(){return!0}d.batchId="a1";oa(d,a);Y(d,a,b,c.attributes,e);T(d,a,b,c.uniforms,e);Fa(d,a,a,b)}function ya(d,a,b,c){function e(d){return d.contextDep&&l||d.propDep}function g(d){return!e(d)}
oa(d,a);var l=b.contextDep,x=a.def(),A=a.def();d.shared.props=A;d.batchId=x;var h=d.scope(),k=d.scope();a(h.entry,"for(",x,"=0;",x,"<","a1",";++",x,"){",A,"=","a0","[",x,"];",k,"}",h.exit);b.needsContext&&da(d,k,b.context);b.needsFramebuffer&&O(d,k,b.framebuffer);Q(d,k,b.state,e);b.profile&&e(b.profile)&&V(d,k,b,!1,!0);c?(Y(d,h,b,c.attributes,g),Y(d,k,b,c.attributes,e),T(d,h,b,c.uniforms,g),T(d,k,b,c.uniforms,e),Fa(d,h,k,b)):(a=d.global.def("{}"),c=b.shader.progVar.append(d,k),A=k.def(c,".id"),h=
k.def(a,"[",A,"]"),k(d.shared.gl,".useProgram(",c,".program);","if(!",h,"){",h,"=",a,"[",A,"]=",d.link(function(a){return Ba(Ha,d,b,a,2)}),"(",c,");}",h,".call(this,a0[",x,"],",x,");"))}function za(d,a){function b(d){return d.contextDep&&e||d.propDep}var c=d.proc("batch",2);d.batchId="0";oa(d,c);var e=!1,g=!0;Object.keys(a.context).forEach(function(d){e=e||a.context[d].propDep});e||(da(d,c,a.context),g=!1);var l=a.framebuffer,x=!1;l?(l.propDep?e=x=!0:l.contextDep&&e&&(x=!0),x||O(d,c,l)):O(d,c,null);
a.state.viewport&&a.state.viewport.propDep&&(e=!0);fa(d,c,a);Q(d,c,a.state,function(d){return!b(d)});a.profile&&b(a.profile)||V(d,c,a,!1,"a1");a.contextDep=e;a.needsContext=g;a.needsFramebuffer=x;g=a.shader.progVar;if(g.contextDep&&e||g.propDep)ya(d,c,a,null);else if(g=g.append(d,c),c(d.shared.gl,".useProgram(",g,".program);"),a.shader.program)ya(d,c,a,a.shader.program);else{var l=d.global.def("{}"),x=c.def(g,".id"),k=c.def(l,"[",x,"]");c(d.cond(k).then(k,".call(this,a0,a1);")["else"](k,"=",l,"[",
x,"]=",d.link(function(b){return Ba(ya,d,a,b,2)}),"(",g,");",k,".call(this,a0,a1);"))}0<Object.keys(a.state).length&&c(d.shared.current,".dirty=true;")}function Na(d,a){function c(b){var l=a.shader[b];l&&e.set(g.shader,"."+b,l.append(d,e))}var e=d.proc("scope",3);d.batchId="a2";var g=d.shared,l=g.current;da(d,e,a.context);a.framebuffer&&a.framebuffer.append(d,e);b(Object.keys(a.state)).forEach(function(b){var c=a.state[b].append(d,e);q(c)?c.forEach(function(a,c){e.set(d.next[b],"["+c+"]",a)}):e.set(g.next,
"."+b,c)});V(d,e,a,!0,!0);["elements","offset","count","instances","primitive"].forEach(function(b){var c=a.draw[b];c&&e.set(g.draw,"."+b,""+c.append(d,e))});Object.keys(a.uniforms).forEach(function(b){e.set(g.uniforms,"["+f.id(b)+"]",a.uniforms[b].append(d,e))});Object.keys(a.attributes).forEach(function(b){var c=a.attributes[b].append(d,e),g=d.scopeAttrib(b);Object.keys(new xa).forEach(function(d){e.set(g,"."+d,c[d])})});c("vert");c("frag");0<Object.keys(a.state).length&&(e(l,".dirty=true;"),e.exit(l,
".dirty=true;"));e("a1(",d.shared.context,",a0,",d.batchId,");")}function Ma(d){if("object"===typeof d&&!q(d)){for(var a=Object.keys(d),b=0;b<a.length;++b)if(k.isDynamic(d[a[b]]))return!0;return!1}}function Ia(d,b,c){function e(d,a){x.forEach(function(b){var c=g[b];k.isDynamic(c)&&(c=d.invoke(a,c),a(u,".",b,"=",c,";"))})}var g=b["static"][c];if(g&&Ma(g)){var l=d.global,x=Object.keys(g),A=!1,h=!1,f=!1,u=d.global.def("{}");x.forEach(function(b){var c=g[b];if(k.isDynamic(c))"function"===typeof c&&(c=
g[b]=k.unbox(c)),b=a(c,null),A=A||b.thisDep,f=f||b.propDep,h=h||b.contextDep;else{l(u,".",b,"=");switch(typeof c){case "number":l(c);break;case "string":l('"',c,'"');break;case "object":Array.isArray(c)&&l("[",c.join(),"]");break;default:l(d.link(c))}l(";")}});b.dynamic[c]=new k.DynamicVariable(4,{thisDep:A,contextDep:h,propDep:f,ref:u,append:e});delete b["static"][c]}}var xa=ia.Record,ba={add:32774,subtract:32778,"reverse subtract":32779};z.ext_blend_minmax&&(ba.min=32775,ba.max=32776);var ra=z.angle_instanced_arrays,
na=z.webgl_draw_buffers,d={dirty:!0,profile:ea.profile},A={},x=[],ta={},ua={};S("dither",3024);S("blend.enable",3042);I("blend.color","blendColor",[0,0,0,0]);I("blend.equation","blendEquationSeparate",[32774,32774]);I("blend.func","blendFuncSeparate",[1,0,1,0]);S("depth.enable",2929,!0);I("depth.func","depthFunc",513);I("depth.range","depthRange",[0,1]);I("depth.mask","depthMask",!0);I("colorMask","colorMask",[!0,!0,!0,!0]);S("cull.enable",2884);I("cull.face","cullFace",1029);I("frontFace","frontFace",
2305);I("lineWidth","lineWidth",1);S("polygonOffset.enable",32823);I("polygonOffset.offset","polygonOffset",[0,0]);S("sample.alpha",32926);S("sample.enable",32928);I("sample.coverage","sampleCoverage",[1,!1]);S("stencil.enable",2960);I("stencil.mask","stencilMask",-1);I("stencil.func","stencilFunc",[519,0,-1]);I("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);I("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);S("scissor.enable",3089);I("scissor.box","scissor",[0,0,g.drawingBufferWidth,
g.drawingBufferHeight]);I("viewport","viewport",[0,0,g.drawingBufferWidth,g.drawingBufferHeight]);var Oa={gl:g,context:W,strings:f,next:A,current:d,draw:u,elements:y,buffer:R,shader:sa,attributes:ia.state,uniforms:L,framebuffer:E,extensions:z,timer:la,isBufferArgs:h},La={primTypes:F,compareFuncs:B,blendFuncs:l,blendEquations:ba,stencilOps:M,glTypes:w,orientationType:G};na&&(La.backBuffer=[1029],La.drawBuffer=r(p.maxDrawbuffers,function(d){return 0===d?[0]:r(d,function(d){return 36064+d})}));var Pa=
0;return{next:A,current:d,procs:function(){var a=Z(),b=a.proc("poll"),c=a.proc("refresh"),e=a.block();b(e);c(e);var l=a.shared,x=l.gl,k=l.next,A=l.current;e(A,".dirty=false;");O(a,b);O(a,c,null,!0);var h=g.getExtension("angle_instanced_arrays"),f;h&&(f=a.link(h));for(var u=0;u<p.maxAttributes;++u){var n=c.def(l.attributes,"[",u,"]"),v=a.cond(n,".buffer");v.then(x,".enableVertexAttribArray(",u,");",x,".bindBuffer(",34962,",",n,".buffer.buffer);",x,".vertexAttribPointer(",u,",",n,".size,",n,".type,",
n,".normalized,",n,".stride,",n,".offset);")["else"](x,".disableVertexAttribArray(",u,");",x,".vertexAttrib4f(",u,",",n,".x,",n,".y,",n,".z,",n,".w);",n,".buffer=null;");c(v);h&&c(f,".vertexAttribDivisorANGLE(",u,",",n,".divisor);")}Object.keys(ta).forEach(function(d){var g=ta[d],l=e.def(k,".",d),h=a.block();h("if(",l,"){",x,".enable(",g,")}else{",x,".disable(",g,")}",A,".",d,"=",l,";");c(h);b("if(",l,"!==",A,".",d,"){",h,"}")});Object.keys(ua).forEach(function(g){var l=ua[g],h=d[g],f,u,n=a.block();
n(x,".",l,"(");q(h)?(l=h.length,f=a.global.def(k,".",g),u=a.global.def(A,".",g),n(r(l,function(d){return f+"["+d+"]"}),");",r(l,function(d){return u+"["+d+"]="+f+"["+d+"];"}).join("")),b("if(",r(l,function(d){return f+"["+d+"]!=="+u+"["+d+"]"}).join("||"),"){",n,"}")):(f=e.def(k,".",g),u=e.def(A,".",g),n(f,");",A,".",g,"=",f,";"),b("if(",f,"!==",u,"){",n,"}"));c(n)});return a.compile()}(),compile:function(d,a,b,c,e){var g=Z();g.stats=g.link(e);Object.keys(a["static"]).forEach(function(d){Ia(g,a,d)});
v.forEach(function(a){Ia(g,d,a)});b=ka(d,a,b,c,g);Ga(g,b);Na(g,b);za(g,b);return g.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./dynamic":9,"./util/codegen":22,"./util/is-array-like":25,"./util/is-ndarray":26,"./util/is-typed-array":27,"./util/loop":28}],9:[function(f,p,y){function h(b,a){this.id=m++;this.type=b;this.data=a}function b(c){if(0===c.length)return[];var a=c.charAt(0),e=c.charAt(c.length-1);if(1<c.length&&a===e&&('"'===a||"'"===a))return['"'+c.substr(1,
c.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(a=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(c))return b(c.substr(0,a.index)).concat(b(a[1])).concat(b(c.substr(a.index+a[0].length)));a=c.split(".");if(1===a.length)return['"'+c.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];c=[];for(e=0;e<a.length;++e)c=c.concat(b(a[e]));return c}function n(c){return"["+b(c).join("][")+"]"}var m=0;p.exports={DynamicVariable:h,define:function(b,a){return new h(b,n(a+""))},isDynamic:function(b){return"function"===
typeof b&&!b._reglType||b instanceof h},unbox:function(b,a){return"function"===typeof b?new h(0,b):b},accessor:n}},{}],10:[function(f,p,y){var h=f("./util/is-typed-array"),b=f("./util/is-ndarray"),n=f("./util/values"),m=f("./constants/primitives.json"),c=f("./constants/usage.json");p.exports=function(a,e,f,p){function z(a){this.id=w++;F[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function q(c,k,n,v,m,g,q){c.buffer.bind();if(k){var w=q;q||h(k)&&(!b(k)||h(k.data))||(w=e.oes_element_index_uint?
5125:5123);f._initBuffer(c.buffer,k,n,w,3)}else a.bufferData(34963,g,n),c.buffer.dtype=w||5121,c.buffer.usage=n,c.buffer.dimension=3,c.buffer.byteLength=g;w=q;if(!q){switch(c.buffer.dtype){case 5121:case 5120:w=5121;break;case 5123:case 5122:w=5123;break;case 5125:case 5124:w=5125}c.buffer.dtype=w}c.type=w;k=m;0>k&&(k=c.buffer.byteLength,5123===w?k>>=1:5125===w&&(k>>=2));c.vertCount=k;k=v;0>v&&(k=4,v=c.buffer.dimension,1===v&&(k=0),2===v&&(k=1),3===v&&(k=4));c.primType=k}function k(a){p.elementsCount--;
delete F[a.id];a.buffer.destroy();a.buffer=null}var F={},w=0,K={uint8:5121,uint16:5123};e.oes_element_index_uint&&(K.uint32=5125);z.prototype.bind=function(){this.buffer.bind()};var v=[];return{create:function(a,e){function n(a){if(a)if("number"===typeof a)v(a),w.primType=4,w.vertCount=a|0,w.type=5121;else{var e=null,l=35044,k=-1,f=-1,r=0,B=0;if(Array.isArray(a)||h(a)||b(a))e=a;else if("data"in a&&(e=a.data),"usage"in a&&(l=c[a.usage]),"primitive"in a&&(k=m[a.primitive]),"count"in a&&(f=a.count|0),
"type"in a&&(B=K[a.type]),"length"in a)r=a.length|0;else if(r=f,5123===B||5122===B)r*=2;else if(5125===B||5124===B)r*=4;q(w,e,l,k,f,r,B)}else v(),w.primType=4,w.vertCount=0,w.type=5121;return n}var v=f.create(null,34963,!0),w=new z(v._buffer);p.elementsCount++;n(a);n._reglType="elements";n._elements=w;n.subdata=function(a,b){v.subdata(a,b);return n};n.destroy=function(){k(w)};return n},createStream:function(a){var b=v.pop();b||(b=new z(f.create(null,34963,!0,!1)._buffer));q(b,a,35040,-1,-1,0,0);return b},
destroyStream:function(a){v.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof z?a._elements:null},clear:function(){n(F).forEach(k)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":26,"./util/is-typed-array":27,"./util/values":32}],11:[function(f,p,y){p.exports=function(h,b){function f(a){a=a.toLowerCase();var b;try{b=m[a]=h.getExtension(a)}catch(c){}return!!b}for(var m={},c=0;c<b.extensions.length;++c){var a=b.extensions[c];if(!f(a))return b.onDestroy(),
b.onDone('"'+a+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}b.optionalExtensions.forEach(f);return{extensions:m,restore:function(){Object.keys(m).forEach(function(a){if(!f(a))throw Error("(regl): error restoring extension "+a);})}}}},{}],12:[function(f,p,y){var h=f("./util/values"),b=f("./util/extend"),n=[];n[6408]=4;var m=[];m[5121]=1;m[5126]=4;m[36193]=2;p.exports=function(c,a,e,f,p,z){function q(a,b,c){this.target=a;this.texture=
b;this.renderbuffer=c;var e=a=0;b?(a=b.width,e=b.height):c&&(a=c.width,e=c.height);this.width=a;this.height=e}function k(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function F(a,b,c){a&&(a.texture?a.texture._texture.refCount+=1:a.renderbuffer._renderbuffer.refCount+=1)}function w(a,b){b&&(b.texture?c.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,0):c.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer))}
function K(a){var b=3553,c=null,e=null,g=a;"object"===typeof a&&(g=a.data,"target"in a&&(b=a.target|0));a=g._reglType;"texture2d"===a?c=g:"textureCube"===a?c=g:"renderbuffer"===a&&(e=g,b=36161);return new q(b,c,e)}function v(a,b,c,e,g){if(c)return a=f.create2D({width:a,height:b,format:e,type:g}),a._texture.refCount=0,new q(3553,a,null);a=p.create({width:a,height:b,format:e});a._renderbuffer.refCount=0;return new q(36161,null,a)}function l(a){return a&&(a.texture||a.renderbuffer)}function B(a,b,c){a&&
(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c))}function y(){this.id=Ea++;E[this.id]=this;this.framebuffer=c.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function G(a){a.colorAttachments.forEach(k);k(a.depthAttachment);k(a.stencilAttachment);k(a.depthStencilAttachment)}function J(a){c.deleteFramebuffer(a.framebuffer);a.framebuffer=null;z.framebufferCount--;delete E[a.id]}
function g(a){var b;c.bindFramebuffer(36160,a.framebuffer);var g=a.colorAttachments;for(b=0;b<g.length;++b)w(36064+b,g[b]);for(b=g.length;b<e.maxColorAttachments;++b)c.framebufferTexture2D(36160,36064+b,3553,null,0);c.framebufferTexture2D(36160,33306,3553,null,0);c.framebufferTexture2D(36160,36096,3553,null,0);c.framebufferTexture2D(36160,36128,3553,null,0);w(36096,a.depthAttachment);w(36128,a.stencilAttachment);w(33306,a.depthStencilAttachment);c.checkFramebufferStatus(36160);c.bindFramebuffer(36160,
Ja.next);Ja.cur=Ja.next;c.getError()}function N(a,c){function e(a,b){var c,f=0,h=0,r=!0,w=!0;c=null;var q=!0,B="rgba",z="uint8",p=1,J=null,R=null,y=null,M=!1;if("number"===typeof a)f=a|0,h=b|0||f;else if(a){"shape"in a?(h=a.shape,f=h[0],h=h[1]):("radius"in a&&(f=h=a.radius),"width"in a&&(f=a.width),"height"in a&&(h=a.height));if("color"in a||"colors"in a)c=a.color||a.colors,Array.isArray(c);if(!c){"colorCount"in a&&(p=a.colorCount|0);"colorTexture"in a&&(q=!!a.colorTexture,B="rgba4");if("colorType"in
a&&(z=a.colorType,!q))if("half float"===z||"float16"===z)B="rgba16f";else if("float"===z||"float32"===z)B="rgba32f";"colorFormat"in a&&(B=a.colorFormat,0<=Ka.indexOf(B)?q=!0:0<=wa.indexOf(B)&&(q=!1))}if("depthTexture"in a||"depthStencilTexture"in a)M=!(!a.depthTexture&&!a.depthStencilTexture);"depth"in a&&("boolean"===typeof a.depth?r=a.depth:(J=a.depth,w=!1));"stencil"in a&&("boolean"===typeof a.stencil?w=a.stencil:(R=a.stencil,r=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?r=w=a.depthStencil:
(y=a.depthStencil,w=r=!1))}else f=h=1;var N=null,E=null,L=null,O=null;if(Array.isArray(c))N=c.map(K);else if(c)N=[K(c)];else for(N=Array(p),c=0;c<p;++c)N[c]=v(f,h,q,B,z);f=f||N[0].width;h=h||N[0].height;J?E=K(J):r&&!w&&(E=v(f,h,M,"depth","uint32"));R?L=K(R):w&&!r&&(L=v(f,h,!1,"stencil","uint8"));y?O=K(y):!J&&!R&&w&&r&&(O=v(f,h,M,"depth stencil","depth stencil"));r=null;for(c=0;c<N.length;++c)F(N[c],f,h),N[c]&&N[c].texture&&(w=n[N[c].texture._texture.format]*m[N[c].texture._texture.type],null===r&&
(r=w));F(E,f,h);F(L,f,h);F(O,f,h);G(k);k.width=f;k.height=h;k.colorAttachments=N;k.depthAttachment=E;k.stencilAttachment=L;k.depthStencilAttachment=O;e.color=N.map(l);e.depth=l(E);e.stencil=l(L);e.depthStencil=l(O);e.width=k.width;e.height=k.height;g(k);return e}var k=new y;z.framebufferCount++;e(a,c);return b(e,{resize:function(a,b){var c=a|0,l=b|0||c;if(c===k.width&&l===k.height)return e;for(var h=k.colorAttachments,f=0;f<h.length;++f)B(h[f],c,l);B(k.depthAttachment,c,l);B(k.stencilAttachment,c,
l);B(k.depthStencilAttachment,c,l);k.width=e.width=c;k.height=e.height=l;g(k);return e},_reglType:"framebuffer",_framebuffer:k,destroy:function(){J(k);G(k)}})}var Ja={cur:null,next:null,dirty:!1},Ka=["rgba"],wa=["rgba4","rgb565","rgb5 a1"];a.ext_srgb&&wa.push("srgba");a.ext_color_buffer_half_float&&wa.push("rgba16f","rgb16f");a.webgl_color_buffer_float&&wa.push("rgba32f");var Da=["uint8"];a.oes_texture_half_float&&Da.push("half float","float16");a.oes_texture_float&&Da.push("float","float32");var Ea=
0,E={};return b(Ja,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof y)?a:null},create:N,createCube:function(a){function c(a){var g,l={color:null},k=0,h=null;g="rgba";var n="uint8",v=1;if("number"===typeof a)k=a|0;else if(a){"shape"in a?k=a.shape[0]:("radius"in a&&(k=a.radius|0),"width"in a?k=a.width|0:"height"in a&&(k=a.height|0));if("color"in a||"colors"in a)h=a.color||a.colors,Array.isArray(h);h||("colorCount"in a&&(v=a.colorCount|
0),"colorType"in a&&(n=a.colorType),"colorFormat"in a&&(g=a.colorFormat));"depth"in a&&(l.depth=a.depth);"stencil"in a&&(l.stencil=a.stencil);"depthStencil"in a&&(l.depthStencil=a.depthStencil)}else k=1;if(h)if(Array.isArray(h))for(a=[],g=0;g<h.length;++g)a[g]=h[g];else a=[h];else for(a=Array(v),h={radius:k,format:g,type:n},g=0;g<v;++g)a[g]=f.createCube(h);l.color=Array(a.length);for(g=0;g<a.length;++g)v=a[g],k=k||v.width,l.color[g]={target:34069,data:a[g]};for(g=0;6>g;++g){for(v=0;v<a.length;++v)l.color[v].target=
34069+g;0<g&&(l.depth=e[0].depth,l.stencil=e[0].stencil,l.depthStencil=e[0].depthStencil);if(e[g])e[g](l);else e[g]=N(l)}return b(c,{width:k,height:k,color:a})}var e=Array(6);c(a);return b(c,{faces:e,resize:function(a){var b=a|0;if(b===c.width)return c;var g=c.color;for(a=0;a<g.length;++a)g[a].resize(b);for(a=0;6>a;++a)e[a].resize(b);c.width=c.height=b;return c},_reglType:"framebufferCube",destroy:function(){e.forEach(function(a){a.destroy()})}})},clear:function(){h(E).forEach(J)},restore:function(){h(E).forEach(function(a){a.framebuffer=
c.createFramebuffer();g(a)})}})}},{"./util/extend":23,"./util/values":32}],13:[function(f,p,y){p.exports=function(h,b){var f=1;b.ext_texture_filter_anisotropic&&(f=h.getParameter(34047));var m=1,c=1;b.webgl_draw_buffers&&(m=h.getParameter(34852),c=h.getParameter(36063));return{colorBits:[h.getParameter(3410),h.getParameter(3411),h.getParameter(3412),h.getParameter(3413)],depthBits:h.getParameter(3414),stencilBits:h.getParameter(3415),subpixelBits:h.getParameter(3408),extensions:Object.keys(b).filter(function(a){return!!b[a]}),
maxAnisotropic:f,maxDrawbuffers:m,maxColorAttachments:c,pointSizeDims:h.getParameter(33901),lineWidthDims:h.getParameter(33902),maxViewportDims:h.getParameter(3386),maxCombinedTextureUnits:h.getParameter(35661),maxCubeMapSize:h.getParameter(34076),maxRenderbufferSize:h.getParameter(34024),maxTextureUnits:h.getParameter(34930),maxTextureSize:h.getParameter(3379),maxAttributes:h.getParameter(34921),maxVertexUniforms:h.getParameter(36347),maxVertexTextureUnits:h.getParameter(35660),maxVaryingVectors:h.getParameter(36348),
maxFragmentUniforms:h.getParameter(36349),glsl:h.getParameter(35724),renderer:h.getParameter(7937),vendor:h.getParameter(7936),version:h.getParameter(7938)}}},{}],14:[function(f,p,y){var h=f("./util/is-typed-array");p.exports=function(b,f,m,c,a,e){return function(a){var e;e=null===f.next?5121:f.next.colorAttachments[0].texture._texture.type;var z=0,q=0,k=c.framebufferWidth,p=c.framebufferHeight,w=null;h(a)?w=a:a&&(z=a.x|0,q=a.y|0,k=(a.width||c.framebufferWidth-z)|0,p=(a.height||c.framebufferHeight-
q)|0,w=a.data||null);m();a=k*p*4;w||(5121===e?w=new Uint8Array(a):5126===e&&(w=w||new Float32Array(a)));b.pixelStorei(3333,4);b.readPixels(z,q,k,p,6408,e,w);return w}}},{"./util/is-typed-array":27}],15:[function(f,p,y){var h=f("./util/values"),b=[];b[32854]=2;b[32855]=2;b[36194]=2;b[33189]=2;b[36168]=1;b[34041]=4;b[35907]=4;b[34836]=16;b[34842]=8;b[34843]=6;p.exports=function(f,m,c,a,e){function r(a){this.id=k++;this.refCount=1;this.renderbuffer=a;this.format=32854;this.height=this.width=0;e.profile&&
(this.stats={size:0})}function p(b){var c=b.renderbuffer;f.bindRenderbuffer(36161,null);f.deleteRenderbuffer(c);b.renderbuffer=null;b.refCount=0;delete F[b.id];a.renderbufferCount--}var z={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};m.ext_srgb&&(z.srgba=35907);m.ext_color_buffer_half_float&&(z.rgba16f=34842,z.rgb16f=34843);m.webgl_color_buffer_float&&(z.rgba32f=34836);var q=[];Object.keys(z).forEach(function(a){q[z[a]]=a});var k=0,F={};r.prototype.decRef=
function(){0>=--this.refCount&&p(this)};e.profile&&(a.getTotalRenderbufferSize=function(){var a=0;Object.keys(F).forEach(function(b){a+=F[b].stats.size});return a});return{create:function(c,k){function h(a,c){var k=0,m=0,g=32854;"object"===typeof a&&a?("shape"in a?(m=a.shape,k=m[0]|0,m=m[1]|0):("radius"in a&&(k=m=a.radius|0),"width"in a&&(k=a.width|0),"height"in a&&(m=a.height|0)),"format"in a&&(g=z[a.format])):"number"===typeof a?(k=a|0,m="number"===typeof c?c|0:k):a||(k=m=1);if(k!==l.width||m!==
l.height||g!==l.format)return h.width=l.width=k,h.height=l.height=m,l.format=g,f.bindRenderbuffer(36161,l.renderbuffer),f.renderbufferStorage(36161,g,k,m),e.profile&&(l.stats.size=b[l.format]*l.width*l.height),h.format=q[l.format],h}var l=new r(f.createRenderbuffer());F[l.id]=l;a.renderbufferCount++;h(c,k);h.resize=function(a,c){var k=a|0,m=c|0||k;if(k===l.width&&m===l.height)return h;h.width=l.width=k;h.height=l.height=m;f.bindRenderbuffer(36161,l.renderbuffer);f.renderbufferStorage(36161,l.format,
k,m);e.profile&&(l.stats.size=b[l.format]*l.width*l.height);return h};h._reglType="renderbuffer";h._renderbuffer=l;e.profile&&(h.stats=l.stats);h.destroy=function(){l.decRef()};return h},clear:function(){h(F).forEach(p)},restore:function(){h(F).forEach(function(a){a.renderbuffer=f.createRenderbuffer();f.bindRenderbuffer(36161,a.renderbuffer);f.renderbufferStorage(36161,a.format,a.width,a.height)});f.bindRenderbuffer(36161,null)}}}},{"./util/values":32}],16:[function(f,p,y){var h=f("./util/values");
p.exports=function(b,f,m,c){function a(a,b,c,e){this.name=a;this.id=b;this.location=c;this.info=e}function e(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b.id){a[c].location=b.location;return}a.push(b)}function r(a,c,e){e=35632===a?q:k;var h=e[c];if(!h){var m=f.str(c),h=b.createShader(a);b.shaderSource(h,m);b.compileShader(h);e[c]=h}return h}function p(a,b){this.id=y++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];c.profile&&(this.stats={uniformsCount:0,attributesCount:0})}
function z(k,h){var m,q;m=r(35632,k.fragId);q=r(35633,k.vertId);var w=k.program=b.createProgram();b.attachShader(w,m);b.attachShader(w,q);b.linkProgram(w);var p=b.getProgramParameter(w,35718);c.profile&&(k.stats.uniformsCount=p);var g=k.uniforms;for(m=0;m<p;++m)if(q=b.getActiveUniform(w,m))if(1<q.size)for(var z=0;z<q.size;++z){var F=q.name.replace("[0]","["+z+"]");e(g,new a(F,f.id(F),b.getUniformLocation(w,F),q))}else e(g,new a(q.name,f.id(q.name),b.getUniformLocation(w,q.name),q));p=b.getProgramParameter(w,
35721);c.profile&&(k.stats.attributesCount=p);g=k.attributes;for(m=0;m<p;++m)(q=b.getActiveAttrib(w,m))&&e(g,new a(q.name,f.id(q.name),b.getAttribLocation(w,q.name),q))}var q={},k={},F={},w=[],y=0;c.profile&&(m.getMaxUniformsCount=function(){var a=0;w.forEach(function(b){b.stats.uniformsCount>a&&(a=b.stats.uniformsCount)});return a},m.getMaxAttributesCount=function(){var a=0;w.forEach(function(b){b.stats.attributesCount>a&&(a=b.stats.attributesCount)});return a});return{clear:function(){var a=b.deleteShader.bind(b);
h(q).forEach(a);q={};h(k).forEach(a);k={};w.forEach(function(a){b.deleteProgram(a.program)});w.length=0;F={};m.shaderCount=0},program:function(a,b,c){m.shaderCount++;var e=F[b];e||(e=F[b]={});var k=e[a];k||(k=new p(b,a),z(k,c),e[a]=k,w.push(k));return k},restore:function(){q={};k={};for(var a=0;a<w.length;++a)z(w[a])},shader:r,frag:-1,vert:-1}}},{"./util/values":32}],17:[function(f,p,y){p.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,
renderbufferCount:0,maxTextureUnits:0}}},{}],18:[function(f,p,y){p.exports=function(){var h={"":0},b=[""];return{id:function(f){var m=h[f];if(m)return m;m=h[f]=b.length;b.push(f);return m},str:function(h){return b[h]}}}},{}],19:[function(f,p,y){function h(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function b(a){return Array.isArray(a)&&0!==a.length&&F(a[0])?!0:!1}function n(a){return Object.prototype.toString.call(a)}function m(a){if(!a)return!1;var c=n(a);return 0<=M.indexOf(c)?
!0:h(a)||b(a)||z(a)}function c(a,b){36193===a.type?(a.data=k(b),q.freeType(b)):a.data=b}function a(a,b,c,e,k,h){a="undefined"!==typeof J[a]?J[a]:B[a]*G[b];h&&(a*=6);if(k){for(e=0;1<=c;)e+=a*c*c,c/=2;return e}return a*c*e}var e=f("./util/extend"),r=f("./util/values"),R=f("./util/is-typed-array"),z=f("./util/is-ndarray"),q=f("./util/pool"),k=f("./util/to-half-float"),F=f("./util/is-array-like"),w=f("./util/flatten");y=f("./constants/arraytypes.json");var K=f("./constants/arraytypes.json"),v=[9984,9986,
9985,9987],l=[0,6409,6410,6407,6408],B={};B[6409]=B[6406]=B[6402]=1;B[34041]=B[6410]=2;B[6407]=B[35904]=3;B[6408]=B[35906]=4;var M=Object.keys(y).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),G=[];G[5121]=1;G[5126]=4;G[36193]=2;G[5123]=2;G[5125]=4;var J=[];J[32854]=2;J[32855]=2;J[36194]=2;J[34041]=4;J[33776]=.5;J[33777]=.5;J[33778]=1;J[33779]=1;J[35986]=.5;J[35987]=1;J[34798]=1;J[35840]=.5;J[35841]=.25;J[35842]=.5;
J[35843]=.25;J[36196]=.5;p.exports=function(g,f,p,y,J,G,M){function E(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.channels=this.height=this.width=this.colorSpace=0}function L(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=
b.height;a.channels=b.channels}function ia(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(a.flipY=b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in b&&(a.colorSpace=oa[b.colorSpace]);"type"in b&&(a.type=V[b.type]);var c=a.width,e=a.height,g=a.channels,k=!1;"shape"in b?(c=b.shape[0],e=b.shape[1],3===b.shape.length&&(g=b.shape[2],k=!0)):("radius"in b&&(c=e=b.radius),"width"in b&&(c=b.width),"height"in b&&(e=b.height),
"channels"in b&&(g=b.channels,k=!0));a.width=c|0;a.height=e|0;a.channels=g|0;c=!1;"format"in b&&(c=b.format,e=a.internalformat=Y[c],a.format=Na[e],c in V&&!("type"in b)&&(a.type=V[c]),c in T&&(a.compressed=!0),c=!0);!k&&c?a.channels=B[a.format]:k&&!c&&a.channels!==l[a.format]&&(a.format=a.internalformat=l[a.channels])}}function sa(a){g.pixelStorei(37440,a.flipY);g.pixelStorei(37441,a.premultiplyAlpha);g.pixelStorei(37443,a.colorSpace);g.pixelStorei(3317,a.unpackAlignment)}function u(){E.call(this);
this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function W(a,e){var g=null;m(e)?g=e:e&&(ia(a,e),"x"in e&&(a.xOffset=e.x|0),"y"in e&&(a.yOffset=e.y|0),m(e.data)&&(g=e.data));if(e.copy){var f=J.viewportWidth,r=J.viewportHeight;a.width=a.width||f-a.xOffset;a.height=a.height||r-a.yOffset;a.needsCopy=!0}else if(!g)a.width=a.width||1,a.height=a.height||1,a.channels=a.channels||4;else if(R(g))a.channels=a.channels||4,a.data=g,"type"in e||5121!==a.type||(a.type=
K[Object.prototype.toString.call(g)]|0);else if(h(g)){a.channels=a.channels||4;f=g;r=f.length;switch(a.type){case 5121:case 5123:case 5125:case 5126:r=q.allocType(a.type,r);r.set(f);a.data=r;break;case 36193:a.data=k(f)}a.alignment=1;a.needsFree=!0}else if(z(g)){f=g.data;Array.isArray(f)||5121!==a.type||(a.type=K[Object.prototype.toString.call(f)]|0);var r=g.shape,v=g.stride,p,u,t,D;3===r.length?(t=r[2],D=v[2]):D=t=1;p=r[0];u=r[1];r=v[0];v=v[1];a.alignment=1;a.width=p;a.height=u;a.channels=t;a.format=
a.internalformat=l[t];a.needsFree=!0;p=D;g=g.offset;t=a.width;D=a.height;u=a.channels;for(var y=q.allocType(36193===a.type?5126:a.type,t*D*u),G=0,B=0;B<D;++B)for(var H=0;H<t;++H)for(var E=0;E<u;++E)y[G++]=f[r*H+v*B+p*E+g];c(a,y)}else if("[object HTMLCanvasElement]"===n(g)||"[object CanvasRenderingContext2D]"===n(g))"[object HTMLCanvasElement]"===n(g)?a.element=g:a.element=g.canvas,a.width=a.element.width,a.height=a.element.height,a.channels=4;else if("[object HTMLImageElement]"===n(g))a.element=g,
a.width=g.naturalWidth,a.height=g.naturalHeight,a.channels=4;else if("[object HTMLVideoElement]"===n(g))a.element=g,a.width=g.videoWidth,a.height=g.videoHeight,a.channels=4;else if(b(g)){f=a.width||g[0].length;r=a.height||g.length;v=a.channels;v=F(g[0][0])?v||g[0][0].length:v||1;p=w.shape(g);t=1;for(D=0;D<p.length;++D)t*=p[D];t=q.allocType(36193===a.type?5126:a.type,t);w.flatten(g,p,"",t);c(a,t);a.alignment=1;a.width=f;a.height=r;a.channels=v;a.format=a.internalformat=l[v];a.needsFree=!0}}function la(a,
b,c,e,k){var f=a.element,h=a.data,l=a.internalformat,m=a.format,n=a.type,r=a.width,q=a.height;sa(a);f?g.texSubImage2D(b,k,c,e,m,n,f):a.compressed?g.compressedTexSubImage2D(b,k,c,e,l,r,q,h):a.needsCopy?(y(),g.copyTexSubImage2D(b,k,c,e,a.xOffset,a.yOffset,r,q)):g.texSubImage2D(b,k,c,e,r,q,m,n,h)}function ea(){return Ma.pop()||new u}function X(a){a.needsFree&&q.freeType(a.data);u.call(a);Ma.push(a)}function S(){E.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}
function I(a,b,c){var e=a.images[0]=ea();a.mipmask=1;e.width=a.width=b;e.height=a.height=c;e.channels=a.channels=4}function Z(a,b){var c=null;if(m(b))c=a.images[0]=ea(),L(c,a),W(c,b),a.mipmask=1;else if(ia(a,b),Array.isArray(b.mipmap))for(var e=b.mipmap,g=0;g<e.length;++g)c=a.images[g]=ea(),L(c,a),c.width>>=g,c.height>>=g,W(c,e[g]),a.mipmask|=1<<g;else c=a.images[0]=ea(),L(c,a),W(c,b),a.mipmask=1;L(a,a.images[0])}function ma(a,b){for(var c=a.images,e=0;e<c.length&&c[e];++e){var k=c[e],f=b,h=e,l=k.element,
m=k.data,n=k.internalformat,r=k.format,q=k.type,w=k.width,v=k.height;sa(k);l?g.texImage2D(f,h,r,r,q,l):k.compressed?g.compressedTexImage2D(f,h,n,w,v,0,m):k.needsCopy?(y(),g.copyTexImage2D(f,h,r,k.xOffset,k.yOffset,w,v,0)):g.texImage2D(f,h,r,w,v,0,r,q,m)}}function va(){var a=Ia.pop()||new S;E.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function U(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&X(b[c]),b[c]=null;Ia.push(a)}function ga(){this.magFilter=this.minFilter=9728;this.wrapT=
this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function ja(a,b){"min"in b&&(a.minFilter=Q[b.min],0<=v.indexOf(a.minFilter)&&(a.genMipmaps=!0));"mag"in b&&(a.magFilter=fa[b.mag]);var c=a.wrapS,e=a.wrapT;if("wrap"in b){var g=b.wrap;"string"===typeof g?c=e=O[g]:Array.isArray(g)&&(c=O[g[0]],e=O[g[1]])}else"wrapS"in b&&(c=O[b.wrapS]),"wrapT"in b&&(e=O[b.wrapT]);a.wrapS=c;a.wrapT=e;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=
da[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,c=!0}!c||"min"in b||(a.minFilter=9984)}}function pa(a,b){g.texParameteri(b,10241,a.minFilter);g.texParameteri(b,10240,a.magFilter);g.texParameteri(b,10242,a.wrapS);g.texParameteri(b,10243,a.wrapT);f.ext_texture_filter_anisotropic&&g.texParameteri(b,34046,a.anisotropic);a.genMipmaps&&(g.hint(33170,a.mipmapHint),g.generateMipmap(b))}function qa(a){E.call(this);this.mipmask=0;this.internalformat=
6408;this.id=xa++;this.refCount=1;this.target=a;this.texture=g.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new ga;M.profile&&(this.stats={size:0})}function ca(a){g.activeTexture(33984);g.bindTexture(a.target,a.texture)}function ha(){var a=na[0];a?g.bindTexture(a.target,a.texture):g.bindTexture(3553,null)}function ka(a){var b=a.texture,c=a.unit,e=a.target;0<=c&&(g.activeTexture(33984+c),g.bindTexture(e,null),na[c]=null);g.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=
0;delete ba[a.id];G.textureCount--}var da={"don't care":4352,"dont care":4352,nice:4354,fast:4353},O={repeat:10497,clamp:33071,mirror:33648},fa={nearest:9728,linear:9729},Q=e({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},fa),oa={none:0,browser:37444},V={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},Y={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},
T={};f.ext_srgb&&(Y.srgb=35904,Y.srgba=35906);f.oes_texture_float&&(V.float32=V["float"]=5126);f.oes_texture_half_float&&(V.float16=V["half float"]=36193);f.webgl_depth_texture&&(e(Y,{depth:6402,"depth stencil":34041}),e(V,{uint16:5123,uint32:5125,"depth stencil":34042}));f.webgl_compressed_texture_s3tc&&e(T,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});f.webgl_compressed_texture_atc&&e(T,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});
f.webgl_compressed_texture_pvrtc&&e(T,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});f.webgl_compressed_texture_etc1&&(T["rgb etc1"]=36196);var Fa=Array.prototype.slice.call(g.getParameter(34467));Object.keys(T).forEach(function(a){var b=T[a];0<=Fa.indexOf(b)&&(Y[a]=b)});var Ba=Object.keys(Y);p.textureFormats=Ba;var Ca=[];Object.keys(Y).forEach(function(a){Ca[Y[a]]=a});var Ga=[];Object.keys(V).forEach(function(a){Ga[V[a]]=a});var Ha=[];Object.keys(fa).forEach(function(a){Ha[fa[a]]=
a});var ya=[];Object.keys(Q).forEach(function(a){ya[Q[a]]=a});var za=[];Object.keys(O).forEach(function(a){za[O[a]]=a});var Na=Ba.reduce(function(a,b){var c=Y[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{}),Ma=[],Ia=[],xa=0,ba={},ra=p.maxTextureUnits,na=Array(ra).map(function(){return null});e(qa.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<ra;++b){var c=na[b];if(c){if(0<c.bindCount)continue;
c.unit=-1}na[b]=this;a=b;break}M.profile&&G.maxTextureUnits<a+1&&(G.maxTextureUnits=a+1);this.unit=a;g.activeTexture(33984+a);g.bindTexture(this.target,this.texture)}return a},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&ka(this)}});M.profile&&(G.getTotalTextureSize=function(){var a=0;Object.keys(ba).forEach(function(b){a+=ba[b].stats.size});return a});return{create2D:function(b,c){function e(b,d){var c=k.texInfo;ga.call(c);var g=va();"number"===typeof b?"number"===typeof d?
I(g,b|0,d|0):I(g,b|0,b|0):b?(ja(c,b),Z(g,b)):I(g,1,1);c.genMipmaps&&(g.mipmask=(g.width<<1)-1);k.mipmask=g.mipmask;L(k,g);k.internalformat=g.internalformat;e.width=g.width;e.height=g.height;ca(k);ma(g,3553);pa(c,3553);ha();U(g);M.profile&&(k.stats.size=a(k.internalformat,k.type,g.width,g.height,c.genMipmaps,!1));e.format=Ca[k.internalformat];e.type=Ga[k.type];e.mag=Ha[c.magFilter];e.min=ya[c.minFilter];e.wrapS=za[c.wrapS];e.wrapT=za[c.wrapT];return e}var k=new qa(3553);ba[k.id]=k;G.textureCount++;
e(b,c);e.subimage=function(a,b,d,c){b|=0;d|=0;c|=0;var g=ea();L(g,k);g.width=0;g.height=0;W(g,a);g.width=g.width||(k.width>>c)-b;g.height=g.height||(k.height>>c)-d;ca(k);la(g,3553,b,d,c);ha();X(g);return e};e.resize=function(b,d){var c=b|0,f=d|0||c;if(c===k.width&&f===k.height)return e;e.width=k.width=c;e.height=k.height=f;ca(k);for(var h=0;k.mipmask>>h;++h)g.texImage2D(3553,h,k.format,c>>h,f>>h,0,k.format,k.type,null);ha();M.profile&&(k.stats.size=a(k.internalformat,k.type,c,f,!1,!1));return e};
e._reglType="texture2d";e._texture=k;M.profile&&(e.stats=k.stats);e.destroy=function(){k.decRef()};return e},createCube:function(b,c,e,k,f,h){function l(b,d,c,e,g,k){var f,h=m.texInfo;ga.call(h);for(f=0;6>f;++f)n[f]=va();if("number"===typeof b||!b)for(b=b|0||1,f=0;6>f;++f)I(n[f],b,b);else if("object"===typeof b)if(d)Z(n[0],b),Z(n[1],d),Z(n[2],c),Z(n[3],e),Z(n[4],g),Z(n[5],k);else if(ja(h,b),ia(m,b),"faces"in b)for(b=b.faces,f=0;6>f;++f)L(n[f],m),Z(n[f],b[f]);else for(f=0;6>f;++f)Z(n[f],b);L(m,n[0]);
m.mipmask=h.genMipmaps?(n[0].width<<1)-1:n[0].mipmask;m.internalformat=n[0].internalformat;l.width=n[0].width;l.height=n[0].height;ca(m);for(f=0;6>f;++f)ma(n[f],34069+f);pa(h,34067);ha();M.profile&&(m.stats.size=a(m.internalformat,m.type,l.width,l.height,h.genMipmaps,!0));l.format=Ca[m.internalformat];l.type=Ga[m.type];l.mag=Ha[h.magFilter];l.min=ya[h.minFilter];l.wrapS=za[h.wrapS];l.wrapT=za[h.wrapT];for(f=0;6>f;++f)U(n[f]);return l}var m=new qa(34067);ba[m.id]=m;G.cubeCount++;var n=Array(6);l(b,
c,e,k,f,h);l.subimage=function(a,b,d,c,e){d|=0;c|=0;e|=0;var g=ea();L(g,m);g.width=0;g.height=0;W(g,b);g.width=g.width||(m.width>>e)-d;g.height=g.height||(m.height>>e)-c;ca(m);la(g,34069+a,d,c,e);ha();X(g);return l};l.resize=function(b){b|=0;if(b!==m.width){l.width=m.width=b;l.height=m.height=b;ca(m);for(var d=0;6>d;++d)for(var c=0;m.mipmask>>c;++c)g.texImage2D(34069+d,c,m.format,b>>c,b>>c,0,m.format,m.type,null);ha();M.profile&&(m.stats.size=a(m.internalformat,m.type,l.width,l.height,!1,!0));return l}};
l._reglType="textureCube";l._texture=m;M.profile&&(l.stats=m.stats);l.destroy=function(){m.decRef()};return l},clear:function(){for(var a=0;a<ra;++a)g.activeTexture(33984+a),g.bindTexture(3553,null),na[a]=null;r(ba).forEach(ka);G.cubeCount=0;G.textureCount=0},getTexture:function(a){return null},restore:function(){r(ba).forEach(function(a){a.texture=g.createTexture();g.bindTexture(a.target,a.texture);for(var b=0;32>b;++b)if(0!==(a.mipmask&1<<b))if(3553===a.target)g.texImage2D(3553,b,a.internalformat,
a.width>>b,a.height>>b,0,a.internalformat,a.type,null);else for(var c=0;6>c;++c)g.texImage2D(34069+c,b,a.internalformat,a.width>>b,a.height>>b,0,a.internalformat,a.type,null);pa(a.texInfo,a.target)})}}}},{"./constants/arraytypes.json":4,"./util/extend":23,"./util/flatten":24,"./util/is-array-like":25,"./util/is-ndarray":26,"./util/is-typed-array":27,"./util/pool":29,"./util/to-half-float":31,"./util/values":32}],20:[function(f,p,y){p.exports=function(f,b){function n(){this.endQueryIndex=this.startQueryIndex=
-1;this.sum=0;this.stats=null}function m(a,b,c){var e=r.pop()||new n;e.startQueryIndex=a;e.endQueryIndex=b;e.sum=0;e.stats=c;p.push(e)}var c=b.ext_disjoint_timer_query;if(!c)return null;var a=[],e=[],r=[],p=[],z=[],q=[];return{beginQuery:function(b){var f=a.pop()||c.createQueryEXT();c.beginQueryEXT(35007,f);e.push(f);m(e.length-1,e.length,b)},endQuery:function(){c.endQueryEXT(35007)},pushScopeStats:m,update:function(){var b,f;b=e.length;if(0!==b){q.length=Math.max(q.length,b+1);z.length=Math.max(z.length,
b+1);z[0]=0;var h=q[0]=0;for(f=b=0;f<e.length;++f){var m=e[f];c.getQueryObjectEXT(m,34919)?(h+=c.getQueryObjectEXT(m,34918),a.push(m)):e[b++]=m;z[f+1]=h;q[f+1]=b}e.length=b;for(f=b=0;f<p.length;++f){var h=p[f],n=h.startQueryIndex,m=h.endQueryIndex;h.sum+=z[m]-z[n];n=q[n];m=q[m];m===n?(h.stats.gpuTime+=h.sum/1E6,r.push(h)):(h.startQueryIndex=n,h.endQueryIndex=m,p[b++]=h)}p.length=b}},getNumPendingQueries:function(){return e.length},clear:function(){a.push.apply(a,e);for(var b=0;b<a.length;b++)c.deleteQueryEXT(a[b]);
e.length=0;a.length=0},restore:function(){e.length=0;a.length=0}}}},{}],21:[function(f,p,y){p.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(f,p,y){function h(b){return Array.prototype.slice.call(b)}function b(b){return h(b).join("")}var n=f("./extend");p.exports=function(){function f(){var c=[],e=[];return n(function(){c.push.apply(c,h(arguments))},{def:function(){var b="v"+a++;e.push(b);0<arguments.length&&
(c.push(b,"="),c.push.apply(c,h(arguments)),c.push(";"));return b},toString:function(){return b([0<e.length?"var "+e+";":"",b(c)])}})}function c(){function a(e,f){c(e,f,"=",b.def(e,f),";")}var b=f(),c=f(),e=b.toString,r=c.toString;return n(function(){b.apply(b,h(arguments))},{def:b.def,entry:b,exit:c,save:a,set:function(c,e,f){a(c,e);b(c,e,"=",f,";")},toString:function(){return e()+r()}})}var a=0,e=[],r=[],p=f(),z={};return{global:p,link:function(b){for(var c=0;c<r.length;++c)if(r[c]===b)return e[c];
c="g"+a++;e.push(c);r.push(b);return c},block:f,proc:function(a,e){function f(){var a="a"+h.length;h.push(a);return a}var h=[];e=e||0;for(var m=0;m<e;++m)f();var m=c(),r=m.toString;return z[a]=n(m,{arg:f,toString:function(){return b(["function(",h.join(),"){",r(),"}"])}})},scope:c,cond:function(){var a=b(arguments),e=c(),f=c(),m=e.toString,r=f.toString;return n(e,{then:function(){e.apply(e,h(arguments));return this},"else":function(){f.apply(f,h(arguments));return this},toString:function(){var c=
r();c&&(c="else{"+c+"}");return b(["if(",a,"){",m(),"}",c])}})},compile:function(){var a=['"use strict";',p,"return {"];Object.keys(z).forEach(function(b){a.push('"',b,'":',z[b].toString(),",")});a.push("}");var c=b(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,e.concat(c)).apply(null,r)}}}},{"./extend":23}],23:[function(f,p,y){p.exports=function(f,b){for(var n=Object.keys(b),m=0;m<n.length;++m)f[n[m]]=b[n[m]];return f}},{}],24:[function(f,p,y){function h(b,
c,a,e,f,h){for(var n=0;n<c;++n)for(var p=b[n],k=0;k<a;++k)for(var y=p[k],w=0;w<e;++w)f[h++]=y[w]}function b(f,c,a,e,n){for(var p=1,z=a+1;z<c.length;++z)p*=c[z];var q=c[a];if(4===c.length-a){var k=c[a+1],y=c[a+2];c=c[a+3];for(z=0;z<q;++z)h(f[z],k,y,c,e,n),n+=p}else for(z=0;z<q;++z)b(f[z],c,a+1,e,n),n+=p}var n=f("./pool");p.exports={shape:function(b){for(var c=[];b.length;b=b[0])c.push(b.length);return c},flatten:function(f,c,a,e){var r=1;if(c.length)for(var p=0;p<c.length;++p)r*=c[p];else r=0;a=e||
n.allocType(a,r);switch(c.length){case 0:break;case 1:e=c[0];for(c=0;c<e;++c)a[c]=f[c];break;case 2:e=c[0];c=c[1];for(p=r=0;p<e;++p)for(var z=f[p],q=0;q<c;++q)a[r++]=z[q];break;case 3:h(f,c[0],c[1],c[2],a,0);break;default:b(f,c,0,a,0)}return a}}},{"./pool":29}],25:[function(f,p,y){var h=f("./is-typed-array");p.exports=function(b){return Array.isArray(b)||h(b)}},{"./is-typed-array":27}],26:[function(f,p,y){var h=f("./is-typed-array");p.exports=function(b){return!!b&&"object"===typeof b&&Array.isArray(b.shape)&&
Array.isArray(b.stride)&&"number"===typeof b.offset&&b.shape.length===b.stride.length&&(Array.isArray(b.data)||h(b.data))}},{"./is-typed-array":27}],27:[function(f,p,y){var h=f("../constants/arraytypes.json");p.exports=function(b){return Object.prototype.toString.call(b)in h}},{"../constants/arraytypes.json":4}],28:[function(f,p,y){p.exports=function(f,b){for(var n=Array(f),m=0;m<f;++m)n[m]=b(m);return n}},{}],29:[function(f,p,y){function h(b){var a,e;a=(65535<b)<<4;b>>>=a;e=(255<b)<<3;b>>>=e;a|=
e;e=(15<b)<<2;b>>>=e;a|=e;e=(3<b)<<1;return a|e|b>>>e>>1}function b(b){a:{for(var a=16;268435456>=a;a*=16)if(b<=a){b=a;break a}b=0}a=m[h(b)>>2];return 0<a.length?a.pop():new ArrayBuffer(b)}function n(b){m[h(b.byteLength)>>2].push(b)}var m=f("./loop")(8,function(){return[]});p.exports={alloc:b,free:n,allocType:function(c,a){var e=null;switch(c){case 5120:e=new Int8Array(b(a),0,a);break;case 5121:e=new Uint8Array(b(a),0,a);break;case 5122:e=new Int16Array(b(2*a),0,a);break;case 5123:e=new Uint16Array(b(2*
a),0,a);break;case 5124:e=new Int32Array(b(4*a),0,a);break;case 5125:e=new Uint32Array(b(4*a),0,a);break;case 5126:e=new Float32Array(b(4*a),0,a);break;default:return null}return e.length!==a?e.subarray(0,a):e},freeType:function(b){n(b.buffer)}}},{"./loop":28}],30:[function(f,p,y){p.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(f){return requestAnimationFrame(f)},cancel:function(f){return cancelAnimationFrame(f)}}:{next:function(f){return setTimeout(f,
16)},cancel:clearTimeout}},{}],31:[function(f,p,y){var h=f("./pool"),b=new Float32Array(1),n=new Uint32Array(b.buffer);p.exports=function(f){for(var c=h.allocType(5123,f.length),a=0;a<f.length;++a)if(isNaN(f[a]))c[a]=65535;else if(Infinity===f[a])c[a]=31744;else if(-Infinity===f[a])c[a]=64512;else{b[0]=f[a];var e=n[0],r=e>>>31<<15,p=(e<<1>>>24)-127,e=e>>13&1023;c[a]=-24>p?r:-14>p?r+(e+1024>>-14-p):15<p?r+31744:r+(p+15<<10)+e}return c}},{"./pool":29}],32:[function(f,p,y){p.exports=function(f){return Object.keys(f).map(function(b){return f[b]})}},
{}],33:[function(f,p,y){function h(a,b,f){function h(){var b=window.innerWidth,e=window.innerHeight;a!==document.body&&(e=a.getBoundingClientRect(),b=e.right-e.left,e=e.top-e.bottom);n.width=f*b;n.height=f*e;c(n.style,{width:b+"px",height:e+"px"})}var n=document.createElement("canvas");c(n.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(n);a===document.body&&(n.style.position="absolute",c(a.style,{margin:0,padding:0}));window.addEventListener("resize",h,!1);h();return{canvas:n,onDestroy:function(){window.removeEventListener("resize",
h);a.removeChild(n)}}}function b(a,b){function c(f){try{return a.getContext(f,b)}catch(h){return null}}return c("webgl")||c("experimental-webgl")||c("webgl-experimental")}function n(a){return"string"===typeof a?a.split():a}function m(a){return"string"===typeof a?document.querySelector(a):a}var c=f("./util/extend");p.exports=function(a){var c=a||{},f,p,z,q;a={};var k=[],y=[],w="undefined"===typeof window?1:window.devicePixelRatio,K=!1,v=function(a){},l=function(){};"string"===typeof c?f=document.querySelector(c):
"object"===typeof c&&("string"===typeof c.nodeName&&"function"===typeof c.appendChild&&"function"===typeof c.getBoundingClientRect?f=c:"function"===typeof c.drawArrays||"function"===typeof c.drawElements?(q=c,z=q.canvas):("gl"in c?q=c.gl:"canvas"in c?z=m(c.canvas):"container"in c&&(p=m(c.container)),"attributes"in c&&(a=c.attributes),"extensions"in c&&(k=n(c.extensions)),"optionalExtensions"in c&&(y=n(c.optionalExtensions)),"onDone"in c&&(v=c.onDone),"profile"in c&&(K=!!c.profile),"pixelRatio"in c&&
(w=+c.pixelRatio)));f&&("canvas"===f.nodeName.toLowerCase()?z=f:p=f);if(!q){if(!z){f=h(p||document.body,v,w);if(!f)return null;z=f.canvas;l=f.onDestroy}q=b(z,a)}return q?{gl:q,canvas:z,container:p,extensions:k,optionalExtensions:y,pixelRatio:w,profile:K,onDone:v,onDestroy:l}:(l(),v("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/extend":23}],34:[function(f,p,y){p.exports=function(b,f){function m(a){var b=!1;"altKey"in a&&(b=b||a.altKey!==
l.alt,l.alt=!!a.altKey);"shiftKey"in a&&(b=b||a.shiftKey!==l.shift,l.shift=!!a.shiftKey);"ctrlKey"in a&&(b=b||a.ctrlKey!==l.control,l.control=!!a.ctrlKey);"metaKey"in a&&(b=b||a.metaKey!==l.meta,l.meta=!!a.metaKey);return b}function c(a,b){var c=h.x(b),e=h.y(b);"buttons"in b&&(a=b.buttons|0);if(a!==w||c!==K||e!==v||m(b))w=a|0,K=c||0,v=e||0,f&&f(w,K,v,l)}function a(a){c(0,a)}function e(){if(w||K||v||l.shift||l.alt||l.meta||l.control)w=K=v=0,l.shift=l.alt=l.control=l.meta=!1,f&&f(0,0,0,l)}function p(a){m(a)&&
f&&f(w,K,v,l)}function y(a){0===h.buttons(a)?c(0,a):c(w,a)}function z(a){c(w|h.buttons(a),a)}function q(a){c(w&~h.buttons(a),a)}function k(){B||(B=!0,b.addEventListener("mousemove",y),b.addEventListener("mousedown",z),b.addEventListener("mouseup",q),b.addEventListener("mouseleave",a),b.addEventListener("mouseenter",a),b.addEventListener("mouseout",a),b.addEventListener("mouseover",a),b.addEventListener("blur",e),b.addEventListener("keyup",p),b.addEventListener("keydown",p),b.addEventListener("keypress",
p),b!==window&&(window.addEventListener("blur",e),window.addEventListener("keyup",p),window.addEventListener("keydown",p),window.addEventListener("keypress",p)))}function F(){B&&(B=!1,b.removeEventListener("mousemove",y),b.removeEventListener("mousedown",z),b.removeEventListener("mouseup",q),b.removeEventListener("mouseleave",a),b.removeEventListener("mouseenter",a),b.removeEventListener("mouseout",a),b.removeEventListener("mouseover",a),b.removeEventListener("blur",e),b.removeEventListener("keyup",
p),b.removeEventListener("keydown",p),b.removeEventListener("keypress",p),b!==window&&(window.removeEventListener("blur",e),window.removeEventListener("keyup",p),window.removeEventListener("keydown",p),window.removeEventListener("keypress",p)))}f||(f=b,b=window);var w=0,K=0,v=0,l={shift:!1,alt:!1,control:!1,meta:!1},B=!1;k();var M={element:b};Object.defineProperties(M,{enabled:{get:function(){return B},set:function(a){a?k():F},enumerable:!0},buttons:{get:function(){return w},enumerable:!0},x:{get:function(){return K},
enumerable:!0},y:{get:function(){return v},enumerable:!0},mods:{get:function(){return l},enumerable:!0}});return M};var h=f("mouse-event")},{"mouse-event":35}],35:[function(f,p,y){function h(b){return b.target||b.srcElement||window}y.buttons=function(b){if("object"===typeof b){if("buttons"in b)return b.buttons;if("which"in b){b=b.which;if(2===b)return 4;if(3===b)return 2;if(0<b)return 1<<b-1}else if("button"in b){b=b.button;if(1===b)return 4;if(2===b)return 2;if(0<=b)return 1<<b}}return 0};y.element=
h;y.x=function(b){if("object"===typeof b){if("offsetX"in b)return b.offsetX;var f=h(b).getBoundingClientRect();return b.clientX-f.left}return 0};y.y=function(b){if("object"===typeof b){if("offsetY"in b)return b.offsetY;var f=h(b).getBoundingClientRect();return b.clientY-f.top}return 0}},{}],36:[function(f,p,y){function h(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var b=f("./lib/util/extend"),n=f("./lib/dynamic"),m=f("./lib/util/raf"),c=f("./lib/util/clock"),a=f("./lib/strings"),
e=f("./lib/webgl"),r=f("./lib/extension"),R=f("./lib/limits"),z=f("./lib/buffer"),q=f("./lib/elements"),k=f("./lib/texture"),F=f("./lib/renderbuffer"),w=f("./lib/framebuffer"),K=f("./lib/attribute"),v=f("./lib/shader"),l=f("./lib/read"),B=f("./lib/core"),M=f("./lib/stats"),G=f("./lib/timer");p.exports=function(f){function g(){if(0===Q.length)I&&I.update(),T=null;else{T=m.next(g);L();for(var a=Q.length-1;0<=a;--a){var b=Q[a];b&&b(U,null,0)}u.flush();I&&I.update()}}function p(){!T&&0<Q.length&&(T=m.next(g))}
function y(){T&&(m.cancel(g),T=null)}function Ka(a){a.preventDefault();y();oa.forEach(function(a){a()})}function wa(a){u.getError();la.restore();qa.restore();ja.restore();ca.restore();ha.restore();ka.restore();I&&I.restore();da.procs.refresh();p();V.forEach(function(a){a()})}function Da(a){function c(a){var b={},e={};Object.keys(a).forEach(function(c){var f=a[c];n.isDynamic(f)?e[c]=n.unbox(f,c):b[c]=f});return{dynamic:e,"static":b}}function e(a){for(;q.length<a;)q.push(null);return q}var f=c(a.context||
{}),g=c(a.uniforms||{}),h=c(a.attributes||{}),k=c(function(a){function c(a){if(a in e){var b=e[a];delete e[a];Object.keys(b).forEach(function(c){e[a+"."+c]=b[c]})}}var e=b({},a);delete e.uniforms;delete e.attributes;delete e.context;"stencil"in e&&e.stencil.op&&(e.stencil.opBack=e.stencil.opFront=e.stencil.op,delete e.stencil.op);c("blend");c("depth");c("cull");c("stencil");c("polygonOffset");c("scissor");c("sample");return e}(a));a={gpuTime:0,cpuTime:0,count:0};var f=da.compile(k,h,g,f,a),l=f.draw,
m=f.batch,p=f.scope,q=[];return b(function(a,b){var c;if("function"===typeof a)return p.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(c=0;c<a;++c)p.call(this,null,b,c);else if(Array.isArray(a))for(c=0;c<a.length;++c)p.call(this,a[c],b,c);else return p.call(this,a,b,0);else if("number"===typeof a){if(0<a)return m.call(this,e(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return m.call(this,a,a.length)}else return l.call(this,a)},{stats:a})}function Ea(a){Q.push(a);p();return{cancel:function(){function b(){var a=
h(Q,b);Q[a]=Q[Q.length-1];--Q.length;0>=Q.length&&y()}var c=h(Q,a);Q[c]=b}}}function E(){var a=O.viewport,b=O.scissor_box;a[0]=a[1]=b[0]=b[1]=0;U.viewportWidth=U.framebufferWidth=U.drawingBufferWidth=a[2]=b[2]=u.drawingBufferWidth;U.viewportHeight=U.framebufferHeight=U.drawingBufferHeight=a[3]=b[3]=u.drawingBufferHeight}function L(){U.tick+=1;U.time=sa();E();da.procs.poll()}function ia(){E();da.procs.refresh();I&&I.update()}function sa(){return(c()-Z)/1E3}f=e(f);if(!f)return null;var u=f.gl,W=u.getContextAttributes();
u.isContextLost();var la=r(u,f);if(!la)return null;var ea=a(),X=M(),S=la.extensions,I=G(u,S),Z=c(),ma=u.drawingBufferWidth,va=u.drawingBufferHeight,U={tick:0,time:0,viewportWidth:ma,viewportHeight:va,framebufferWidth:ma,framebufferHeight:va,drawingBufferWidth:ma,drawingBufferHeight:va,pixelRatio:f.pixelRatio},ga=R(u,S),ja=z(u,X,f),pa=q(u,S,ja,X),ma=K(u,S,ga,ja,ea),qa=v(u,ea,X,f),ca=k(u,S,ga,function(){da.procs.poll()},U,X,f),ha=F(u,S,ga,X,f),ka=w(u,S,ga,ca,ha,X),da=B(u,ea,S,ga,ja,pa,ca,ka,{},ma,qa,
{elements:null,primitive:4,count:-1,offset:0,instances:-1},U,I,f),ea=l(u,ka,da.procs.poll,U,W,S),O=da.next,fa=u.canvas,Q=[],oa=[],V=[],Y=[f.onDestroy],T=null;fa&&(fa.addEventListener("webglcontextlost",Ka,!1),fa.addEventListener("webglcontextrestored",wa,!1));ia();W=b(Da,{clear:function(a){var b=0;da.procs.poll();var c=a.color;c&&(u.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(u.clearDepth(+a.depth),b|=256);"stencil"in a&&(u.clearStencil(a.stencil|0),b|=1024);u.clear(b)},
prop:n.define.bind(null,1),context:n.define.bind(null,2),"this":n.define.bind(null,3),draw:Da({}),buffer:function(a){return ja.create(a,34962,!1,!1)},elements:function(a){return pa.create(a,!1)},texture:ca.create2D,cube:ca.createCube,renderbuffer:ha.create,framebuffer:ka.create,framebufferCube:ka.createCube,attributes:W,frame:Ea,on:function(a,b){var c;switch(a){case "frame":return Ea(b);case "lost":c=oa;break;case "restore":c=V;break;case "destroy":c=Y}c.push(b);return{cancel:function(){for(var a=
0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:ga,hasExtension:function(a){return 0<=ga.extensions.indexOf(a.toLowerCase())},read:ea,destroy:function(){Q.length=0;y();fa&&(fa.removeEventListener("webglcontextlost",Ka),fa.removeEventListener("webglcontextrestored",wa));qa.clear();ka.clear();ha.clear();ca.clear();pa.clear();ja.clear();I&&I.clear();Y.forEach(function(a){a()})},_gl:u,_refresh:ia,poll:function(){L();I&&I.update()},now:sa,stats:X});f.onDone(null,W);return W}},
{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":30,"./lib/webgl":33}]},{},[1]);
